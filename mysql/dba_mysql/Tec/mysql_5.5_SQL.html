<!DOCTYPE html>
<html lang="zh-cn">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <title>MySQL 5.5 SQL | BoobooWei</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.toberoot.com/mysql/dba_mysql/tec/mysql_5.5_SQL.html">
  <!-- Alternative links -->
  
    
      <link rel="alternative" hreflang="zh-cn" href="http://www.toberoot.com/zh-cn/mysql/dba_mysql/tec/mysql_5.5_SQL">
    
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">
  <!-- CSS -->
  <!-- build:css build/css/navy.css -->
  
<link rel="stylesheet" href="/css/navy.css">

  <!-- endbuild -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-lato@0.0.75/index.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="BoobooWei" type="application/atom+xml">
  <!-- Open Graph -->
  <meta name="description" content="声明列类型&amp;#123;数据类型总结数值型    整型    tinyint,smallint,mediumint,int,bigint            整型的unsigned--&gt;无符号，zerofill-&gt;零填充，M宽度    浮点型、定点型            float(M,d) unsigned,M-&gt;精度，即总位数，D代表小数位            decim">
<meta property="og:type" content="website">
<meta property="og:title" content="MySQL 5.5 SQL">
<meta property="og:url" content="http://www.toberoot.com/mysql/dba_mysql/tec/mysql_5.5_SQL">
<meta property="og:site_name" content="BoobooWei">
<meta property="og:description" content="声明列类型&amp;#123;数据类型总结数值型    整型    tinyint,smallint,mediumint,int,bigint            整型的unsigned--&gt;无符号，zerofill-&gt;零填充，M宽度    浮点型、定点型            float(M,d) unsigned,M-&gt;精度，即总位数，D代表小数位            decim">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-10-19T06:10:05.832Z">
<meta property="article:modified_time" content="2020-10-19T06:10:05.832Z">
<meta property="article:author" content="魏亚萍">
<meta name="twitter:card" content="summary">
<meta property="fb:admins" content="100000247608790">
  <!-- Google Analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48498357-3', 'auto');
  ga('send', 'pageview');
</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-6482217598104186",
          enable_page_level_ads: true
     });
  </script>
  <!-- at the end of the HEAD -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>

<body>
  <div id="container">
    <header id="header" class="wrapper">
  <div id="header-inner" class="inner">
    <h1 id="logo-wrap">
      <a href='/' id="logo">ToBeRoot</a>
    </h1>
    <nav id="main-nav">
      <a href="/api/" class="main-nav-link">MySQL8.0</a><a href="/mse/" class="main-nav-link">MSE</a><a href="/linux/" class="main-nav-link">Linux</a><a href="/mysql/" class="main-nav-link">MySQL</a><a href="/oracle/" class="main-nav-link">Oracle</a><a href="/nosql/" class="main-nav-link">NoSQL</a><a href="/devops/" class="main-nav-link">DevOps</a><a href="/git/" class="main-nav-link">Git</a><a href="/cloud/" class="main-nav-link">Cloud</a><a href="/news/" class="main-nav-link">News</a>
      <a target="_blank" href="https://github.com/BoobooWei" rel="external nofollow noreferrer noopener" class="main-nav-link"><i class="fa fa-github-alt"></i></a>
      <div id="search-input-wrap">
        <div id="search-input-icon">
          <i class="fa fa-search"></i>
        </div>
        <input type="search" id="search-input" placeholder="Search...">
      </div>
    </nav>
    <div id="lang-select-wrap">
      <a href="/themes/" class="main-nav-link"><label id="lang-select-label"><i class="fa fa-globe"></i><span>技术广角</span></label></a>
    </div>


    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <header class="article-header">
                <h1 class="article-title" itemprop="name">MySQL 5.5 SQL</h1>
                <a target="_blank" href="https://github.com/booboowei/site/edit/master/source/mysql/dba_mysql/tec/mysql_5.5_SQL.md" rel="external nofollow noreferrer noopener" class="article-edit-link" title="改进本文"><i class="fa fa-pencil"></i></a>
              </header>
              <div class="article-content" itemprop="articleBody">
                <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">声明列类型&#123;</span><br><span class="line"></span><br><span class="line">数据类型总结</span><br><span class="line"></span><br><span class="line">数值型</span><br><span class="line">    整型    tinyint,smallint,mediumint,int,bigint</span><br><span class="line">            整型的unsigned<span class="comment">--&gt;无符号，zerofill-&gt;零填充，M宽度</span></span><br><span class="line">    浮点型、定点型</span><br><span class="line">            float(M,d) unsigned,M-&gt;精度，即总位数，D代表小数位</span><br><span class="line">            decimal比float更精确</span><br><span class="line"></span><br><span class="line">字符型</span><br><span class="line">    char(M) 定长，可存储的字符数，M&lt;=255</span><br><span class="line">    varchar(M) 变长，可存储的字符数，M=&lt;65535</span><br><span class="line">    char与varchar的区别</span><br><span class="line">        char(M)，实占M个字符，不够M个，右侧补空格，取出时，去除右侧空格</span><br><span class="line">        varchar(M)，有1-2个字节来标记真实的长度</span><br><span class="line">        </span><br><span class="line">日期时间型</span><br><span class="line">    year 1901-2155，如果输入2位'00-69'+2000,'70-99'+1900</span><br><span class="line">    date YYYY-MM-DD，范围在1000-01-01-&gt;9999-12-31</span><br><span class="line">    time HH:MM:SS，范围在-838:59:59-&gt;838:59:59</span><br><span class="line">    datetime 'YYYY-MM-DD HH:MM:SS' ，范围在'1000-01-0100:00:00' -&gt; '9999-12-31 23:59:59'.</span><br><span class="line">    </span><br><span class="line">开发中的一个问题——精确到秒的时间表示方式，时间戳 用int型，而不是datetime</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">创库创表&#123;</span><br><span class="line"></span><br><span class="line">创建商品表goods</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`goods`</span> (</span><br><span class="line">  <span class="string">`goods_id`</span> mediumint(<span class="number">8</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT primary <span class="keyword">key</span>,</span><br><span class="line">  <span class="string">`cat_id`</span> <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`goods_sn`</span> <span class="built_in">varchar</span>(<span class="number">60</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`goods_name`</span> <span class="built_in">varchar</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`click_count`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`brand_id`</span> <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`goods_number`</span> <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`market_price`</span> <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0.00'</span>,</span><br><span class="line">  <span class="string">`shop_price`</span> <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0.00'</span>,</span><br><span class="line">  add_time <span class="built_in">int</span> <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="number">0</span>) <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line">创建品牌表brand</span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`brand`</span> (</span><br><span class="line">  <span class="string">`brand_id`</span> <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`brand_name`</span> <span class="built_in">varchar</span>(<span class="number">60</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`brand_id`</span>)</span><br><span class="line">) <span class="keyword">CHARSET</span> utf8;</span><br><span class="line"></span><br><span class="line">创建商品栏目表category</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`category`</span> (</span><br><span class="line">  <span class="string">`cat_id`</span> <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`cat_name`</span> <span class="built_in">varchar</span>(<span class="number">90</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`parent_id`</span> <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`cat_id`</span>)</span><br><span class="line">) <span class="keyword">CHARSET</span> utf8;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">导入数据&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> booboo.goods </span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">goods_id,cat_id,goods_sn,goods_name,</span><br><span class="line">click_count,brand_id,goods_number,</span><br><span class="line">market_price,shop_price,add_time </span><br><span class="line"><span class="keyword">from</span> ecshop.ecs_goods;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> booboo.category</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">cat_id,cat_name,parent_id</span><br><span class="line"><span class="keyword">from</span> ecshop.ecs_category;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> booboo.brand</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">brand_id,brand_name</span><br><span class="line"><span class="keyword">from</span> ecshop.ecs_brand;</span><br><span class="line"></span><br><span class="line">查看表信息</span><br><span class="line"></span><br><span class="line">MariaDB [booboo]&gt; select * from brand;</span><br><span class="line">+<span class="comment">----------+----------------+</span></span><br><span class="line">| brand_id | brand_name     |</span><br><span class="line">+<span class="comment">----------+----------------+</span></span><br><span class="line">|        1 | 诺基亚         |</span><br><span class="line">|        2 | 摩托罗拉       |</span><br><span class="line">|        3 | 多普达         |</span><br><span class="line">|        4 | 飞利浦         |</span><br><span class="line">|        5 | 夏新           |</span><br><span class="line">|        6 | 三星           |</span><br><span class="line">|        7 | 索爱           |</span><br><span class="line">|        8 | LG             |</span><br><span class="line">|        9 | 联想           |</span><br><span class="line">|       10 | 金立           |</span><br><span class="line">|       11 |   恒基伟业     |</span><br><span class="line">+<span class="comment">----------+----------------+</span></span><br><span class="line">11 rows in <span class="keyword">set</span> (<span class="number">0.12</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [booboo]&gt; <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">category</span>;</span><br><span class="line">+<span class="comment">--------+---------------------------+-----------+</span></span><br><span class="line">| cat_id | cat_name                  | parent_id |</span><br><span class="line">+<span class="comment">--------+---------------------------+-----------+</span></span><br><span class="line">|      1 | 手机类型                  |         0 |</span><br><span class="line">|      2 | CDMA手机                  |         1 |</span><br><span class="line">|      3 | GSM手机                   |         1 |</span><br><span class="line">|      4 | 3G手机                    |         1 |</span><br><span class="line">|      5 | 双模手机                  |         1 |</span><br><span class="line">|      6 | 手机配件                  |         0 |</span><br><span class="line">|      7 | 充电器                    |         6 |</span><br><span class="line">|      8 | 耳机                      |         6 |</span><br><span class="line">|      9 | 电池                      |         6 |</span><br><span class="line">|     11 | 读卡器和内存卡            |         6 |</span><br><span class="line">|     12 | 充值卡                    |         0 |</span><br><span class="line">|     13 | 小灵通/固话充值卡         |        12 |</span><br><span class="line">|     14 | 移动手机充值卡            |        12 |</span><br><span class="line">|     15 | 联通手机充值卡            |        12 |</span><br><span class="line">+<span class="comment">--------+---------------------------+-----------+</span></span><br><span class="line">14 rows in <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [booboo]&gt; <span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">limit</span> <span class="number">5</span>;</span><br><span class="line">+<span class="comment">----------+--------+-----------+-----------------------------+-------------+----------+--------------+--------------+------------+------------+</span></span><br><span class="line">| goods_id | cat_id | goods_sn  | goods_name                  | click_count | brand_id | goods_number | market_price | shop_price | add_time   |</span><br><span class="line">+<span class="comment">----------+--------+-----------+-----------------------------+-------------+----------+--------------+--------------+------------+------------+</span></span><br><span class="line">|        1 |      4 | ECS000000 | KD876                       |           7 |        8 |            1 |      1665.60 |    1388.00 | 1240902890 |</span><br><span class="line">|        3 |      8 | ECS000002 | 诺基亚原装5800耳机          |           3 |        1 |           24 |        81.60 |      68.00 | 1241422082 |</span><br><span class="line">|        4 |      8 | ECS000004 | 诺基亚N85原装充电器         |           0 |        1 |           17 |        69.60 |      58.00 | 1241422402 |</span><br><span class="line">|        5 |     11 | ECS000005 | 索爱原装M2卡读卡器          |           3 |        7 |            8 |        24.00 |      20.00 | 1241422518 |</span><br><span class="line">|        6 |     11 | ECS000006 | 胜创KINGMAX内存卡           |           0 |        0 |           15 |        50.40 |      42.00 | 1241422573 |</span><br><span class="line">+<span class="comment">----------+--------+-----------+-----------------------------+-------------+----------+--------------+--------------+------------+------------+</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">查询5种字句&#123;</span><br><span class="line"></span><br><span class="line">where,group,having,order by,limit</span><br><span class="line"></span><br><span class="line">比较运算符</span><br><span class="line">    &lt;,&lt;=,&gt;,&gt;=,=,!=,&lt;&gt;,in,between</span><br><span class="line">    <span class="comment">#in (va1,va2,va3..vaN)，值等于1-&gt;N任意一个都行</span></span><br><span class="line">    <span class="comment">#between va1 and va2，表示在va1和va2之间</span></span><br><span class="line">    </span><br><span class="line">逻辑运算符</span><br><span class="line">    and,or,not</span><br><span class="line">    &amp;&amp;,||,!</span><br><span class="line">    </span><br><span class="line">模糊查询 </span><br><span class="line">    like </span><br><span class="line">    % 任意字符</span><br><span class="line">    _ 单个字符&#123;</span><br><span class="line">    goods表中的所有商品&#123;</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> goods;</span><br><span class="line">    &#125;</span><br><span class="line">    goods表中goods_id小于12的商品&#123;</span><br><span class="line">    <span class="keyword">select</span> goods_id,goods_name <span class="keyword">from</span> goods <span class="keyword">where</span> goods_id&gt;<span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    goods表中市场价比本店价格超过200的商品的id，名字，价格&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,market_price,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> market_price-shop_price &gt; <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    本店价格小于3000的商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> shop_price &lt; <span class="number">3000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    本店价格小于等于2000的商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> shop_price &lt;= <span class="number">2000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    本店价格等于2000的商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> shop_price = <span class="number">2000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    本店价格大于3010的商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> shop_price &gt; <span class="number">3010</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    本店价格大于等于3010的商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> shop_price &gt;= <span class="number">3010</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    本店价格不等于3010的商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> shop_price != <span class="number">3010</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    不属于第三号栏目的所有商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,cat_id,goods_name <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id &lt;&gt; <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    属于第三号栏目或者第四号栏目的所有商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,cat_id,goods_name <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id <span class="keyword">in</span> (<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    本店价格在2000到3000之间的所有商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> shop_price <span class="keyword">between</span> <span class="number">2000</span> <span class="keyword">and</span> <span class="number">3000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    本店价格在3000到5000之间，或者500到1000的商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> shop_price <span class="keyword">between</span> <span class="number">3000</span> <span class="keyword">and</span> <span class="number">5000</span> <span class="keyword">or</span> shop_price <span class="keyword">between</span> <span class="number">500</span> <span class="keyword">and</span> <span class="number">1000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    不属于第4和第5栏目的商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,cat_id <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    商品名以诺基亚开头的商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name <span class="keyword">from</span> goods <span class="keyword">where</span> goods_name <span class="keyword">like</span> <span class="string">'诺基亚%'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    商品名以诺基亚开头后面只有三个字符的商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name <span class="keyword">from</span> goods <span class="keyword">where</span> goods_name <span class="keyword">like</span> <span class="string">'诺基亚___'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">group 常用于分类统计，求平均等场景，与以下聚合函数配合使用：</span><br><span class="line"></span><br><span class="line">    max 最大</span><br><span class="line">    min 最小</span><br><span class="line">    sum 总和</span><br><span class="line">    avg 平均</span><br><span class="line">    count 总行数&#123;    </span><br><span class="line">    最贵的商品价格&#123;</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">max</span>(shop_price) <span class="keyword">from</span> goods;</span><br><span class="line">    &#125;</span><br><span class="line">    最大的商品编号&#123;</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">max</span>(goods_id) <span class="keyword">from</span> goods;</span><br><span class="line">    &#125;</span><br><span class="line">    最便宜的商品价格&#123;</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">min</span>(shop_price) <span class="keyword">from</span> goods;</span><br><span class="line">    &#125;</span><br><span class="line">    最小商品编号&#123;</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">min</span>(goods_id) <span class="keyword">from</span> goods;</span><br><span class="line">    &#125;</span><br><span class="line">    该店所有商品的库存总量&#123;</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">count</span>(goods_number) <span class="keyword">from</span> goods;</span><br><span class="line">    &#125;</span><br><span class="line">    查询所有商品的平均价&#123;</span><br><span class="line">        selelct agv(shop_price) from goods;</span><br><span class="line">    &#125;</span><br><span class="line">    该店一共有多少个商品&#123;</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> goods;</span><br><span class="line">    &#125;</span><br><span class="line">    查询每个栏目下面最贵商品价格；最低商品价格；商品平均价格；商品库存量；商品种类&#123;</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">max</span>(shop_price),<span class="keyword">min</span>(shop_price),<span class="keyword">avg</span>(shop_price),<span class="keyword">count</span>(*) <span class="keyword">from</span> goods <span class="keyword">group</span> <span class="keyword">by</span> cat_id;</span><br><span class="line">    &#125;    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">having和group综合运用查询&#123;</span><br><span class="line">    查询该店的商品比市场价格所节省的价格&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,market_price-shop_price <span class="keyword">as</span> j <span class="keyword">from</span> goods;</span><br><span class="line">    &#125;</span><br><span class="line">    查询每个商品所积压的货款（提示：库存*单价）&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,goods_number*shop_price <span class="keyword">from</span> goods;</span><br><span class="line">    &#125;</span><br><span class="line">    查询该店积压的总货款&#123;</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">sum</span>(goods_number*shop_price) <span class="keyword">from</span> goods;</span><br><span class="line">    &#125;</span><br><span class="line">    查询该店每个栏目下面积压的货款&#123;</span><br><span class="line">        <span class="keyword">select</span> cat_id,<span class="keyword">sum</span>(goods_num*shop_price) <span class="keyword">as</span> k <span class="keyword">from</span> goods <span class="keyword">group</span> <span class="keyword">by</span> cat_id;</span><br><span class="line">    &#125;</span><br><span class="line">    查询比市场价省钱200元以上的商品及该商品锁省的钱（where和having分别实现）&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price,market_price,market_price-shop_price <span class="keyword">as</span> p <span class="keyword">from</span> goods <span class="keyword">where</span> market_price-shop_price &gt; <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price,market_price,market_price-shop_price <span class="keyword">as</span> p <span class="keyword">from</span> goods <span class="keyword">having</span> p&gt;<span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    查询积压贷款超过2w的栏目，以及栏目积压的货款&#123;</span><br><span class="line">        <span class="keyword">select</span> cat_id,goods_number*shop_price <span class="keyword">as</span> k <span class="keyword">from</span> goods <span class="keyword">group</span> <span class="keyword">by</span> cat_id <span class="keyword">having</span> k &gt; <span class="number">20000</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">order by 与 limit 查询&#123;    </span><br><span class="line">    </span><br><span class="line">    按价格由高到底排序&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> shop_price <span class="keyword">desc</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    按发布时间由早到晚排序&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,add_time <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> add_time ;</span><br><span class="line">    &#125;</span><br><span class="line">    按栏目由低到高排序，栏目内部按价格由高到低排序&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,cat_id,shop_price <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> cat_id,shop_price <span class="keyword">desc</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    取出价格最高的前三名商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> shop_price <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    取出点击量前三名到前五名的商品&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_id,goods_name,click_count <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> click_count <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">2</span>,<span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># limit a,b 代表从索引位a开始，一共取b个记录，而索引是从0开始    </span></span><br><span class="line">    <span class="comment"># 如果不写a，则相当于 limit 0,b</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">使用误区&#123;</span><br><span class="line"></span><br><span class="line">    找出每个栏目下最贵的商品，商品名，商品所在栏目，商品id，商品价格：</span><br><span class="line">    </span><br><span class="line">    这个问题没有办法用一个<span class="keyword">select</span>完成，需要用到<span class="keyword">view</span>或子查询</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">view</span> a <span class="keyword">as</span> <span class="keyword">select</span> cat_id,goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> cat_id,shop_price <span class="keyword">desc</span>;</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> a <span class="keyword">group</span> <span class="keyword">by</span> cat_id;</span><br><span class="line">    </span><br><span class="line">    注意5个字句的顺序，where &gt; group by &gt; having &gt; order by &gt; limit</span><br><span class="line">    group by默认输出行只会选择组中的第一行</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line">子查询3种&#123;</span><br><span class="line">    </span><br><span class="line">    where 型&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 把内层查询的结果作为外层查询的比较条件</span></span><br><span class="line">        <span class="comment"># 查询最大、最贵商品</span></span><br><span class="line">        </span><br><span class="line">        查询最新的商品（以id最大为最新，不用order by）:&#123;</span><br><span class="line">            <span class="keyword">select</span> goods_id,goods_name <span class="keyword">from</span> goods <span class="keyword">where</span> goods_id = (<span class="keyword">select</span> <span class="keyword">max</span>(goods_id) <span class="keyword">from</span> goods);</span><br><span class="line">        &#125;</span><br><span class="line">        每个栏目下最新的商品：&#123;</span><br><span class="line">            <span class="keyword">select</span> cat_id,goods_id,goods_name <span class="keyword">from</span> goods <span class="keyword">where</span> goods_id <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">max</span>(goods_id) <span class="keyword">from</span> goods <span class="keyword">group</span> <span class="keyword">by</span> cat_id);    </span><br><span class="line">        &#125;</span><br><span class="line">        每个栏目下最贵的商品：&#123;</span><br><span class="line">            <span class="keyword">select</span> cat_id,goods_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> shop_price <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">max</span>(shop_price) <span class="keyword">from</span> goods <span class="keyword">group</span> <span class="keyword">by</span> cat_id);</span><br><span class="line">        &#125;    </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    from 型&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 把内层查询的结果作为外层查询的临时表</span></span><br><span class="line">        <span class="comment"># 查询每个栏目下最新、最贵商品</span></span><br><span class="line">        </span><br><span class="line">        每个栏目下最新的商品：&#123;</span><br><span class="line">            <span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> cat_id,goods_id,goods_name <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> cat_id,goods_id <span class="keyword">desc</span>) <span class="keyword">as</span> a <span class="keyword">group</span> <span class="keyword">by</span> cat_id;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    exits 型&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 把外层的查询结果，拿到内层，看内存查询是否成立</span></span><br><span class="line">        <span class="comment"># 查询有商品的栏目</span></span><br><span class="line">        </span><br><span class="line">        查有商品的栏目&#123;</span><br><span class="line">            <span class="keyword">select</span> cat_id,cat_name <span class="keyword">from</span> <span class="keyword">category</span> <span class="keyword">where</span> cat_id <span class="keyword">in</span> (<span class="keyword">select</span> cat_id <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id <span class="keyword">in</span> (<span class="keyword">select</span> cat_id <span class="keyword">from</span> <span class="keyword">category</span>) <span class="keyword">group</span> <span class="keyword">by</span> cat_id);</span><br><span class="line">            <span class="keyword">select</span> cat_id,cat_name <span class="keyword">from</span> <span class="keyword">category</span> <span class="keyword">where</span> <span class="keyword">exists</span> (<span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">where</span> goods.cat_id = category.cat_id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    拓展题&#123;</span><br><span class="line"></span><br><span class="line">    设有成绩表stu，如下：</span><br><span class="line">    +<span class="comment">--------+--------+-------+</span></span><br><span class="line">    | name   | class  | score |</span><br><span class="line">    +<span class="comment">--------+--------+-------+</span></span><br><span class="line">    | 张三   | 数学   |    90 |</span><br><span class="line">    | 张三   | 语文   |    50 |</span><br><span class="line">    | 张三   | 地理   |    40 |</span><br><span class="line">    | 李四   | 语文   |    55 |</span><br><span class="line">    | 李四   | 政治   |    45 |</span><br><span class="line">    | 王五   | 政治   |    30 |</span><br><span class="line">    +<span class="comment">--------+--------+-------+</span></span><br><span class="line">    试查询两门及两门以上不及格的学生的平均分&#123;</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">name</span>,<span class="keyword">avg</span>(score) <span class="keyword">from</span> stu <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> stu <span class="keyword">where</span> score &lt; <span class="number">60</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span> <span class="keyword">having</span> <span class="keyword">count</span>(*)&gt;=<span class="number">2</span>) <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span>;</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">name</span>,<span class="keyword">avg</span>(score) <span class="keyword">from</span> stu <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> stu <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span> <span class="keyword">having</span> <span class="keyword">sum</span>(score&lt;<span class="number">60</span>) &gt;= <span class="number">2</span>) <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">合并查询&#123;</span><br><span class="line">    </span><br><span class="line">    union 联合&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 作用：把2个查询连接在一起</span></span><br><span class="line">        <span class="comment"># 要求：两次查询的列数一直</span></span><br><span class="line">        <span class="comment"># 推荐：查询的每一个列，相对应的列类型也一样</span></span><br><span class="line">        <span class="comment"># 可以来自多张表，例如ecshop中的留言板</span></span><br><span class="line">        查询ecshop中用户ecshop的评论和投诉&#123;</span><br><span class="line">            <span class="keyword">select</span> user_name,<span class="keyword">content</span> <span class="keyword">from</span> ecs_comment <span class="keyword">where</span> user_name = <span class="string">'ecshop'</span> <span class="keyword">union</span> <span class="keyword">select</span> user_name,msg_content <span class="keyword">from</span> ecs_feedback <span class="keyword">where</span> user_name = <span class="string">'ecshop'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># 如果不同的语句中有完全相同的行，则会合并为一行，即去重</span></span><br><span class="line">        <span class="comment"># 如果不想自动去重复，则需要使用all参数，union all</span></span><br><span class="line">        获取a表和b表中的id和num，如果id相同，则获取num之和&#123;</span><br><span class="line">            MariaDB [booboo]&gt; select * from a;</span><br><span class="line">            +<span class="comment">------+------+</span></span><br><span class="line">            | id   | num  |</span><br><span class="line">            +<span class="comment">------+------+</span></span><br><span class="line">            | a    |    5 |</span><br><span class="line">            | b    |   10 |</span><br><span class="line">            | c    |   15 |</span><br><span class="line">            | d    |   10 |</span><br><span class="line">            +<span class="comment">------+------+</span></span><br><span class="line"></span><br><span class="line">            MariaDB [booboo]&gt; select * from b;</span><br><span class="line">            +<span class="comment">------+------+</span></span><br><span class="line">            | id   | num  |</span><br><span class="line">            +<span class="comment">------+------+</span></span><br><span class="line">            | b    |    5 |</span><br><span class="line">            | c    |   15 |</span><br><span class="line">            | d    |   20 |</span><br><span class="line">            | e    |   99 |</span><br><span class="line">            +<span class="comment">------+------+</span></span><br><span class="line">    </span><br><span class="line">            <span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">sum</span>(<span class="keyword">num</span>) <span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> a <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> * <span class="keyword">from</span> b) <span class="keyword">as</span> tmp <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">id</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># 如果包含order by或limit子句，需要加小括号</span></span><br><span class="line">        <span class="comment"># 尽量不要在子句中单独用，而是整体使用，对最终结果来排序</span></span><br><span class="line">        取第四栏目的商品，价格降序偏排列，还想去第五栏的商品，价格也降序，最终按价格降序，union连接&#123;</span><br><span class="line">            (<span class="keyword">select</span> shop_price,goods_id,goods_name,cat_id <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id = <span class="number">4</span> ) <span class="keyword">union</span> (<span class="keyword">select</span> shop_price,goods_id,goods_name,cat_id <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id = <span class="number">5</span> ) <span class="keyword">order</span> <span class="keyword">by</span> shop_price <span class="keyword">desc</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        取第三个栏目价格前3高的商品和第四个栏目价格前两高的商品，用union实现&#123;</span><br><span class="line">        (<span class="keyword">select</span> goods_id,cat_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id = <span class="number">3</span> <span class="keyword">order</span> <span class="keyword">by</span> shop_price <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">3</span>) <span class="keyword">union</span> (<span class="keyword">select</span> goods_id,cat_id,goods_name,shop_price <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id = <span class="number">4</span> <span class="keyword">order</span> <span class="keyword">by</span> shop_price <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">连接查询&#123;</span><br><span class="line">    </span><br><span class="line">    关系型数据库的数学模型为集合<span class="keyword">set</span></span><br><span class="line">    <span class="number">1</span>） <span class="keyword">set</span>的特性：无序，唯一</span><br><span class="line">    <span class="number">2</span>）一张表就是一个集合，一行记录就是一个元素——理论上不可能出现完全相同的行</span><br><span class="line">    <span class="number">3</span>）表中有一个隐藏列row_id是不同的</span><br><span class="line">    集合的运算</span><br><span class="line">    <span class="number">1</span>）在数学中，两个集合X和Y的笛卡尓乘积（Cartesian product），又称直积，表示为X × Y，</span><br><span class="line">    <span class="number">2</span>）第一个对象是X的成员而第二个对象是Y的所有可能有序对的其中一个成员。</span><br><span class="line">    <span class="number">3</span>）假设集合A=&#123;a,b&#125;，集合B=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>&#125;，则两个集合的笛卡尔积为&#123;(a,<span class="number">0</span>), (a,<span class="number">1</span>), (a,<span class="number">2</span>), (b,<span class="number">0</span>), (b,<span class="number">1</span>), (b, <span class="number">2</span>)&#125;。</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">table</span> a <span class="number">7</span> 行，<span class="keyword">table</span> b <span class="number">8</span> 行 ，这两表相乘一共 <span class="number">7</span>*<span class="number">8</span>=<span class="number">56</span>行</span><br><span class="line">    </span><br><span class="line">    取出商品的商品名，商品所在栏目名&#123;</span><br><span class="line">        <span class="keyword">select</span> goods_name,cat_name,goods.cat_id,category.cat_id <span class="keyword">from</span> goods <span class="keyword">join</span> <span class="keyword">category</span> <span class="keyword">on</span> goods.cat_id = category.cat_id <span class="keyword">limit</span> <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">select</span> goods_name,cat_name,goods.cat_id,category.cat_id <span class="keyword">from</span> goods,<span class="keyword">category</span> <span class="keyword">where</span> goods.cat_id = category.cat_id <span class="keyword">limit</span> <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    python 代码实现笛卡尔积&#123;</span><br><span class="line">    for i in A:</span><br><span class="line">        for j in B:</span><br><span class="line">            print '&#123;&#125;&#123;&#125;'.format(i,j)</span><br><span class="line">    print 'A*B的元素个数为&#123;&#125;'.format(len(A)*len*(B))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    python 代码实现左连接&#123;</span><br><span class="line">        test=0    </span><br><span class="line">        for i,j in A.items():</span><br><span class="line">            for m,n in B.items():</span><br><span class="line">                if i==m:</span><br><span class="line">                    print '&#123;&#125; &#123;&#125; &#123;&#125; &#123;&#125;'.format(i,j,m,n)</span><br><span class="line">                else:</span><br><span class="line">                    test=test+1</span><br><span class="line">            if test==len(B):</span><br><span class="line">            print '&#123;&#125; &#123;&#125; NULL NULL '.format(i,j)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    python 代码实现右连接&#123;</span><br><span class="line">        test=0    </span><br><span class="line">        for a,b in B.items():</span><br><span class="line">            for i,j in A.items():</span><br><span class="line">                if a==i:</span><br><span class="line">                    print '&#123;&#125; &#123;&#125; &#123;&#125; &#123;&#125;'.format(i,j,a,b)</span><br><span class="line">                else:</span><br><span class="line">                    test=test+1</span><br><span class="line">            if test==len(A):</span><br><span class="line">            print 'NULL NULL &#123;&#125; &#123;&#125;'.format(a,b)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    左连接&#123;</span><br><span class="line">        <span class="comment"># select col1,col2,colN from A left join B ON A.col = B.col</span></span><br><span class="line">        <span class="comment"># 左连接以左表为准，去右表匹配，找不到匹配用NULL补齐</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    右连接&#123;</span><br><span class="line">        <span class="comment"># select col1,col2,colN from A right join B ON A.col = B.col</span></span><br><span class="line">        <span class="comment"># 右连接以右表为准，去左表匹配，找不到匹配用NULL补齐</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    内连接&#123;</span><br><span class="line">        <span class="comment"># 内连接，查询左右表都有的数据，即：不要左、右中NULL的部分</span></span><br><span class="line">        <span class="comment"># 左右连接的交集</span></span><br><span class="line">        <span class="comment"># 左右连接目前没有并集，可以用union连接    </span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    查goods_id,cat_id,cat_name,brand_id,brand_name,goods_name&#123;</span><br><span class="line">            <span class="keyword">select</span> goods_id,goods.cat_id,cat_name,goods.brand_id,brand_name <span class="keyword">from</span> goods <span class="keyword">left</span> <span class="keyword">join</span> (<span class="keyword">category</span>,brand) <span class="keyword">on</span> (goods.cat_id=category.cat_id <span class="keyword">and</span> goods.brand_id=brand.brand_id);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;            </span><br><span class="line">    </span><br><span class="line">列的增删改&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> 列声明 [<span class="keyword">after</span> col_name | <span class="keyword">first</span>]</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">视图<span class="keyword">view</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="number">1</span>）视图定义：视图是由查询结果形成的一张虚拟表</span><br><span class="line">    <span class="number">2</span>）视图的创建语法：<span class="keyword">create</span> <span class="keyword">view</span> 视图名 <span class="keyword">as</span> <span class="keyword">select</span> 语句;</span><br><span class="line">    3）为什么要视图：简化查询；权限控制，关闭表的权限，打开视图权限；大数据分表时可以用到；</span><br><span class="line">        比如表的行数超过200万行时，就会变慢，可以把一张表拆分成4张表来存放</span><br><span class="line">            news表</span><br><span class="line">            newsid 1,2,3,4</span><br><span class="line">            news1，news2，news3，news4</span><br><span class="line">            把一张表的数据分散到4张表中，分散的方法很多，</span><br><span class="line">            最常用的是用id取模来计算</span><br><span class="line">                id%4+1=[1,2,3,4]</span><br><span class="line">            比如id=17 ，17%4+1=2，news2    </span><br><span class="line">    4）视图与表的关系</span><br><span class="line">            视图是表的查询结果，如果表数据发生变化，则视图也会有影响</span><br><span class="line">            视图增删改也会影响表，但是增删改有时不可以对视图执行，比如不是一一对应关系</span><br><span class="line">            对于视图的插入动作，视图必须包含所有表中没有默认值的列    </span><br><span class="line">    </span><br><span class="line">    视图的创建&#123;</span><br><span class="line">    <span class="keyword">CREATE</span></span><br><span class="line">    [ALGORITHM = &#123;UNDEFINED | <span class="keyword">MERGE</span> | TEMPTABLE&#125;]</span><br><span class="line">    <span class="comment">/*    undifiend      未定义，自动，让系统帮你选</span></span><br><span class="line"><span class="comment">        temptable      当引用视图时，根据视图的创建语句建立一个临时表</span></span><br><span class="line"><span class="comment">        merge         当引用视图时，引用视图的语句与定义视图的语句合并 */</span></span><br><span class="line">    [<span class="keyword">SQL</span> <span class="keyword">SECURITY</span> &#123; DEFINER | INVOKER &#125;]</span><br><span class="line">    <span class="keyword">VIEW</span> view_name [(column_list)]</span><br><span class="line">    <span class="keyword">AS</span> select_statement</span><br><span class="line">    [<span class="keyword">WITH</span> [<span class="keyword">CASCADED</span> | <span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    视图的修改&#123;</span><br><span class="line">    <span class="keyword">ALTER</span> [ALGORITHM = &#123;UNDEFINED | <span class="keyword">MERGE</span> | TEMPTABLE&#125;]</span><br><span class="line">    <span class="keyword">VIEW</span> view_name [(column_list)]</span><br><span class="line">    <span class="keyword">AS</span> select_statement</span><br><span class="line">    [<span class="keyword">WITH</span> [<span class="keyword">CASCADED</span> | <span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>]</span><br><span class="line">    该语句用于更改已有视图的定义。其语法与<span class="keyword">CREATE</span> <span class="keyword">VIEW</span>类似。</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    查询每个栏目下最贵的商品&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">create</span> algorithm=temptable <span class="keyword">view</span> test1 <span class="keyword">as</span> <span class="keyword">select</span> goods_id,goods_name,shop_price,cat_id <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> cat_id,shop_price <span class="keyword">desc</span>;</span><br><span class="line">    <span class="keyword">create</span> algorithm=<span class="keyword">merge</span> <span class="keyword">view</span> <span class="keyword">test</span> <span class="keyword">as</span> <span class="keyword">select</span> goods_id,goods_name,shop_price,cat_id <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> cat_id,shop_price <span class="keyword">desc</span>;</span><br><span class="line">    </span><br><span class="line">    MariaDB [booboo]&gt; select * from test group by cat_id;</span><br><span class="line">    +<span class="comment">----------+--------------------------------+------------+--------+</span></span><br><span class="line">    | goods_id | goods_name                     | shop_price | cat_id |</span><br><span class="line">    +<span class="comment">----------+--------------------------------+------------+--------+</span></span><br><span class="line">    |       16 | 恒基伟业G101                   |     823.33 |      2 |</span><br><span class="line">    |        8 | 飞利浦9@9v                     |     399.00 |      3 |</span><br><span class="line">    |        1 | KD876                          |    1388.00 |      4 |</span><br><span class="line">    |       23 | 诺基亚N96                      |    3700.00 |      5 |</span><br><span class="line">    |        3 | 诺基亚原装5800耳机             |      68.00 |      8 |</span><br><span class="line">    |        5 | 索爱原装M2卡读卡器             |      20.00 |     11 |</span><br><span class="line">    |       25 | 小灵通/固话50元充值卡          |      48.00 |     13 |</span><br><span class="line">    |       29 | 移动100元充值卡                |      90.00 |     14 |</span><br><span class="line">    |       27 | 联通100元充值卡                |      95.00 |     15 |</span><br><span class="line">    +<span class="comment">----------+--------------------------------+------------+--------+</span></span><br><span class="line">    9 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">    </span><br><span class="line">    MariaDB [booboo]&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test1 <span class="keyword">group</span> <span class="keyword">by</span> cat_id;</span><br><span class="line">    +<span class="comment">----------+----------------------------------------+------------+--------+</span></span><br><span class="line">    | goods_id | goods_name                             | shop_price | cat_id |</span><br><span class="line">    +<span class="comment">----------+----------------------------------------+------------+--------+</span></span><br><span class="line">    |       16 | 恒基伟业G101                           |     823.33 |      2 |</span><br><span class="line">    |       22 | 多普达Touch HD                         |    5999.00 |      3 |</span><br><span class="line">    |       18 | 夏新T5                                 |    2878.00 |      4 |</span><br><span class="line">    |       23 | 诺基亚N96                              |    3700.00 |      5 |</span><br><span class="line">    |        7 | 诺基亚N85原装立体声耳机HS-82           |     100.00 |      8 |</span><br><span class="line">    |        6 | 胜创KINGMAX内存卡                      |      42.00 |     11 |</span><br><span class="line">    |       25 | 小灵通/固话50元充值卡                  |      48.00 |     13 |</span><br><span class="line">    |       29 | 移动100元充值卡                        |      90.00 |     14 |</span><br><span class="line">    |       27 | 联通100元充值卡                        |      95.00 |     15 |</span><br><span class="line">    +<span class="comment">----------+----------------------------------------+------------+--------+</span></span><br><span class="line">    9 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">字符集&#123;</span><br><span class="line">    </span><br><span class="line">    mysql的字符集设置非常灵活，可以设置</span><br><span class="line">        <span class="number">1</span>）服务器默认字符集</span><br><span class="line">        <span class="number">2</span>）数据库默认字符集</span><br><span class="line">        <span class="number">3</span>）表默认字符集 <span class="keyword">create</span> <span class="keyword">table</span> 表名（列声明）<span class="keyword">charset</span> utf8;</span><br><span class="line">        4）列默认字符集</span><br><span class="line">        如果某一个级别没有指定字符集，则继承上一级</span><br><span class="line">        </span><br><span class="line">    以表声明utf8为例：</span><br><span class="line">        存储的数据在表中，最终是utf8</span><br><span class="line">            </span><br><span class="line">    字符集转换器工作原理：</span><br><span class="line">        1）告诉服务器，我给你发的数据是什么编码的？ character_set_client</span><br><span class="line">        2）告诉转换器，需要转换成什么编码？            character_set_connection</span><br><span class="line">        3）告诉服务器，查询的结果用什么编码？        character_set_results</span><br><span class="line">        </span><br><span class="line">        如果三者都为utf8 ，则可以简写为             <span class="keyword">set</span> <span class="keyword">names</span> utf8</span><br><span class="line">        </span><br><span class="line">    插入“中国”，并查询&#123;</span><br><span class="line">        <span class="comment">/*查看当前字符集设置*/</span></span><br><span class="line">        MariaDB [(<span class="keyword">none</span>)]&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'character%'</span>;</span><br><span class="line">        +<span class="comment">--------------------------+----------------------------+</span></span><br><span class="line">        | Variable_name            | Value                      |</span><br><span class="line">        +<span class="comment">--------------------------+----------------------------+</span></span><br><span class="line">        | character_set_client     | utf8                       |<span class="comment">/*客户端使用utf8*/</span></span><br><span class="line">        | character_set_connection | utf8                       |<span class="comment">/*转换器将客户端编码转为utf8*/</span></span><br><span class="line">        | character_set_database   | latin1                     |<span class="comment">/*数据库默认使用latin1*/</span></span><br><span class="line">        | character_set_filesystem | binary                     |<span class="comment">/*文件系统默认使用二进制*/</span></span><br><span class="line">        | character_set_results    | utf8                       |<span class="comment">/*服务器返回客户端的结果使用utf8*/</span></span><br><span class="line">        | character_set_server     | latin1                     |</span><br><span class="line">        | character_set_system     | utf8                       |</span><br><span class="line">        | character_sets_dir       | /usr/share/mysql/charsets/ |</span><br><span class="line">        +<span class="comment">--------------------------+----------------------------+</span></span><br><span class="line">        8 rows in <span class="keyword">set</span> (<span class="number">0.08</span> sec)</span><br><span class="line">        <span class="comment">/**/</span></span><br><span class="line">        <span class="comment">/*服务器上创建表t10，使用utf8编码*/</span></span><br><span class="line">        MariaDB [(<span class="keyword">none</span>)]&gt; <span class="keyword">create</span> <span class="keyword">table</span> test.t10 (<span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">10</span>)) <span class="keyword">charset</span> utf8;</span><br><span class="line">        Query OK, 0 rows affected (0.06 sec)</span><br><span class="line">        <span class="comment">/*客户端插入“中国utf8”---&gt;转换器将“中国utf8”转为“中国utf8”---&gt;服务器上使用utf8编码保存*/</span></span><br><span class="line">        MariaDB [(none)]&gt; insert into test.t10 values ('中国');</span><br><span class="line">        Query OK, 1 row affected (0.03 sec)</span><br><span class="line">        <span class="comment">/*服务器返回查询结果使用utf8*/</span></span><br><span class="line">        MariaDB [(none)]&gt; select * from test.t10;</span><br><span class="line">        +<span class="comment">--------+</span></span><br><span class="line">        | name   |</span><br><span class="line">        +<span class="comment">--------+</span></span><br><span class="line">        | 中国   |</span><br><span class="line">        +<span class="comment">--------+</span></span><br><span class="line">        1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">        <span class="comment">/*设置服务器返回查询结果使用gbk*/</span></span><br><span class="line">        MariaDB [(<span class="keyword">none</span>)]&gt; <span class="keyword">set</span> character_set_results=gbk;</span><br><span class="line">        Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">        <span class="comment">/*服务器返回查询结果使用gbk*/</span></span><br><span class="line">        MariaDB [(none)]&gt; select * from test.t10;</span><br><span class="line">        +<span class="comment">------+</span></span><br><span class="line">        | name |</span><br><span class="line">        +<span class="comment">------+</span></span><br><span class="line">        | א¹򞞠|</span><br><span class="line">        +<span class="comment">------+</span></span><br><span class="line">        1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line">    &#125;    </span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">校对集&#123;</span><br><span class="line">    校对集就是排序规则</span><br><span class="line">        <span class="number">1</span>）一种字符集可以有一个或多个排序规则</span><br><span class="line">        <span class="number">2</span>）以UTF8为例，我们默认使用utf8_general_ci规则[a,B,c,D]，也可以按照二进制来排,utf8_bin[B,D,a,c]</span><br><span class="line">    </span><br><span class="line">    如何声明校对集呢？</span><br><span class="line">        <span class="keyword">create</span> <span class="keyword">table</span> () <span class="keyword">charset</span> utf8 <span class="keyword">collation</span> utf8_bin;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    排序例题&#123;</span><br><span class="line">    MariaDB [test]&gt; create table test.t2 (id varchar(10)) charset utf8 collate utf8_bin;</span><br><span class="line">    Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">    MariaDB [test]&gt; insert into test.t2 values ('a'),('B'),('c'),('D');</span><br><span class="line">    Query OK, 4 rows affected (0.03 sec)</span><br><span class="line">    Records: 4  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">    MariaDB [test]&gt; select * from test.t2 order by id;</span><br><span class="line">    +<span class="comment">------+</span></span><br><span class="line">    | id   |</span><br><span class="line">    +<span class="comment">------+</span></span><br><span class="line">    | B    |</span><br><span class="line">    | D    |</span><br><span class="line">    | a    |</span><br><span class="line">    | c    |</span><br><span class="line">    +<span class="comment">------+</span></span><br><span class="line">    4 rows in <span class="keyword">set</span> (<span class="number">0.04</span> sec)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">触发器&#123;</span><br><span class="line">    <span class="keyword">trigger</span>,触发，一触即发</span><br><span class="line">        <span class="number">1</span>）作用：监视某种情况并触发某种操作</span><br><span class="line">        <span class="number">2</span>）监视对象：表</span><br><span class="line">        <span class="number">3</span>）监视事件：增删改</span><br><span class="line">        <span class="number">4</span>）触发时间：<span class="keyword">after</span>、<span class="keyword">before</span></span><br><span class="line">        <span class="number">5</span>）触发事件：增删改</span><br><span class="line">    </span><br><span class="line">    创建触发器的语法&#123;</span><br><span class="line">        <span class="keyword">create</span> <span class="keyword">trigger</span> TGNAME</span><br><span class="line">        <span class="keyword">after</span>/<span class="keyword">before</span> <span class="keyword">insert</span>/<span class="keyword">update</span>/<span class="keyword">delete</span> <span class="keyword">on</span> TBNAME</span><br><span class="line">        <span class="keyword">For</span> <span class="keyword">each</span> <span class="keyword">row</span> //mysql只能使用行触发器</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">sql</span> 语句</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    删除触发器的语法&#123;</span><br><span class="line">        <span class="keyword">drop</span> <span class="keyword">trigger</span> tgname;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    old&amp;new&#123;</span><br><span class="line">        1）new 是修改前的数据</span><br><span class="line">        2）old 是修改前的数据</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    after&amp;before&#123;</span><br><span class="line">                </span><br><span class="line">        after    监视事件发生后触发</span><br><span class="line">        before    监控事件发生前出发</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    观察以下场景：电子商城&#123;</span><br><span class="line">    商品表g</span><br><span class="line">    商品主键    商品名 库存</span><br><span class="line">    1            电脑    28</span><br><span class="line">    2            自行车    12</span><br><span class="line">    </span><br><span class="line">    订单表o</span><br><span class="line">    订单主键    商品外键    购买量</span><br><span class="line">        1        2            3</span><br><span class="line">        2        1            5</span><br><span class="line">        </span><br><span class="line">    完成订单与减少库存的逻辑</span><br><span class="line">        <span class="keyword">insert</span> <span class="keyword">into</span> o(gid,<span class="keyword">num</span>) <span class="keyword">values</span> (<span class="number">2</span>,<span class="number">3</span>);//插入语句</span><br><span class="line">        <span class="keyword">update</span> g <span class="keyword">set</span> goods_num = goods_num - <span class="number">3</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">2</span>;//更新过程</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    触发器例题&#123;</span><br><span class="line">    MariaDB [test]&gt; create table g (gid tinyint primary key auto_increment,goods_name varchar(10) not null,goods_num int not null default 0) charset utf8;</span><br><span class="line">    Query OK, 0 rows affected (0.11 sec)</span><br><span class="line"></span><br><span class="line">    MariaDB [test]&gt; create table o (oid tinyint primary key auto_increment,gid tinyint,order_num int not null default 0) charset utf8;</span><br><span class="line">    Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">    MariaDB [test]&gt; insert into g (goods_name,goods_num) values ('小猪',80),('小羊',60),('小鸡',280);</span><br><span class="line">    Query OK, 3 rows affected (0.03 sec)</span><br><span class="line">    Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">    MariaDB [test]&gt; insert into o (gid,order_num) values (2,10),(1,20);</span><br><span class="line">    Query OK, 2 rows affected (0.04 sec)</span><br><span class="line">    Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">    MariaDB [test]&gt; select * from g;</span><br><span class="line">    +<span class="comment">-----+------------+-----------+</span></span><br><span class="line">    | gid | goods_name | goods_num |</span><br><span class="line">    +<span class="comment">-----+------------+-----------+</span></span><br><span class="line">    |   1 | 小猪       |        80 |</span><br><span class="line">    |   2 | 小羊       |        60 |</span><br><span class="line">    |   3 | 小鸡       |       280 |</span><br><span class="line">    +<span class="comment">-----+------------+-----------+</span></span><br><span class="line">    3 rows in <span class="keyword">set</span> (<span class="number">0.13</span> sec)</span><br><span class="line"></span><br><span class="line">    MariaDB [<span class="keyword">test</span>]&gt; <span class="keyword">select</span> * <span class="keyword">from</span> o;</span><br><span class="line">    +<span class="comment">-----+------+-----------+</span></span><br><span class="line">    | oid | gid  | order_num |</span><br><span class="line">    +<span class="comment">-----+------+-----------+</span></span><br><span class="line">    |   1 |    2 |        10 |</span><br><span class="line">    |   2 |    1 |        20 |</span><br><span class="line">    +<span class="comment">-----+------+-----------+</span></span><br><span class="line">    2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">    </span><br><span class="line">    //监控对象：表o</span><br><span class="line">    //监控操作：<span class="keyword">insert</span></span><br><span class="line">    //触发时间：<span class="keyword">after</span></span><br><span class="line">    //触发事件：<span class="keyword">update</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 添加订单库存减少</span></span><br><span class="line">    dilimiter //</span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">trigger</span> tg1</span><br><span class="line">    <span class="keyword">after</span> <span class="keyword">insert</span> <span class="keyword">on</span> o</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">update</span> g <span class="keyword">set</span> goods_num = goods_num - new.order_num <span class="keyword">where</span> gid=new.gid;</span><br><span class="line">    <span class="keyword">end</span>//</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 删除订单库存增加</span></span><br><span class="line">    delimiter //</span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">trigger</span> tg2</span><br><span class="line">    <span class="keyword">after</span> <span class="keyword">delete</span> <span class="keyword">on</span> o</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">update</span> g <span class="keyword">set</span> goods_num = goods_num + old.order_num <span class="keyword">where</span> gid=old.gid;</span><br><span class="line">    <span class="keyword">end</span>//</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 修改订单的数量改变库存</span></span><br><span class="line">    delimiter//</span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">trigger</span> tg3</span><br><span class="line">    <span class="keyword">after</span> <span class="keyword">update</span> <span class="keyword">on</span> o</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">update</span> g <span class="keyword">set</span> goods_num = goods_num + old.order_num - new.order_num <span class="keyword">where</span> gid=new.gid;</span><br><span class="line">    <span class="keyword">end</span>//</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 订单数量不能查过库存量，如果超过则改为最大库存</span></span><br><span class="line">    delimiter//</span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">trigger</span> tg4</span><br><span class="line">    <span class="keyword">before</span> <span class="keyword">insert</span> <span class="keyword">on</span> o</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> new.order_num &gt; (<span class="keyword">select</span> goods_num <span class="keyword">from</span> g <span class="keyword">where</span> gid=new.oid)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">set</span> new.order_num = (<span class="keyword">select</span> goods_num <span class="keyword">from</span> g <span class="keyword">where</span> gid=new.oid);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line">    <span class="keyword">update</span> g <span class="keyword">set</span> goods_num = goods_num - new.order_num <span class="keyword">where</span> gid=new.oid;</span><br><span class="line">    <span class="keyword">end</span>//</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">存储过程&#123;</span><br><span class="line">     <span class="keyword">select</span> <span class="string">`name`</span> <span class="keyword">from</span> mysql.proc <span class="keyword">where</span> db = <span class="string">'xx'</span> <span class="keyword">and</span> <span class="string">`type`</span> = <span class="string">'PROCEDURE'</span>   <span class="comment">#存储过程</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">show</span> <span class="keyword">procedure</span> <span class="keyword">status</span>; //库中查看存储过程</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">索引与优化&#123;</span><br><span class="line">    </span><br><span class="line">    索引预览&#123;</span><br><span class="line">    设有N条记录，不用索引，平均查找N/2次        1万条记录 查5000次</span><br><span class="line">    btree 二叉树索引    log2N                    1万条记录    查14次</span><br><span class="line">    hash  哈希索引        1            </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    索引的优点和缺点：&#123;</span><br><span class="line">        优点：加快查询速度</span><br><span class="line">        缺点：降低了增删改的速度，增大了表的文件大小，索引文件甚至比数据文件还大</span><br><span class="line">    </span><br><span class="line">    导入数据可以先去掉索引，数据导入后再添加索引    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    索引的使用原则&#123;</span><br><span class="line">        1）不过度使用索引</span><br><span class="line">        2）索引条件列where后面最频繁的条件比较适宜索引</span><br><span class="line">        3）索引散列值，过于集中的值不要索引，例如给性别加索引，意义不大</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    索引类型&#123;</span><br><span class="line">                                唯一性    NULL        个数    </span><br><span class="line">        1）普通索引 index：        可重复    null        多个        加快查询速度</span><br><span class="line">        2）唯一索引 unique：    唯一    not null    多个        不仅能加快查询速度，行上的值不能重复</span><br><span class="line">        3）主键索引 primary：    唯一    not null    一个        关于数据的数据，即元数据，不能重复，不能为空</span><br><span class="line">        4）全文索引 fulltext：    fulltext index</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    查看索引&#123;</span><br><span class="line">        <span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> tablename;</span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    建立索引&#123;</span><br><span class="line">    <span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">add</span> &#123;<span class="keyword">index</span>|<span class="keyword">key</span>&#125; [index_name] [index_type] (index_col_name,...) [index_option] ...</span><br><span class="line">        <span class="number">1</span>)index_name:</span><br><span class="line">        <span class="number">2</span>)index_type:btree\<span class="keyword">hash</span></span><br><span class="line">        <span class="number">3</span>)index_option:key_block_size = ; index_tyep <span class="keyword">with</span> parser parser_name <span class="keyword">comment</span> <span class="string">'string'</span></span><br><span class="line">    <span class="comment"># 创建主键索引</span></span><br><span class="line">        <span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">add</span> primary <span class="keyword">key</span> (<span class="keyword">id</span>);</span><br><span class="line">    <span class="comment"># 创建普通索引</span></span><br><span class="line">        <span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">add</span> <span class="keyword">index</span> index_num (<span class="keyword">num</span>);</span><br><span class="line">    <span class="comment"># 创建唯一索引</span></span><br><span class="line">        <span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">add</span> <span class="keyword">unique</span> <span class="keyword">index</span> index_num (<span class="keyword">num</span>);</span><br><span class="line">    <span class="comment"># 创建全文索引</span></span><br><span class="line">        <span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">add</span> fulltext <span class="keyword">index</span> index_name (<span class="keyword">name</span>);</span><br><span class="line">    <span class="comment"># 创建空间索引</span></span><br><span class="line">        <span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">add</span> spatial <span class="keyword">index</span> index_num (<span class="keyword">num</span>);</span><br><span class="line">        mysql的空间索引是建立在空间数据类型（如point和genomtry等)列上的索引。</span><br><span class="line">        在mysql中MyISAM, InnoDB都支持空间列（存储空间数据类型的列）</span><br><span class="line"></span><br><span class="line">        空间索引有以下特性：</span><br><span class="line"></span><br><span class="line">            只有myisam和innodb（mysql5.7.5以上版本）的表支持空间索引。</span><br><span class="line">            被索引的列必须非NULL</span><br><span class="line">            在mysql5.7中，列的前缀长度属性被禁用。空间索引直接索引完整宽度的列</span><br><span class="line">            由于空间数据类型我们很少用到，所以空间索引我们接触的更少。这里不做深入阐述了</span><br><span class="line">    <span class="comment"># 创建外键索引</span></span><br><span class="line">        <span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">add</span> <span class="keyword">foreign</span> <span class="keyword">key</span> index_foregin_key (t1.num,t2.num) reference_definition<span class="string">'</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    # 全文索引的用法</span></span><br><span class="line"><span class="string">        select * from tbname where match (全文索引名) against ('</span>keyword<span class="string">');</span></span><br><span class="line"><span class="string">        强烈注意：MySql自带的全文索引只能用于数据库引擎为MYISAM的数据表，如果是其他数据引擎，则全文索引不会生效。此外，MySql自带的全文索引只能对英文进行全文检索，目前无法对中文进行全文检索。如果需要对包含中文在内的文本数据进行全文检索，我们需要采用Sphinx（斯芬克斯）/Coreseek技术来处理中文。</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    注：目前，使用MySql自带的全文索引时，如果查询字符串的长度过短将无法得到期望的搜索结果。MySql全文索引所能找到的词默认最小长度为4个字符。另外，如果查询的字符串包含停止词，那么该停止词将会被忽略。    </span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">存储过程&#123;</span></span><br><span class="line"><span class="string">    类似于函数，就是将一段代码封装起来，通过call来调用</span></span><br><span class="line"><span class="string">    可以用流程控制语句 if/else ,case , while </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    查询存储过程&#123;</span></span><br><span class="line"><span class="string">        show create procedure dbname.pdname;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    创建存储过程&#123;</span></span><br><span class="line"><span class="string">    delimiter //</span></span><br><span class="line"><span class="string">    create procedure proc1 (out s int) </span></span><br><span class="line"><span class="string">    begin</span></span><br><span class="line"><span class="string">    select count(*) into s from user;</span></span><br><span class="line"><span class="string">    end//</span></span><br><span class="line"><span class="string">    dilimiter ;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    参数&#123;</span></span><br><span class="line"><span class="string">        MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT,形式如：</span></span><br><span class="line"><span class="string">            CREATE PROCEDURE([[IN |OUT |INOUT ] 参数名 数据类形...])</span></span><br><span class="line"><span class="string">        1)IN 输入参数:表示该参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值</span></span><br><span class="line"><span class="string">        2)OUT 输出参数:该值可在存储过程内部被改变，并可返回</span></span><br><span class="line"><span class="string">        3)INOUT 输入输出参数:调用时指定，并且可被改变和返回</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">        IN参数实例&#123;</span></span><br><span class="line"><span class="string">                delimiter //</span></span><br><span class="line"><span class="string">                create procedure demo_in (IN p_in int)</span></span><br><span class="line"><span class="string">                begin</span></span><br><span class="line"><span class="string">                select p_in;</span></span><br><span class="line"><span class="string">                set p_in=2;</span></span><br><span class="line"><span class="string">                select p_in;</span></span><br><span class="line"><span class="string">                end//</span></span><br><span class="line"><span class="string">                delimiter ;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                set @p_in=1;</span></span><br><span class="line"><span class="string">                call demo_in(@p_in);</span></span><br><span class="line"><span class="string">                select @p_in;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        OUT参数实例&#123;</span></span><br><span class="line"><span class="string">                delimiter //</span></span><br><span class="line"><span class="string">                create procedure demo_out (out p_out int)</span></span><br><span class="line"><span class="string">                begin</span></span><br><span class="line"><span class="string">                select p_out;</span></span><br><span class="line"><span class="string">                set p_out=2;</span></span><br><span class="line"><span class="string">                select p_out;</span></span><br><span class="line"><span class="string">                end//</span></span><br><span class="line"><span class="string">                delimiter ;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                set @p_out=1;</span></span><br><span class="line"><span class="string">                call demo_out(@p_out);</span></span><br><span class="line"><span class="string">                select @p_out;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">        INOUT参数实例&#123;</span></span><br><span class="line"><span class="string">                delimiter //</span></span><br><span class="line"><span class="string">                create procedure demo_inout (inout p_inout int)</span></span><br><span class="line"><span class="string">                begin</span></span><br><span class="line"><span class="string">                select p_inout;</span></span><br><span class="line"><span class="string">                set p_inout=2;</span></span><br><span class="line"><span class="string">                select p_inout;</span></span><br><span class="line"><span class="string">                end//</span></span><br><span class="line"><span class="string">                delimiter ;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                set @p_inout=1;</span></span><br><span class="line"><span class="string">                call demo_inout(@p_inout);</span></span><br><span class="line"><span class="string">                select @p_inout;        </span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    变量&#123;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">        Ⅰ. 变量定义</span></span><br><span class="line"><span class="string">            DECLARE variable_name [,variable_name...] datatype [DEFAULT value];</span></span><br><span class="line"><span class="string">            其中，datatype为MySQL的数据类型，如:int, float, date, varchar(length)</span></span><br><span class="line"><span class="string">            例如:</span></span><br><span class="line"><span class="string">            1. DECLARE l_int int unsigned default 4000000;</span></span><br><span class="line"><span class="string">            2. DECLARE l_numeric number(8,2) DEFAULT 9.95;</span></span><br><span class="line"><span class="string">            3. DECLARE l_date date DEFAULT '</span><span class="number">1999</span><span class="number">-12</span><span class="number">-31</span><span class="string">';</span></span><br><span class="line"><span class="string">            4. DECLARE l_datetime datetime DEFAULT '</span><span class="number">1999</span><span class="number">-12</span><span class="number">-31</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">59</span><span class="string">';</span></span><br><span class="line"><span class="string">            5. DECLARE l_varchar varchar(255) DEFAULT '</span>This will <span class="keyword">not</span> be padded<span class="string">';</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Ⅱ. 变量赋值</span></span><br><span class="line"><span class="string">            SET 变量名 = 表达式值 [,variable_name = expression ...]</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Ⅲ. 用户变量</span></span><br><span class="line"><span class="string">            ⅰ. 在MySQL客户端使用用户变量</span></span><br><span class="line"><span class="string">                select '</span>hello<span class="string">' into @x;</span></span><br><span class="line"><span class="string">                set @x='</span>hello<span class="string">';</span></span><br><span class="line"><span class="string">            ⅱ. 在存储过程中使用用户变量</span></span><br><span class="line"><span class="string">                delimiter //</span></span><br><span class="line"><span class="string">                create procedure pr1 ()</span></span><br><span class="line"><span class="string">                begin</span></span><br><span class="line"><span class="string">                select @x;</span></span><br><span class="line"><span class="string">                set @x=2;</span></span><br><span class="line"><span class="string">                select @x;</span></span><br><span class="line"><span class="string">                end//</span></span><br><span class="line"><span class="string">                dilimiter ;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">        ①用户变量名一般以@开头</span></span><br><span class="line"><span class="string">        ②滥用用户变量会导致程序难以理解及管理        </span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    注释&#123;</span></span><br><span class="line"><span class="string">        MySQL存储过程可使用两种风格的注释</span></span><br><span class="line"><span class="string">            1）双模杠：该风格一般用于单行注释     --name</span></span><br><span class="line"><span class="string">            2）c风格：一般用于多行注释            /* yes */</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    流程控制&#123;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        if条件判断&#123;</span></span><br><span class="line"><span class="string">            if a &gt; 1 </span></span><br><span class="line"><span class="string">            then cmd1;</span></span><br><span class="line"><span class="string">            else cmd2;</span></span><br><span class="line"><span class="string">            enf if;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        while循环&#123;</span></span><br><span class="line"><span class="string">            while a &gt; 1</span></span><br><span class="line"><span class="string">            do cmd1;cmd2;</span></span><br><span class="line"><span class="string">            end while;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        until循环&#123;</span></span><br><span class="line"><span class="string">            // 它在执行操作后检查结果，而while则是执行前进行检查。</span></span><br><span class="line"><span class="string">            repeat cmd1; cmd2;</span></span><br><span class="line"><span class="string">            until a &gt; 1</span></span><br><span class="line"><span class="string">            end repeat;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        loop循环&#123;</span></span><br><span class="line"><span class="string">            /* loop循环不需要初始条件，这点和while 循环相似，同时和repeat循环一样不需要结束条件,</span></span><br><span class="line"><span class="string">            leave语句的意义是离开循环。*/</span></span><br><span class="line"><span class="string">            loop_table：loop cmd1;cmd2;</span></span><br><span class="line"><span class="string">            if a &gt; 1 </span></span><br><span class="line"><span class="string">            then leave loop_table;</span></span><br><span class="line"><span class="string">            end if;</span></span><br><span class="line"><span class="string">            end loop;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    基本函数&#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            字符串类型&#123;</span></span><br><span class="line"><span class="string">                CHARSET(str) //返回字串字符集</span></span><br><span class="line"><span class="string">                CONCAT (string2 [,... ]) //连接字串</span></span><br><span class="line"><span class="string">                INSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0</span></span><br><span class="line"><span class="string">                LCASE (string2 ) //转换成小写</span></span><br><span class="line"><span class="string">                LEFT (string2 ,length ) //从string2中的左边起取length个字符</span></span><br><span class="line"><span class="string">                LENGTH (string ) //string长度</span></span><br><span class="line"><span class="string">                LOAD_FILE (file_name ) //从文件读取内容</span></span><br><span class="line"><span class="string">                LOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置</span></span><br><span class="line"><span class="string">                LPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length</span></span><br><span class="line"><span class="string">                LTRIM (string2 ) //去除前端空格</span></span><br><span class="line"><span class="string">                REPEAT (string2 ,count ) //重复count次</span></span><br><span class="line"><span class="string">                REPLACE (str ,search_str ,replace_str ) //在str中用replace_str替换search_str</span></span><br><span class="line"><span class="string">                RPAD (string2 ,length ,pad) //在str后用pad补充,直到长度为length</span></span><br><span class="line"><span class="string">                RTRIM (string2 ) //去除后端空格</span></span><br><span class="line"><span class="string">                STRCMP (string1 ,string2 ) //逐字符比较两字串大小,</span></span><br><span class="line"><span class="string">                SUBSTRING (str , position [,length ]) //从str的position开始,取length个字符,</span></span><br><span class="line"><span class="string">                // 注：mysql中处理字符串时，默认第一个字符下标为1，即参数position必须大于等于1</span></span><br><span class="line"><span class="string">                TRIM([[BOTH|LEADING|TRAILING] [padding] FROM]string2) //去除指定位置的指定字符</span></span><br><span class="line"><span class="string">                UCASE (string2 ) //转换成大写</span></span><br><span class="line"><span class="string">                RIGHT(string2,length) //取string2最后length个字符</span></span><br><span class="line"><span class="string">                SPACE(count) //生成count个空格</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            数字类型&#123;</span></span><br><span class="line"><span class="string">                ABS (number2 ) //绝对值</span></span><br><span class="line"><span class="string">                BIN (decimal_number ) //十进制转二进制</span></span><br><span class="line"><span class="string">                CEILING (number2 ) //向上取整</span></span><br><span class="line"><span class="string">                CONV(number2,from_base,to_base) //进制转换</span></span><br><span class="line"><span class="string">                FLOOR (number2 ) //向下取整</span></span><br><span class="line"><span class="string">                FORMAT (number,decimal_places ) //保留小数位数</span></span><br><span class="line"><span class="string">                HEX (DecimalNumber ) //转十六进制</span></span><br><span class="line"><span class="string">                // 注：HEX()中可传入字符串，则返回其ASC11码，如HEX('</span><span class="keyword">DEF</span><span class="string">')返回4142143 也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19    </span></span><br><span class="line"><span class="string">                LEAST (number , number2 [,..]) //求最小值</span></span><br><span class="line"><span class="string">                MOD (numerator ,denominator ) //求余</span></span><br><span class="line"><span class="string">                POWER (number ,power ) //求指数</span></span><br><span class="line"><span class="string">                RAND([seed]) //随机数</span></span><br><span class="line"><span class="string">                ROUND (number [,decimals ]) //四舍五入,decimals为小数位数]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            日期时间类&#123;</span></span><br><span class="line"><span class="string">                ADDTIME (date2 ,time_interval ) //将time_interval加到date2</span></span><br><span class="line"><span class="string">                CONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区</span></span><br><span class="line"><span class="string">                CURRENT_DATE ( ) //当前日期</span></span><br><span class="line"><span class="string">                CURRENT_TIME ( ) //当前时间</span></span><br><span class="line"><span class="string">                CURRENT_TIMESTAMP ( ) //当前时间戳</span></span><br><span class="line"><span class="string">                DATE (datetime ) //返回datetime的日期部分</span></span><br><span class="line"><span class="string">                DATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间</span></span><br><span class="line"><span class="string">                DATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime</span></span><br><span class="line"><span class="string">                DATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间</span></span><br><span class="line"><span class="string">                DATEDIFF (date1 ,date2 ) //两个日期差</span></span><br><span class="line"><span class="string">                DAY (date ) //返回日期的天</span></span><br><span class="line"><span class="string">                DAYNAME (date ) //英文星期</span></span><br><span class="line"><span class="string">                DAYOFWEEK (date ) //星期(17),1为星期天</span></span><br><span class="line"><span class="string">                DAYOFYEAR (date ) //一年中的第几天</span></span><br><span class="line"><span class="string">                EXTRACT (interval_name FROM date ) //从date中提取日期的指定部分</span></span><br><span class="line"><span class="string">                MAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串</span></span><br><span class="line"><span class="string">                MAKETIME (hour ,minute ,second ) //生成时间串</span></span><br><span class="line"><span class="string">                MONTHNAME (date ) //英文月份名</span></span><br><span class="line"><span class="string">                NOW ( ) //当前时间</span></span><br><span class="line"><span class="string">                SEC_TO_TIME (seconds ) //秒数转成时间</span></span><br><span class="line"><span class="string">                STR_TO_DATE (string ,format ) //字串转成时间,以format格式显示</span></span><br><span class="line"><span class="string">                TIMEDIFF (datetime1 ,datetime2 ) //两个时间差</span></span><br><span class="line"><span class="string">                TIME_TO_SEC (time ) //时间转秒数]</span></span><br><span class="line"><span class="string">                WEEK (date_time [,start_of_week ]) //第几周</span></span><br><span class="line"><span class="string">                YEAR (datetime ) //年份</span></span><br><span class="line"><span class="string">                DAYOFMONTH(datetime) //月的第几天</span></span><br><span class="line"><span class="string">                HOUR(datetime) //小时</span></span><br><span class="line"><span class="string">                LAST_DAY(date) //date的月的最后日期</span></span><br><span class="line"><span class="string">                MICROSECOND(datetime) //微秒</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SQL执行计划explain&#123;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    EXPLAIN 语句主要是用于解析SQL执行计划，通过分析执行计划采取适当的优化方式提高SQL运行的效率。</span></span><br><span class="line"><span class="string">    EXPLAIN 语句输出通常包括id列，select_type，table，type，possible_keys，key等等列信息</span></span><br><span class="line"><span class="string">    MySQL 5.6.3后支持SELECT, DELETE, INSERT,REPLACE, and UPDATE.</span></span><br><span class="line"><span class="string">    EXPLAIN EXTENDED支持一些额外的执行计划相关的信息</span></span><br><span class="line"><span class="string">    EXPLAIN PARTITIONS支持基于分区表查询执行计划的相关信息</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    执行顺序id：&#123;</span></span><br><span class="line"><span class="string">        1)包含一组数字，表示查询中执行select子句或操作表的顺序</span></span><br><span class="line"><span class="string">        2)id如果相同，可以认为是一组，从上往下顺序执行；在所有组中，id值越大，优先级越高，越先执行</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    table：&#123;</span></span><br><span class="line"><span class="string">        1)从哪个表(表名)上输出行记录，</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    连接类型type：&#123;</span></span><br><span class="line"><span class="string">        1)system 表只有一行</span></span><br><span class="line"><span class="string">        2)const 表最多只有一行匹配，通用用于主键或者唯一索引比较时</span></span><br><span class="line"><span class="string">        3)eq_ref 每次与之前的表合并行都只在该表读取一行，这是除了system，const之外最好的一种，特点是使用=，而且索引的所有部分都参与join且索引是主键或非空唯一键的索引</span></span><br><span class="line"><span class="string">        4)ref 如果每次只匹配少数行，那就是比较好的一种，使用=或&lt;=&gt;，可以是左覆盖索引或非主键或非唯一键</span></span><br><span class="line"><span class="string">        5)fulltext 全文搜索</span></span><br><span class="line"><span class="string">        6)ref_or_null 与ref类似，但包括NULL</span></span><br><span class="line"><span class="string">        7)index_merge 表示出现了索引合并优化(包括交集，并集以及交集之间的并集)，但不包括跨表和全文索引。这个比较复杂，目前的理解是合并单表的范围索引扫描（如果成本估算比普通的range要更优的话）</span></span><br><span class="line"><span class="string">        8)unique_subquery 在in子查询中，就是value in (select...)把形如“select unique_key_column”的子查询替换。PS：所以不一定in子句中使用子查询就是低效的！</span></span><br><span class="line"><span class="string">        9)index_subquery 同上，但把形如”select non_unique_key_column“的子查询替换</span></span><br><span class="line"><span class="string">        10)range 常数值的范围</span></span><br><span class="line"><span class="string">        11)index </span></span><br><span class="line"><span class="string">                a.当查询是索引覆盖的，即所有数据均可从索引树获取的时候（Extra中有Using Index）；</span></span><br><span class="line"><span class="string">                b.以索引顺序从索引中查找数据行的全表扫描（无 Using Index）；</span></span><br><span class="line"><span class="string">                c.如果Extra中Using Index与Using Where同时出现的话，则是利用索引查找键值的意思；</span></span><br><span class="line"><span class="string">                d.如单独出现，则是用读索引来代替读行，但不用于查找</span></span><br><span class="line"><span class="string">        12)all 全表扫描</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    可能使用的索引possible_keys：&#123;</span></span><br><span class="line"><span class="string">        1)指出MySQL能使用哪个索引在表中找到行。</span></span><br><span class="line"><span class="string">        2)查询涉及到的字段上若存在索引则该索引将被列出，但不一定被查询使用。</span></span><br><span class="line"><span class="string">        3)如果改列为NULL，说明该查询不会使用到当前表上的相关索引，考虑是否有必要添加索引</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    实际使用的索引key：&#123;</span></span><br><span class="line"><span class="string">        1)显示MySQL在查询中实际使用的索引，若没有使用索引，显示为NULL</span></span><br><span class="line"><span class="string">        2)也可能存在key不等于possible_keys的情形，即possible_keys不适合提取所需的行</span></span><br><span class="line"><span class="string">        3)而查询所选择的列在使用其他索引时更高效</span></span><br><span class="line"><span class="string">        TIPS：查询中若使用了覆盖索引，则该索引仅出现在key列表中</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    索引字节数key_len：&#123;</span></span><br><span class="line"><span class="string">        1)表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ref：&#123;</span></span><br><span class="line"><span class="string">        1)表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    rows：&#123;</span></span><br><span class="line"><span class="string">        1)表示MySQL根据表统计信息及索引选用情况，估算的找到所需的记录所需要读取的行数</span></span><br><span class="line"><span class="string">        2)对于InnoDB，该值为预估，不一定精确</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Extra:&#123;</span></span><br><span class="line"><span class="string">        1)包含不适合在其他列中显示但十分重要的额外信息</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>



              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2020-10-19T06:10:05.832Z" itemprop="dateModified">上次更新：2020-10-19</time>
                <a href="/mysql/index.html" class="article-footer-next" title="概览"><span>下一页</span><i class="fa fa-chevron-right"></i></a>
              </footer>
              
<section id="comments">
  <div id="disqus_thread"></div>
</section>
<script>
  var disqus_shortname = 'toberoot';
  var disqus_url = 'http://www.toberoot.com/mysql/dba_mysql/tec/mysql_5.5_SQL.html';
  var disqus_title = "MySQL 5.5 SQL";
  var disqus_config = function(){
    this.language = 'zh';
  };
  (function(){
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              
<div id="carbonads">
<span>
<span class="carbon-wrap">
<a href="https://github.com/booboowei" class="carbon-img" target="_blank" rel="noopener sponsored external nofollow noreferrer">
    <img src="https://avatars2.githubusercontent.com/u/21328020?s=460&u=88cf6127c32932188f936d05636b7b0d36783ee1&v=4"
    alt="ads via Carbon" border="0" style="max-width: 130px;">
</a>
<a href="/about/" class="carbon-text" target="_blank" rel="noopener sponsored">除了自己的无知，我什么都不知道</a>
</span>
</span>

              <strong class="sidebar-title">目录</strong>
              
              <a href="#" id="article-toc-top">回到顶部</a>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner">
    <strong class="sidebar-title">开始使用</strong><a href="/mysql/index.html" class="sidebar-link">概览</a><strong class="sidebar-title">MySQL 基础</strong><a href="/mysql/booboo_mysql/index.html" class="sidebar-link">概览</a><a href="/mysql/booboo_mysql/00-MySQL管理课程简介.html" class="sidebar-link">课程简介</a><a href="/mysql/booboo_mysql/01-MySQL和MariaDB数据库介绍.html" class="sidebar-link">MySQL简介</a><a href="/mysql/booboo_mysql/02-结构化查询语言SQL介绍和基本操作.html" class="sidebar-link">SQL基础上</a><a href="/mysql/booboo_mysql/02-结构化查询语言SQL介绍和基本操作2.html" class="sidebar-link">SQL基础下</a><a href="/mysql/booboo_mysql/03-MySQL备份与恢复.html" class="sidebar-link">备份与恢复</a><a href="/mysql/booboo_mysql/03-MySQL逻辑架构和Innodb存储引擎.html" class="sidebar-link">存储引擎</a><a href="/mysql/booboo_mysql/04-MySQL复制replication.html" class="sidebar-link">主从复制</a><a href="/mysql/booboo_mysql/05-MySQL高可用HA.html" class="sidebar-link">高可用HA</a><a href="/mysql/booboo_mysql/06-MySQL压力测试工具sysbench.html" class="sidebar-link">压力测试</a><a href="/mysql/booboo_mysql/07-MySQL5.6一主多从半同步复制.html" class="sidebar-link">半同步复制</a><a href="/mysql/booboo_mysql/08-MySQL逻辑备份工具mysqldump&mysqlpump&mydumper.html" class="sidebar-link">逻辑备份工具对比</a><a href="/mysql/booboo_mysql/09-SQL考试.html" class="sidebar-link">基础考试</a><strong class="sidebar-title">MySQL 运维实践</strong><a href="/mysql/dba_mysql/index.html" class="sidebar-link">概览</a><a href="/mysql/dba_mysql/00-MySQL软件推荐.html" class="sidebar-link">MySQL软件推荐</a><a href="/mysql/dba_mysql/01-MySQL常用SQL.html" class="sidebar-link">MySQL常用SQL</a><a href="/mysql/dba_mysql/02-MySQL参数优化.html" class="sidebar-link">MySQL参数优化</a><a href="/mysql/dba_mysql/03-MySQL认证OCP.html" class="sidebar-link">MySQL认证OCP</a><a href="/mysql/dba_mysql/04-MySQL技术积累.html" class="sidebar-link">MySQL技术积累</a><a href="/mysql/dba_mysql/05-MySQL自动化管理.html" class="sidebar-link">MySQL自动化管理</a><a href="/mysql/dba_mysql/06-MySQL性能监控.html" class="sidebar-link">06-MySQL性能监控</a><a href="/mysql/dba_mysql/mycat/基于MyCat的MySQL高可用架构规划建议.html" class="sidebar-link">分布式架构规划</a><a href="/mysql/dba_mysql/mycat/基于MyCAT的分布式数据库架构.html" class="sidebar-link">分布式架构配置</a><strong class="sidebar-title">安全篇</strong><a href="/mysql/security/index.html" class="sidebar-link">概览</a><a href="/mysql/security/cis_mysql.html" class="sidebar-link">MySQL安全基线</a><strong class="sidebar-title">工具篇</strong><a href="/mysql/awesome-tools/index.html" class="sidebar-link">概览</a><a href="/mysql/awesome-tools/pt-archiver.html" class="sidebar-link">pt-archiver</a><a href="/mysql/awesome-tools/pt-percona_tookit.html" class="sidebar-link">percona_tookit</a><a href="/mysql/awesome-tools/workbench.html" class="sidebar-link">workbench</a><a href="/mysql/awesome-tools/otter/Otter实现上海美国异地机房双向同步.html" class="sidebar-link">otter</a>
  </div>
</aside>
    </div>
  </div>
</div>

    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      &copy; 2020 <a href="https://github.com/hexojs/hexo/graphs/contributors" rel="external nofollow noreferrer" target="_blank">魏亚萍</a><br>
      Documentation licensed under <a href="https://choosealicense.com/licenses/agpl-3.0/" rel="external nofollow noreferrer" target="_blank">GNU AGPLv3</a><br>
      备案号：沪ICP备2020026043号
    </div>
    <div id="footer-links">
      <a href="https://github.com/BoobooWei" rel="external nofollow noreferrer" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a>
      <a target="_blank" href="http://exam.toberoot.com/" rel="external nofollow noreferrer noopener">在线测评系统</a><
      <a href="https://www.huangjingxue.com/" rel="external nofollow noreferrer" target="_blank">衾袭</a><
      <a href="https://husky-wu.github.io/" rel="external nofollow noreferrer" target="_blank">明夋</a><
      <a href="https://footman-ljn.github.io/" rel="external nofollow noreferrer" target="_blank">伊斯</a>
    </div>
  </div>
  <br>
  <div class="inner">
  </div>

</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/api/" class="mobile-nav-link">MySQL8.0</a><a href="/mse/" class="mobile-nav-link">MSE</a><a href="/linux/" class="mobile-nav-link">Linux</a><a href="/mysql/" class="mobile-nav-link">MySQL</a><a href="/oracle/" class="mobile-nav-link">Oracle</a><a href="/nosql/" class="mobile-nav-link">NoSQL</a><a href="/devops/" class="mobile-nav-link">DevOps</a><a href="/git/" class="mobile-nav-link">Git</a><a href="/cloud/" class="mobile-nav-link">Cloud</a><a href="/news/" class="mobile-nav-link">News</a>
      <li class="mobile-nav-item">
        <a href="https://github.com/BoobooWei" class="mobile-nav-link" rel="external" target="_blank">GitHub</a>
      </li>
    </ul>
    
      <strong class="mobile-nav-title">开始使用</strong><a href="/mysql/index.html" class="mobile-nav-link">概览</a><strong class="mobile-nav-title">MySQL 基础</strong><a href="/mysql/booboo_mysql/index.html" class="mobile-nav-link">概览</a><a href="/mysql/booboo_mysql/00-MySQL管理课程简介.html" class="mobile-nav-link">课程简介</a><a href="/mysql/booboo_mysql/01-MySQL和MariaDB数据库介绍.html" class="mobile-nav-link">MySQL简介</a><a href="/mysql/booboo_mysql/02-结构化查询语言SQL介绍和基本操作.html" class="mobile-nav-link">SQL基础上</a><a href="/mysql/booboo_mysql/02-结构化查询语言SQL介绍和基本操作2.html" class="mobile-nav-link">SQL基础下</a><a href="/mysql/booboo_mysql/03-MySQL备份与恢复.html" class="mobile-nav-link">备份与恢复</a><a href="/mysql/booboo_mysql/03-MySQL逻辑架构和Innodb存储引擎.html" class="mobile-nav-link">存储引擎</a><a href="/mysql/booboo_mysql/04-MySQL复制replication.html" class="mobile-nav-link">主从复制</a><a href="/mysql/booboo_mysql/05-MySQL高可用HA.html" class="mobile-nav-link">高可用HA</a><a href="/mysql/booboo_mysql/06-MySQL压力测试工具sysbench.html" class="mobile-nav-link">压力测试</a><a href="/mysql/booboo_mysql/07-MySQL5.6一主多从半同步复制.html" class="mobile-nav-link">半同步复制</a><a href="/mysql/booboo_mysql/08-MySQL逻辑备份工具mysqldump&mysqlpump&mydumper.html" class="mobile-nav-link">逻辑备份工具对比</a><a href="/mysql/booboo_mysql/09-SQL考试.html" class="mobile-nav-link">基础考试</a><strong class="mobile-nav-title">MySQL 运维实践</strong><a href="/mysql/dba_mysql/index.html" class="mobile-nav-link">概览</a><a href="/mysql/dba_mysql/00-MySQL软件推荐.html" class="mobile-nav-link">MySQL软件推荐</a><a href="/mysql/dba_mysql/01-MySQL常用SQL.html" class="mobile-nav-link">MySQL常用SQL</a><a href="/mysql/dba_mysql/02-MySQL参数优化.html" class="mobile-nav-link">MySQL参数优化</a><a href="/mysql/dba_mysql/03-MySQL认证OCP.html" class="mobile-nav-link">MySQL认证OCP</a><a href="/mysql/dba_mysql/04-MySQL技术积累.html" class="mobile-nav-link">MySQL技术积累</a><a href="/mysql/dba_mysql/05-MySQL自动化管理.html" class="mobile-nav-link">MySQL自动化管理</a><a href="/mysql/dba_mysql/06-MySQL性能监控.html" class="mobile-nav-link">06-MySQL性能监控</a><a href="/mysql/dba_mysql/mycat/基于MyCat的MySQL高可用架构规划建议.html" class="mobile-nav-link">分布式架构规划</a><a href="/mysql/dba_mysql/mycat/基于MyCAT的分布式数据库架构.html" class="mobile-nav-link">分布式架构配置</a><strong class="mobile-nav-title">安全篇</strong><a href="/mysql/security/index.html" class="mobile-nav-link">概览</a><a href="/mysql/security/cis_mysql.html" class="mobile-nav-link">MySQL安全基线</a><strong class="mobile-nav-title">工具篇</strong><a href="/mysql/awesome-tools/index.html" class="mobile-nav-link">概览</a><a href="/mysql/awesome-tools/pt-archiver.html" class="mobile-nav-link">pt-archiver</a><a href="/mysql/awesome-tools/pt-percona_tookit.html" class="mobile-nav-link">percona_tookit</a><a href="/mysql/awesome-tools/workbench.html" class="mobile-nav-link">workbench</a><a href="/mysql/awesome-tools/otter/Otter实现上海美国异地机房双向同步.html" class="mobile-nav-link">otter</a>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>简体中文</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="zh-cn" selected>简体中文</option>
      
    </select>
  </div>
</nav>
  <!-- Scripts -->
<!-- Cookie -->
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<!-- build:js build/js/main.js -->

<script src="/js/lang_select.js"></script>


<script src="/js/toc.js"></script>


<script src="/js/mobile_nav.js"></script>

<!-- endbuild -->

<!-- Algolia -->

<!-- at the end of the BODY -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript">
document.getElementById('search-input-wrap').classList.add('on');
docsearch({
    apiKey: 'ad652bf20bcd81434ad119c8cf34722e',
    indexName: 'toberoot',
    inputSelector: '#search-input'
});
</script>

<!--   backup
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
<script type="text/javascript">
document.getElementById('search-input-wrap').classList.add('on');
docsearch({
  apiKey: 'ad652bf20bcd81434ad119c8cf34722e',
  indexName: 'toberoot',
  inputSelector: '#search-input'
});
</script>
-->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
<!-- Bootstrap JS -->



</body>
</html>