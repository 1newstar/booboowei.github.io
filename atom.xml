<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>BoobooWei</title>
  
  <subtitle>A fast, simple &amp; powerful blog framework powered by Node.js.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.toberoot.com/"/>
  <updated>2020-05-28T08:11:50.904Z</updated>
  <id>http://www.toberoot.com/</id>
  
  <author>
    <name>魏亚萍</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Oracle11g常用视图</title>
    <link href="http://www.toberoot.com/news/2020/05/29/tec-oracle/"/>
    <id>http://www.toberoot.com/news/2020/05/29/tec-oracle/</id>
    <published>2020-05-28T16:11:33.000Z</published>
    <updated>2020-05-28T08:11:50.904Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th>Oracle常用视图</th><th>说明</th></tr></thead><tbody><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_4045.htm#REFRN23442" rel="external nofollow noreferrer">dba_hist_snapshot</a></td><td>在工作负载存储库中显示有关快照的信息。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2085.htm" rel="external nofollow noreferrer">v$osstat</a></td><td>显示来自操作系统的系统利用率统计信息。每个系统统计信息返回一行          * PHYSICAL_MEMORY_BYTES:Total number of bytes of physical memory     * NUM_CPUS:Number of CPUs or processors available</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_1097.htm#REFRN30047" rel="external nofollow noreferrer">v$database</a></td><td>显示控制文件中有关数据库的信息。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2002.htm" rel="external nofollow noreferrer">v$instance</a></td><td>显示当前实例的状态。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_4212.htm" rel="external nofollow noreferrer">DBA_REGISTRY_HISTORY</a></td><td>提供有关在数据库上执行的升级，降级和重要补丁更新的信息。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2087.htm#REFRN30176" rel="external nofollow noreferrer">v$parameter</a>      <a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/initparams017.htm#REFRN10006" rel="external nofollow noreferrer">AUDIT_TRAIL</a>     <a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/initparams234.htm" rel="external nofollow noreferrer">SESSIONS</a>      <a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/initparams202.htm#REFRN10175" rel="external nofollow noreferrer">PROCESSES</a></td><td>显示有关该会话当前有效的初始化参数的信息。         <br/> * audit_trail:启用或禁用数据库审核     <br/>* sessions:指定系统中可以创建的最大会话数。     <br/>* processes:指定可以同时连接到Oracle的最大操作系统用户进程数。它的值应允许所有后台进程，例如锁，作业队列进程和并行执行进程。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_1016.htm#REFRN30011" rel="external nofollow noreferrer">V$ARCHIVED_LOG</a></td><td><code>V$ARCHIVED_LOG</code>显示控制文件中的存档日志信息，包括存档日志名称。成功归档或清除联机重做日志后，将插入归档日志记录（<code>NULL</code>如果清除了日志，则名称列）。如果日志被归档两次，就会出现带有两个相同的归档日志记录<code>THREAD#</code>，<code>SEQUENCE#</code>和<code>FIRST_CHANGE#</code>，但使用不同的名称。从备份集或副本还原存档日志时，以及使用RMAN  <code>COPY</code>命令创建日志副本时，也会插入存档日志记录。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2096.htm#REFRN30180" rel="external nofollow noreferrer">V$PGASTAT</a></td><td></td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_5081.htm#REFRN23302" rel="external nofollow noreferrer">dba_users</a></td><td><code>DBA_USERS</code> 描述数据库的所有用户。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_1158.htm#i1583352" rel="external nofollow noreferrer">DBA_OBJECTS</a></td><td><code>DBA_OBJECTS</code>描述数据库中的所有对象。          <code>V$LOCKED_OBJECT</code>列出系统上每个事务获取的所有锁。它显示哪些会话在什么对象和什么模式下持有DML锁（即TM类型的队列）。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_3016.htm" rel="external nofollow noreferrer">v$session</a></td><td>显示每个当前会话的会话信息。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2030.htm#REFRN30125" rel="external nofollow noreferrer">v$locked_object</a></td><td></td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_3118.htm#REFRN30295" rel="external nofollow noreferrer">v$undostat</a></td><td>显示统计数据的直方图以显示系统的运行状况。可用的统计信息包括撤消空间消耗，事务并发以及在实例中执行的查询的长度。您可以使用此视图来估计当前工作负载所需的撤消空间量。Oracle使用此视图来调整系统中的撤消使用情况。如果系统处于手动撤消管理模式，则该视图返回NULL值。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2031.htm" rel="external nofollow noreferrer">v$log</a></td><td>显示控制文件中的日志文件信息。          <strong>STATUS</strong>日志状态：          - <code>UNUSED</code>-在线重做日志从未写入过。这是刚刚添加的重做日志的状态，或者<code>RESETLOGS</code>不是当前重做日志时在之后的状态。     - <code>CURRENT</code>-当前重做日志。这意味着重做日志处于活动状态。重做日志可以打开或关闭。     - <code>ACTIVE</code>-日志处于活动状态，但不是当前日志。崩溃恢复需要它。它可能正在用于块恢复。它可能已存档，也可能未存档。     - <code>CLEARING</code>- <code>ALTER DATABASE CLEAR LOGFILE</code>语句后，日志将重新创建为空日志。清除日志后，状态变为<code>UNUSED</code>。     - <code>CLEARING_CURRENT</code>-当前日志正在清除关闭的线程。如果交换机出现故障，例如I / O错误写入新的日志头，则日志可以保持此状态。     - <code>INACTIVE</code>-实例恢复不再需要日志。它可能正在用于介质恢复。它可能已存档，也可能未存档。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_1105.htm" rel="external nofollow noreferrer">v$dataguard_status</a></td><td>显示最近写入警报日志或服务器进程跟踪文件的消息，这些消息与物理备用数据库或所有备用数据库类型的重做传输服务有关。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2050.htm" rel="external nofollow noreferrer">V$MANAGED_STANDBY</a></td><td>显示与Data Guard环境中的物理备用数据库有关的某些Oracle Database进程的当前状态信息。实例关闭后，该视图不会继续存在。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_1027.htm#REFRN30171" rel="external nofollow noreferrer">V$ASM_DISKGROUP</a></td><td>V$ASM_DISKGROUP 为节点上的ASM实例发现的每个ASM磁盘组显示一行。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2125.htm" rel="external nofollow noreferrer">v$recovery_file_dest</a></td><td>在快速恢复区域中显示有关磁盘配额和当前磁盘使用情况的信息。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_3194.htm#REFRN23076" rel="external nofollow noreferrer">DBA_FREE_SPACE</a></td><td>描述数据库中所有表空间的使用情况。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_5061.htm" rel="external nofollow noreferrer">dba_temp_files</a></td><td>DBA_TEMP_FILES 描述数据库中的所有临时文件（临时文件）。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_5060.htm#REFRN23287" rel="external nofollow noreferrer">dba_tablespaces</a></td><td>DBA_TABLESPACES 描述数据库中的所有表空间。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_3041.htm" rel="external nofollow noreferrer">gv$sort_segment</a></td><td>V$SORT_SEGMENT显示有关给定实例中每个排序段的信息。仅在表空间是TEMPORARY类型时更新视图。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_3114.htm" rel="external nofollow noreferrer">v$transaction</a></td><td>V$TRANSACTION 列出系统中的活动事务。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_1062.htm#REFRN30371" rel="external nofollow noreferrer">v$backup_set_details</a></td><td>备份信息10g 11g 12c</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Oracle常用视图&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://docs.oracle.com/cd/E11882_01/server.112
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Oracle" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Oracle/"/>
    
    
      <category term="oracle11g" scheme="http://www.toberoot.com/tags/oracle11g/"/>
    
  </entry>
  
  <entry>
    <title>如何将数据库技术短视频化？</title>
    <link href="http://www.toberoot.com/news/2020/05/24/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/05/24/tec-mysql/</id>
    <published>2020-05-23T17:47:33.000Z</published>
    <updated>2020-05-22T05:35:44.921Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="技术思考" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/%E6%8A%80%E6%9C%AF%E6%80%9D%E8%80%83/"/>
    
    
      <category term="紧急救援" scheme="http://www.toberoot.com/tags/%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4/"/>
    
      <category term="mysqlbinlog" scheme="http://www.toberoot.com/tags/mysqlbinlog/"/>
    
  </entry>
  
  <entry>
    <title>mysqlbinlog远程拉日志</title>
    <link href="http://www.toberoot.com/news/2020/05/22/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/05/22/tec-mysql/</id>
    <published>2020-05-21T17:47:33.000Z</published>
    <updated>2020-05-21T09:48:15.819Z</updated>
    
    <content type="html"><![CDATA[<h2 id="获取远程MySQL服务器的binlog日志"><a href="#获取远程MySQL服务器的binlog日志" class="headerlink" title="获取远程MySQL服务器的binlog日志"></a>获取远程MySQL服务器的binlog日志</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">--row格式的日志</span><br><span class="line">mysqlbinlog -vv -P 3306 -uxxxx -pxxxx -hxxxx.mysql.rds.aliyuncs.com --read-from-remote-server --start-datetime='2020-05-20 09:00:00' --stop-datetime='2020-05-20 11:00:00' --base64-output=DECODE-ROWS mysql-bin.000xxx &gt; xxxlog.sql</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;获取远程MySQL服务器的binlog日志&quot;&gt;&lt;a href=&quot;#获取远程MySQL服务器的binlog日志&quot; class=&quot;headerlink&quot; title=&quot;获取远程MySQL服务器的binlog日志&quot;&gt;&lt;/a&gt;获取远程MySQL服务器的binlog日志&lt;/
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="紧急救援" scheme="http://www.toberoot.com/tags/%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4/"/>
    
      <category term="mysqlbinlog" scheme="http://www.toberoot.com/tags/mysqlbinlog/"/>
    
  </entry>
  
  <entry>
    <title>rsync + inotify 实现实时同步</title>
    <link href="http://www.toberoot.com/news/2020/05/20/tec-linux/"/>
    <id>http://www.toberoot.com/news/2020/05/20/tec-linux/</id>
    <published>2020-05-20T11:03:00.000Z</published>
    <updated>2020-05-19T03:11:00.187Z</updated>
    
    <content type="html"><![CDATA[<!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --><ul><li><a href="#rsync介绍">rsync介绍</a>   <ul><li><a href="#rsync六种命令格式">RSYNC六种命令格式</a>   </li><li><a href="#rsync安装">RSYNC安装</a>   </li><li><a href="#rsync案例">RSYNC案例</a>   </li><li><a href="#rsync参数">RSYNC参数</a>   </li></ul></li><li><a href="#应用场景-linux系统下实现文件实时同步">应用场景-Linux系统下实现文件实时同步</a>   <ul><li><a href="#server端配置">Server端配置</a>   <ul><li><a href="#环境介绍">环境介绍</a>   </li><li><a href="#安装方式">安装方式</a>   </li><li><a href="#配置">配置</a>   </li><li><a href="#编写主配置文件-rsyncdconf">编写主配置文件 rsyncd.conf</a>   </li><li><a href="#编写用户认证文件">编写用户认证文件</a>   </li><li><a href="#启动服务">启动服务</a>   </li></ul></li><li><a href="#rsync客户端">rsync客户端</a>   <ul><li><a href="#安装方式">安装方式</a>   </li><li><a href="#验证">验证</a>   </li></ul></li><li><a href="#使用">使用</a>   <ul><li><a href="#检测创建事件">检测创建事件</a>   </li><li><a href="#检测删除事件">检测删除事件</a>   </li><li><a href="#编写实时同步脚本">编写实时同步脚本</a>   </li></ul></li><li><a href="#验证">验证</a>   </li></ul></li></ul><!-- /MDTOC --><h2 id="rsync介绍"><a href="#rsync介绍" class="headerlink" title="rsync介绍"></a>rsync介绍</h2><p>rsync，remote synchronize顾名思意就知道它是一款实现远程同步功能的软件，它在同步文件的同时，可以保持原来文件的权限、时间、软硬链接等附加信息。 rsync是用 “rsync 算法”提供了一个客户机和远程文件服务器的文件同步的快速方法，而且可以通过ssh方式来传输文件，这样其保密性也非常好，另外它还是免费的软件。</p><h3 id="RSYNC六种命令格式"><a href="#RSYNC六种命令格式" class="headerlink" title="RSYNC六种命令格式"></a>RSYNC六种命令格式</h3><p>Rsync的命令格式可以为以下六种：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync [OPTION]... SRC DEST</span><br><span class="line">　　rsync [OPTION]... SRC [USER@]HOST:DEST</span><br><span class="line">　　rsync [OPTION]... [USER@]HOST:SRC DEST</span><br><span class="line">　　rsync [OPTION]... [USER@]HOST::SRC DEST</span><br><span class="line">　　rsync [OPTION]... SRC [USER@]HOST::DEST</span><br><span class="line">　　rsync [OPTION]... rsync://[USER@]HOST[:PORT]/SRC [DEST]</span><br></pre></td></tr></table></figure><p>对应于以上六种命令格式，rsync有六种不同的工作模式：</p><ul><li>拷贝本地文件。当SRC和DES路径信息都不包含有单个冒号”:”分隔符时就启动这种工作模式。如：rsync -a /data /backup</li><li>使用一个远程shell程序(如rsh、ssh)来实现将本地机器的内容拷贝到远程机器。当DST路径地址包含单个冒号”:”分隔符时启动该模式。如：rsync -avz *.c foo:src</li><li>使用一个远程shell程序(如rsh、ssh)来实现将远程机器的内容拷贝到本地机器。当SRC地址路径包含单个冒号”:”分隔符时启动该模式。如：rsync -avz foo:src/bar /data</li><li>从远程rsync服务器中拷贝文件到本地机。当SRC路径信息包含”::”分隔符时启动该模式。如：rsync -av <a href="mailto:root@172.16.78.192" rel="external nofollow noreferrer">root@172.16.78.192</a>::www /databack</li><li>从本地机器拷贝文件到远程rsync服务器中。当DST路径信息包含”::”分隔符时启动该模式。如：rsync -av /databack <a href="mailto:root@172.16.78.192" rel="external nofollow noreferrer">root@172.16.78.192</a>::www</li><li>列远程机的文件列表。这类似于rsync传输，不过只要在命令中省略掉本地机信息即可。如：rsync -v rsync://172.16.78.192/www</li></ul><h3 id="RSYNC安装"><a href="#RSYNC安装" class="headerlink" title="RSYNC安装"></a>RSYNC安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#注：在debian、ubuntu 等在线安装方法；</span></span><br><span class="line">sudo apt-get install rsync</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#注：Fedora、Redhat 等在线安装方法；</span></span><br><span class="line">yum install rsync</span><br><span class="line"></span><br><span class="line"><span class="comment">#注：Fedora、Redhat 等rpm包安装方法；</span></span><br><span class="line">rpm -ivh rsync</span><br></pre></td></tr></table></figure><h3 id="RSYNC案例"><a href="#RSYNC案例" class="headerlink" title="RSYNC案例"></a>RSYNC案例</h3><p>在我们内部跳板机1：杭州节点（主）中，对应在“/etc/ssh/ssh_config.d”中配置了每个项目的ssh快捷登陆，所以后续我们只需要“ssh &lt;主机名&gt;”便能登陆到对应的目标服务器中。<br>但这里有个问题，我们在杭州节点（主）中，对应变更了“/etc/ssh/ssh_config.d”的配置，那其他跳板机怎么样同步更新呢？其实这里我们采用了rsync的方式来同步配置文件。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># rsync server配置</span></span><br><span class="line"><span class="comment"># 1.在内部跳板机1：杭州节点（主：srv-zy-ssh1）上，编辑配置文件/etc/rsyncd.conf</span></span><br><span class="line">uid=root</span><br><span class="line">git=root</span><br><span class="line">use chroot=no</span><br><span class="line">max connection=0</span><br><span class="line">port=873</span><br><span class="line">pid file=/var/<span class="built_in">log</span>/rsync/rsyncd.pid</span><br><span class="line">lock file=/var/<span class="built_in">log</span>/rsync/rsync.lock</span><br><span class="line"><span class="built_in">log</span> file=/var/<span class="built_in">log</span>/rsync/rsyncd.log</span><br><span class="line">motd file=/var/<span class="built_in">log</span>/rsync/rsyncd.motd</span><br><span class="line">strict modes=yes</span><br><span class="line">[sshconfig]</span><br><span class="line">uid=root</span><br><span class="line">git=root</span><br><span class="line">path=/etc/ssh/ssh_config.d/</span><br><span class="line">comment=rsync ssh_config</span><br><span class="line"><span class="built_in">read</span> only=<span class="literal">false</span></span><br><span class="line">list=<span class="literal">false</span></span><br><span class="line">host allow=ip1 ip2 ip3</span><br><span class="line"><span class="comment">#hosts deny=172.25.0.0/24</span></span><br><span class="line">auth users=sshconfig</span><br><span class="line">secrets file=/etc/rsyncd.passwd</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.编辑/etc/rsyncd.passwd 文件加入以下内容</span></span><br><span class="line">sshconfig:rsync20150128</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.赋权（必须600权限，否则报错）</span></span><br><span class="line">chmod 600 /etc/rsyncd.passwd</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.启动rsync</span></span><br><span class="line">rsync --daemon /etc/rsyncd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># rsync cilent配置</span></span><br><span class="line">分别在其他跳板机上面：</span><br><span class="line">内部跳板机2：青岛节点（备：srv-zy-ssh2）</span><br><span class="line">客户跳板机1：杭州节点（主：srv-zy-ssh3）</span><br><span class="line">客户跳板机2：青岛节点（备：srv-zy-ssh4）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑/etc/rsyncd.passwd 文件加入以下内容：</span></span><br><span class="line">sshconfig:rsync20150128</span><br><span class="line"></span><br><span class="line"><span class="comment"># 赋权（必须600权限，否则报错）:</span></span><br><span class="line">chmod 600 /etc/rsyncd.passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行同步命令：</span></span><br><span class="line">rsync -vzrtopg --delete --progress sshconfig@115.29.244.224::sshconfig /etc/ssh/ssh_config.d/ --password-file=/etc/rsyncd.passwd</span><br><span class="line">或者：</span><br><span class="line">rsync -avz --delete --progress sshconfig@115.29.244.224::sshconfig /etc/ssh/ssh_config.d/ --password-file=/etc/rsyncd.passwd</span><br></pre></td></tr></table></figure><h3 id="RSYNC参数"><a href="#RSYNC参数" class="headerlink" title="RSYNC参数"></a>RSYNC参数</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync参数的具体解释如下：</span><br><span class="line">-v, --verbose 详细模式输出</span><br><span class="line">-q, --quiet 精简输出模式</span><br><span class="line">-c, --checksum 打开校验开关，强制对文件传输进行校验</span><br><span class="line">-a, --archive 归档模式，表示以递归方式传输文件，并保持所有文件属性，等于-rlptgoD</span><br><span class="line">-r, --recursive 对子目录以递归模式处理</span><br><span class="line">-R, --relative 使用相对路径信息</span><br><span class="line">-b, --backup 创建备份，也就是对于目的已经存在有同样的文件名时，将老的文件重新命名为~filename。可以使用--suffix选项来指定不同的备份文件前缀。</span><br><span class="line">--backup-dir 将备份文件(如~filename)存放在在目录下。</span><br><span class="line">-suffix=SUFFIX 定义备份文件前缀</span><br><span class="line">-u, --update 仅仅进行更新，也就是跳过所有已经存在于DST，并且文件时间晚于要备份的文件。(不覆盖更新的文件)</span><br><span class="line">-l, --links 保留软链结</span><br><span class="line">-L, --copy-links 想对待常规文件一样处理软链结</span><br><span class="line">--copy-unsafe-links 仅仅拷贝指向SRC路径目录树以外的链结</span><br><span class="line">--safe-links 忽略指向SRC路径目录树以外的链结</span><br><span class="line">-H, --hard-links 保留硬链结 -p, --perms 保持文件权限</span><br><span class="line">-o, --owner 保持文件属主信息 -g, --group 保持文件属组信息</span><br><span class="line">-D, --devices 保持设备文件信息 -t, --<span class="built_in">times</span> 保持文件时间信息</span><br><span class="line">-S, --sparse 对稀疏文件进行特殊处理以节省DST的空间</span><br><span class="line">-n, --dry-run现实哪些文件将被传输</span><br><span class="line">-W, --whole-file 拷贝文件，不进行增量检测</span><br><span class="line">-x, --one-file-system 不要跨越文件系统边界</span><br><span class="line">-B, --block-size=SIZE 检验算法使用的块尺寸，默认是700字节</span><br><span class="line">-e, --rsh=COMMAND 指定使用rsh、ssh方式进行数据同步</span><br><span class="line">--rsync-path=PATH 指定远程服务器上的rsync命令所在路径信息</span><br><span class="line">-C, --cvs-exclude 使用和CVS一样的方法自动忽略文件，用来排除那些不希望传输的文件</span><br><span class="line">--existing 仅仅更新那些已经存在于DST的文件，而不备份那些新创建的文件</span><br><span class="line">--delete 删除那些DST中SRC没有的文件</span><br><span class="line">--delete-excluded 同样删除接收端那些被该选项指定排除的文件</span><br><span class="line">--delete-after 传输结束以后再删除</span><br><span class="line">--ignore-errors 及时出现IO错误也进行删除</span><br><span class="line">--max-delete=NUM 最多删除NUM个文件</span><br><span class="line">--partial 保留那些因故没有完全传输的文件，以是加快随后的再次传输</span><br><span class="line">--force 强制删除目录，即使不为空</span><br><span class="line">--numeric-ids 不将数字的用户和组ID匹配为用户名和组名</span><br><span class="line">--timeout=TIME IP超时时间，单位为秒</span><br><span class="line">-I, --ignore-times 不跳过那些有同样的时间和长度的文件</span><br><span class="line">--size-only 当决定是否要备份文件时，仅仅察看文件大小而不考虑文件时间</span><br><span class="line">--modify-window=NUM 决定文件是否时间相同时使用的时间戳窗口，默认为0</span><br><span class="line">-T --temp-dir=DIR 在DIR中创建临时文件</span><br><span class="line">--compare-dest=DIR 同样比较DIR中的文件来决定是否需要备份</span><br><span class="line">-P 等同于 --partial</span><br><span class="line">--progress 显示备份过程</span><br><span class="line">-z, --compress 对备份的文件在传输时进行压缩处理</span><br><span class="line">--exclude=PATTERN 指定排除不需要传输的文件模式</span><br><span class="line">--include=PATTERN 指定不排除而需要传输的文件模式</span><br><span class="line">--exclude-from=FILE 排除FILE中指定模式的文件</span><br><span class="line">--include-from=FILE 不排除FILE指定模式匹配的文件</span><br><span class="line">--version 打印版本信息</span><br><span class="line">--address 绑定到特定的地址</span><br><span class="line">--config=FILE 指定其他的配置文件，不使用默认的rsyncd.conf文件</span><br><span class="line">--port=PORT 指定其他的rsync服务端口</span><br><span class="line">--blocking-io 对远程shell使用阻塞IO</span><br><span class="line">-stats 给出某些文件的传输状态</span><br><span class="line">--progress 在传输时现实传输过程</span><br><span class="line">--<span class="built_in">log</span>-format=formAT 指定日志文件格式</span><br><span class="line">--password-file=FILE 从FILE中得到密码</span><br><span class="line">--bwlimit=KBPS 限制I/O带宽，KBytes per second</span><br><span class="line">-h, --<span class="built_in">help</span> 显示帮助信息</span><br></pre></td></tr></table></figure><h2 id="应用场景-Linux系统下实现文件实时同步"><a href="#应用场景-Linux系统下实现文件实时同步" class="headerlink" title="应用场景-Linux系统下实现文件实时同步"></a>应用场景-Linux系统下实现文件实时同步</h2><p>在我们的日常场景中经常会经常碰到文件共享同步的问题，比如：</p><ul><li>集群，提供高可用服务（需要网站代码或者目录实时同步，保证数据的一致性）</li><li>迁移数据 (实时增量传输)</li><li>文件备份（实时将数据备份到其他设备，防止数据丢失）</li></ul><p>我们针对以上场景在 Linux 系统下实现文件实时同步</p><h3 id="Server端配置"><a href="#Server端配置" class="headerlink" title="Server端配置"></a>Server端配置</h3><h4 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h4><p>修改：调整了目录顺序</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">操作系统：CentOS 6.8 rsync: rsync-3.0.6 (yum 源默认安装)</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/01.png" alt=""></p><h4 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h4><p>安装方式</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudoapt-get &#96;&#96;installrsync#debian、ubuntu 等在线安装方法；&#96;&#96;yum &#96;&#96;installrsync#Fedora、Redhat 等在线安装方法；&#96;&#96;rpm -ivh &#96;&#96;rsync# Fedora、Redhat 等rpm包安装方法；&#96;&#96;rpm -qa | &#96;&#96;greprsync# 查看安装的版本</span><br></pre></td></tr></table></figure><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>修改： 文件名缺少“d” 字符</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod 600 &#x2F;etc&#x2F;rsync.d&#x2F;rsyncd.conf</span><br><span class="line">chmod 600 &#x2F;etc&#x2F;rsync.d&#x2F;rsyncd.pass</span><br></pre></td></tr></table></figure><p>创建相关配置目录和文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir-p &#96;&#96;&#x2F;etc&#x2F;rsync&#96;&#96;.d  &#96;&#96;# rsync 配置文件目录，默认没有touch&#x2F;etc&#x2F;rsync&#96;&#96;.d&#96;&#96;&#x2F;rsyncd&#96;&#96;.conf &#96;&#96;# rsync服务端配置文件touch&#x2F;etc&#x2F;rsync&#96;&#96;.d&#96;&#96;&#x2F;rsyncd&#96;&#96;.pass &#96;&#96;# 客户端拉取文件时使用的用户密码chmod600 &#96;&#96;&#x2F;etc&#x2F;rsync&#96;&#96;.d&#96;&#96;&#x2F;rsyncd&#96;&#96;.confchmod600 &#96;&#96;&#x2F;etc&#x2F;rsync&#96;&#96;.d&#96;&#96;&#x2F;rsyncd&#96;&#96;.pass</span><br></pre></td></tr></table></figure><h4 id="编写主配置文件-rsyncd-conf"><a href="#编写主配置文件-rsyncd-conf" class="headerlink" title="编写主配置文件 rsyncd.conf"></a>编写主配置文件 rsyncd.conf</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim ``/etc/rsync``.d``/rsyncd``.conf</span><br></pre></td></tr></table></figure><p>（以下是配置文件）</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">log</span> file=/var/<span class="built_in">log</span>/rsyncd.log</span><br><span class="line"></span><br><span class="line">pid file=/var/run/rsyncd.pid</span><br><span class="line"></span><br><span class="line">lock file=/var/run/rsyncd.lock</span><br><span class="line"></span><br><span class="line">motd file = /etc/rsyncd/rsyncd.motd</span><br><span class="line"></span><br><span class="line">uid=root</span><br><span class="line"></span><br><span class="line">gid=root</span><br><span class="line"></span><br><span class="line">max connections=5</span><br><span class="line"></span><br><span class="line">hosts allow=192.168.1.167 <span class="comment"># 允许访问的IP地址，我这里填写的是测试的客户端地址</span></span><br><span class="line"></span><br><span class="line">hosts deny=*</span><br><span class="line"></span><br><span class="line">secrets file = /etc/rsync.d/rsyncd.pass</span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span> = /var/<span class="built_in">log</span>/rsyncd.log l</span><br><span class="line"></span><br><span class="line">og format = %t %a %m %f %b</span><br><span class="line"></span><br><span class="line">syslog facility = local3 timeout = 300</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[handbook]</span><br><span class="line"></span><br><span class="line">path=/handbook/</span><br><span class="line"></span><br><span class="line">comment= handbook</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> auth users=rsync</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/02.png" alt=""></p><p>详细参数可参考官网 <a href="https://download.samba.org/pub/rsync/rsyncd.conf.html" rel="external nofollow noreferrer">rsyncd.conf 介绍 </a></p><h4 id="编写用户认证文件"><a href="#编写用户认证文件" class="headerlink" title="编写用户认证文件"></a>编写用户认证文件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/rsync.d/rsyncd.pass</span><br></pre></td></tr></table></figure><p>修改：将代码模式去除，并添加文字描述</p><p>输入以下内容：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync:cloudcare</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/03.png" alt=""></p><h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync --daemon --config=/etc/rsync.d/rsyncd.conf</span><br></pre></td></tr></table></figure><p>修改： 添加了“确认服务启动” 标题，以及相关命令; 将 “注：rsync 服务默认端口是 873” 前移  确认服务启动</p><p>注：rsync 服务默认端口是 873</p><p>确认服务启动</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | greprsyncnetstat-nltp | grep7589</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/04.png" alt=""></p><h3 id="rsync客户端"><a href="#rsync客户端" class="headerlink" title="rsync客户端"></a>rsync客户端</h3><p>客户端配置很简单，只需要安装 <code>rsync</code> 工具即可</p><h4 id="安装方式-1"><a href="#安装方式-1" class="headerlink" title="安装方式"></a>安装方式</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># debian、ubuntu 等在线安装方法；</span></span><br><span class="line">sudo apt-get install rsync</span><br><span class="line"><span class="comment"># Fedora、Redhat 等在线安装方法；</span></span><br><span class="line">yum install rsync</span><br><span class="line"><span class="comment"># Fedora、Redhat 等rpm包安装方法；</span></span><br><span class="line">rpm -ivh rsync</span><br><span class="line"><span class="comment"># 查看安装的版本</span></span><br><span class="line">rpm -qa | greprsync</span><br></pre></td></tr></table></figure><h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><p>修改：添加了“示例内容”</p><p>示例： 将192.168.1.176 服务器上的 handbook （这里是定义的项目名称，可以参考rsync server 端的配置）项目同步到 192.168.1.167 的 /tmp 下</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync -avzP ``rsync``@192.168.1.176::handbook ``/tmp</span><br></pre></td></tr></table></figure><p>说明：<br>-a 参数，相当于-rlptgoD，<br>-r 是递归 -l 是链接文件，意思是拷贝链接文件；<br>-p 表示保持文件原有权限；<br>-t 保持文件原有时间；<br>-g 保持文件原有用户组；<br>-o 保持文件原有属主；<br>-D 相当于块设备文件；<br>-z 传输时压缩；<br>-P 传输进度；<br>-v 传输时的进度等信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![](2020-05-20-tec-linux&#x2F;05.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">详细参数可以参考: [RSYNC 参数 ](https:&#x2F;&#x2F;confluence.jiagouyun.com&#x2F;pages&#x2F;viewpage.action?pageId&#x3D;15503070)</span><br><span class="line"></span><br><span class="line">如果想每隔一段时间同步一次，可以配合 crontab 来实现；但是如果想实时同步，那就需要用到inotify 工具了</span><br><span class="line"></span><br><span class="line">## inotify</span><br><span class="line"></span><br><span class="line">&gt; inotify是Linux核心子系统之一，做为文件系统的附加功能，它可监控文件系统并将异动通知应用程序。摘自[维基百科](https:&#x2F;&#x2F;zh.wikipedia.org&#x2F;wiki&#x2F;Inotify) 可以配合rsync做实时同步，inotify 通过监控文件的变化，然后触发同步脚本，实现实时同步。</span><br><span class="line"></span><br><span class="line">### 修改添加了“实验目地” 和“拓扑环境” 两个项目</span><br><span class="line"></span><br><span class="line">### 实验目的</span><br><span class="line"></span><br><span class="line">将 192.168.1.167 的 &#x2F;handbook 目录下的内容实时同步到 192.168.1.176 定义的 “handbook” 目录下（实验环境依旧采用上面的老环境）</span><br><span class="line"></span><br><span class="line">### 拓扑环境</span><br><span class="line"></span><br><span class="line">![](2020-05-20-tec-linux&#x2F;06.png)</span><br><span class="line"></span><br><span class="line">### 安装</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;bash</span><br><span class="line">yum install-y inotify-tools</span><br></pre></td></tr></table></figure><p>注：inotify 其实不需要任何的配置，安装好之后默认有两个命令;</p><blockquote><p>inotifywait : 在被监控的文件或目录上等待特定文件系统事件（open close delete等）发生</p><p>inotifywatch :收集被监控的文件系统使用的统计数据,指文件系统事件发生的次数统计</p></blockquote><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="检测创建事件"><a href="#检测创建事件" class="headerlink" title="检测创建事件"></a>检测创建事件</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">inotifywait -mrq &#96;&#96;&#x2F;handbook&#x2F;cd&#x2F;handbook&#x2F;touch1</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/07.png" alt=""></p><h4 id="检测删除事件"><a href="#检测删除事件" class="headerlink" title="检测删除事件"></a>检测删除事件</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">inotifywait -mrq &#x2F;handbook --timefmt &quot;%d-%m-%y %H:%M&quot; --format &quot;%T %w%f 事 件 息: %e&quot; -e delete cd &#x2F;handbook&#x2F; rm -rf 1 4</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/08.png" alt=""></p><h4 id="编写实时同步脚本"><a href="#编写实时同步脚本" class="headerlink" title="编写实时同步脚本"></a>编写实时同步脚本</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">more rsync-handbook.sh</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">inotifywait -mrq &#x2F;handbook&#x2F; --format &quot;%w%f&quot; -e create,delete,moved_to,close_write | while read line do rsync -az &#x2F;handbook&#x2F; rsync@192.168.1.176::handbook --password-file&#x3D;&#x2F;root&#x2F;handbook.pw done</span><br></pre></td></tr></table></figure><p><em>注： 其中–password-file 是指定 <code>handbook</code>模块认用户认证的密码文件</em></p><h3 id="验证-1"><a href="#验证-1" class="headerlink" title="验证"></a>验证</h3><p><img src="2020-05-20-tec-linux/09.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#rsync介绍&quot;&gt;rsync介绍&lt;/a&gt;   &lt;ul&gt;
&lt;li&gt;&lt;a hr
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Linux" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.toberoot.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>记一次grep命令常用方法带文件名和行数</title>
    <link href="http://www.toberoot.com/news/2020/05/19/tec-linux/"/>
    <id>http://www.toberoot.com/news/2020/05/19/tec-linux/</id>
    <published>2020-05-19T10:24:00.000Z</published>
    <updated>2020-05-19T02:41:42.544Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>找到指定目录中的所有文件中包含字符<code>nav-item dropdown</code>的文件和行数。</p><h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for i in $(find `pwd` -type f); do grep -H -n "2020-05-19" $i; done 2&gt; /dev/null</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;需求&quot;&gt;&lt;a href=&quot;#需求&quot; class=&quot;headerlink&quot; title=&quot;需求&quot;&gt;&lt;/a&gt;需求&lt;/h2&gt;&lt;p&gt;找到指定目录中的所有文件中包含字符&lt;code&gt;nav-item dropdown&lt;/code&gt;的文件和行数。&lt;/p&gt;
&lt;h2 id=&quot;命令&quot;
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Linux" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.toberoot.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux系统一次性同步时间</title>
    <link href="http://www.toberoot.com/news/2020/05/14/tec-linux/"/>
    <id>http://www.toberoot.com/news/2020/05/14/tec-linux/</id>
    <published>2020-05-13T16:30:00.000Z</published>
    <updated>2020-05-13T08:31:58.187Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>测试服务器物理时间和系统时间都不正确，需要调整</p></blockquote><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装 ntp </span></span><br><span class="line">yum install -y ntp</span><br><span class="line"><span class="comment"># 同步阿里云时间同步服务器</span></span><br><span class="line">ntpdate ntp1.aliyun.com</span><br><span class="line"><span class="comment"># 物理时间同步系统时间</span></span><br><span class="line">hwclock -w</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;测试服务器物理时间和系统时间都不正确，需要调整&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;步骤&quot;&gt;&lt;a href=&quot;#步骤&quot; class=&quot;headerlink&quot; title=&quot;步骤&quot;&gt;&lt;/a&gt;步骤&lt;/h2&gt;&lt;figure class=&quot;
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Linux" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Linux/"/>
    
    
      <category term="CentOS" scheme="http://www.toberoot.com/tags/CentOS/"/>
    
      <category term="ntp" scheme="http://www.toberoot.com/tags/ntp/"/>
    
  </entry>
  
  <entry>
    <title>制作RedHat教学系统装机U盘</title>
    <link href="http://www.toberoot.com/news/2020/05/13/tec-redhat/"/>
    <id>http://www.toberoot.com/news/2020/05/13/tec-redhat/</id>
    <published>2020-05-13T15:33:00.000Z</published>
    <updated>2020-05-13T07:35:23.562Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>红帽官方教学系统</p></blockquote><h2 id="格式化u盘"><a href="#格式化u盘" class="headerlink" title="格式化u盘"></a>格式化u盘</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@foundation0 ~]# mount |tail -n 1</span><br><span class="line">/dev/sdb1 on /run/media/kiosk/U type vfat (rw,nosuid,nodev,relatime,uid=1000,gid=1000,fmask=0022,dmask=0077,codepage=437,iocharset=ascii,shortname=mixed,showexec,utf8,flush,errors=remount-ro,uhelper=udisks2)</span><br><span class="line">[root@foundation0 ~]# umount /dev/sdb1</span><br><span class="line">[root@foundation0 ~]# partprobe /dev/sdb1</span><br><span class="line">[root@foundation0 ~]# mkfs.ext4 /dev/sdb1</span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS type: Linux</span><br><span class="line">Block size=4096 (log=2)</span><br><span class="line">Fragment size=4096 (log=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">932064 inodes, 3722784 blocks</span><br><span class="line">186139 blocks (5.00%) reserved for the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=2151677952</span><br><span class="line">114 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8176 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208</span><br><span class="line"></span><br><span class="line">Allocating group tables: done                            </span><br><span class="line">Writing inode tables: done                            </span><br><span class="line">Creating journal (32768 blocks): done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br></pre></td></tr></table></figure><h2 id="制作u盘启动"><a href="#制作u盘启动" class="headerlink" title="制作u盘启动"></a>制作u盘启动</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@foundation0 ~]# rht-usb usbformat /dev/sdb1</span><br><span class="line">INFO     Configuration file: /root/.icrm/config.yml</span><br><span class="line">INFO     Formatting USB Device: /dev/sdb1</span><br><span class="line">Confirm reformatting /dev/sdb1 (y/N) y</span><br><span class="line">INFO     mkfs.ext4 64-bit support</span><br><span class="line">INFO     /dev/sdb1: format OK</span><br><span class="line">INFO     Appear to have properly formatted USB device.</span><br><span class="line"></span><br><span class="line">[root@foundation0 ~]# cd /home/kiosk/booboo/cache</span><br><span class="line">[root@foundation0 cache]# ll</span><br><span class="line">total 4038772</span><br><span class="line">-rw------- 1 kiosk kiosk      27967 Mar  3  2016 ClassPrep-7.x-4.r35344.txt</span><br><span class="line">-rw------- 1 kiosk kiosk      16186 Mar  3  2016 ClassroomReset-7.x-4.r35344.txt</span><br><span class="line">-rw------- 1 kiosk kiosk      38605 Mar  3  2016 ClassroomSetup-7.x-4.r35344.txt</span><br><span class="line">-rw------- 1 kiosk kiosk      27054 Mar  3  2016 ClassroomTroubleshooting-7.x-4.r35344.txt</span><br><span class="line">-rw------- 1 kiosk kiosk      75892 Mar  3  2016 foundation0-config-7.x-4.r35344.noarch.rpm</span><br><span class="line">-rw------- 1 kiosk kiosk      27568 Mar  3  2016 foundation-config-7.x-4.r35344.noarch.rpm</span><br><span class="line">-rw------- 1 kiosk kiosk     189984 Mar  3  2016 redhat-survey-7.x-55.1.noarch.rpm</span><br><span class="line">-rw------- 1 kiosk kiosk   91254784 Mar  4  2016 rhci-foundation-7.2-4.r35344.iso</span><br><span class="line">-rw------- 1 kiosk kiosk       2775 May  9 11:02 RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf</span><br><span class="line">-rw------- 1 kiosk kiosk     621805 Oct 20  2014 RHEL7和CentOS7打开屏幕VNC.pdf</span><br><span class="line">-rw------- 1 kiosk kiosk 4043309056 Mar  4  2016 rhel-server-7.2-x86_64-dvd.iso</span><br><span class="line">-rw------- 1 kiosk kiosk      96050 Mar  3  2016 rht-usb-7.x-4.r35344</span><br><span class="line"></span><br><span class="line">[root@foundation0 cache]# vim /root/.icrm/config.yml</span><br><span class="line">---</span><br><span class="line">repository: /root/.icrm/repository</span><br><span class="line">repository: /home/kiosk/booboo/cache</span><br><span class="line"></span><br><span class="line">[root@foundation0 cache]# rht-usb verify *.icmf</span><br><span class="line">INFO     Configuration file: /root/.icrm/config.yml</span><br><span class="line">INFO     Verifying Cache Directory: /home/kiosk/booboo/cache</span><br><span class="line"></span><br><span class="line">Verifying manifest file RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf</span><br><span class="line">  Publish date: 2016-02-24 20:43:25</span><br><span class="line">  type        md5sum  artifact-name</span><br><span class="line">  ----------- ------- -----------------------------------------------</span><br><span class="line">  content     CORRUPT rhel-server-7.2-x86_64-dvd.iso</span><br><span class="line">  content     GOODSUM foundation-config-7.x-4.r35344.noarch.rpm</span><br><span class="line">  content     GOODSUM foundation0-config-7.x-4.r35344.noarch.rpm</span><br><span class="line">  content     GOODSUM redhat-survey-7.x-55.1.noarch.rpm</span><br><span class="line">  content     GOODSUM rhci-foundation-7.2-4.r35344.iso</span><br><span class="line">  content     GOODSUM rht-usb-7.x-4.r35344</span><br><span class="line">  content     GOODSUM ClassroomSetup-7.x-4.r35344.txt</span><br><span class="line">  content     GOODSUM ClassroomReset-7.x-4.r35344.txt</span><br><span class="line">  content     GOODSUM ClassroomTroubleshooting-7.x-4.r35344.txt</span><br><span class="line">  content     GOODSUM ClassPrep-7.x-4.r35344.txt</span><br><span class="line">  content     GOODSUM RHEL7和CentOS7打开屏幕VNC.pdf</span><br><span class="line">=====================================================================</span><br><span class="line">WARNING  Manifest RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf failed.</span><br><span class="line"></span><br><span class="line">WARNING  Verification FAILED - look above for problem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@foundation0 cache]# rht-usb usbadd RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf</span><br><span class="line">INFO     Configuration file: /root/.icrm/config.yml</span><br><span class="line">INFO     Adding to USB: RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf</span><br><span class="line">INFO     New files needed space is 3.9G out of 3.9G</span><br><span class="line">INFO     Calculation finds we need: 4135687726 bytes (3.9G)</span><br><span class="line">INFO     USB space Total: 14.2G  Used: 35.5M  Free: 13.4G</span><br><span class="line">INFO     Starting copy of RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf</span><br><span class="line">INFO     Copying artifact: rhel-server-7.2-x86_64-dvd.iso</span><br><span class="line">INFO     Copying /home/kiosk/booboo/cache/rhel-server-7.2-x86_64-dvd.iso (3.8G) to /tmp/tmpKRYNm9/rhel7.2/x86_64/isos/rhel-server-7.2-x86_64-dvd.iso</span><br><span class="line"></span><br><span class="line">rht-usb usbmkboot</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;红帽官方教学系统&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;格式化u盘&quot;&gt;&lt;a href=&quot;#格式化u盘&quot; class=&quot;headerlink&quot; title=&quot;格式化u盘&quot;&gt;&lt;/a&gt;格式化u盘&lt;/h2&gt;&lt;figure class=&quot;hig
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="RedHat" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/RedHat/"/>
    
    
      <category term="RedHat" scheme="http://www.toberoot.com/tags/RedHat/"/>
    
  </entry>
  
  <entry>
    <title>MySQL8.0.16使用pt-online-schema-change在线添加索引报错处理</title>
    <link href="http://www.toberoot.com/news/2020/05/12/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/05/12/tec-mysql/</id>
    <published>2020-05-12T12:59:00.000Z</published>
    <updated>2020-05-12T05:43:47.631Z</updated>
    
    <content type="html"><![CDATA[<!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --><ul><li><a href="#在线mysql80结构变更问题排查">在线MySQL8.0结构变更问题排查</a>   <ul><li><a href="#报错明细">报错明细</a>   </li><li><a href="#解决方法">解决方法</a>   </li><li><a href="#测试环境">测试环境</a>   <ul><li><a href="#mysql测试数据">MySQL测试数据</a>   </li><li><a href="#pt-online-ddl">pt-online-ddl</a>   </li><li><a href="#执行结果">执行结果</a>   </li></ul></li><li><a href="#总结">总结</a>   </li></ul></li></ul><!-- /MDTOC --><h1 id="在线MySQL8-0结构变更问题排查"><a href="#在线MySQL8-0结构变更问题排查" class="headerlink" title="在线MySQL8.0结构变更问题排查"></a>在线MySQL8.0结构变更问题排查</h1><table><thead><tr><th align="left">软件</th><th align="left">版本</th></tr></thead><tbody><tr><td align="left">mysql-server</td><td align="left">8.0.16</td></tr><tr><td align="left">pt-tools</td><td align="left">3.2.0</td></tr></tbody></table><h2 id="报错明细"><a href="#报错明细" class="headerlink" title="报错明细"></a>报错明细</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@node2 install]<span class="comment"># pt-online-schema-change --port=3306 --host=localhost --user=root --password=xxx --alter="add index TMS_LEG_IDS (ID,CHANGE_ORG_ID,FROM_RECEIVER_ID,TO_RECEIVER_ID,TO_REGIONZONE_ID)" D=wlyotwb,t=tms_leg_test --no-version-check --execute --charset=utf8</span></span><br><span class="line">No slaves found.  See --recursion-method <span class="keyword">if</span> host node2 has slaves.</span><br><span class="line">Not checking slave lag because no slaves were found and --check-slave-lag was not specified.</span><br><span class="line">Operation, tries, <span class="built_in">wait</span>:</span><br><span class="line">  analyze_table, 10, 1</span><br><span class="line">  copy_rows, 10, 0.25</span><br><span class="line">  create_triggers, 10, 1</span><br><span class="line">  drop_triggers, 10, 1</span><br><span class="line">  swap_tables, 10, 1</span><br><span class="line">  update_foreign_keys, 10, 1</span><br><span class="line">There is an error <span class="keyword">in</span> MySQL that makes the server to die when trying to rename a table with FKs. See https://bugs.mysql.com/bug.php?id=96145</span><br><span class="line">Since pt-online-schema change needs to rename the old &lt;-&gt; new tables as the final step, and the requested table has FKs, it cannot be executed under the current MySQL version</span><br></pre></td></tr></table></figure><p><a href="https://jira.percona.com/browse/PT-1782" rel="external nofollow noreferrer">https://jira.percona.com/browse/PT-1782</a></p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><ul><li>pt-tools软件版本使用 <code>3.0.13</code></li></ul><p>或者</p><ul><li><code>mysql-server</code>版本升级到 <code>8.0.20</code></li></ul><h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><h3 id="MySQL测试数据"><a href="#MySQL测试数据" class="headerlink" title="MySQL测试数据"></a>MySQL测试数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> root@<span class="string">'localhost'</span> <span class="keyword">identified</span> <span class="keyword">WITH</span> mysql_native_password <span class="keyword">by</span> <span class="string">'Zyadmin123'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> booboo;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> booboo.t1 (<span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> booboo.t1 <span class="keyword">values</span> (<span class="number">1</span>);</span><br></pre></td></tr></table></figure><h3 id="pt-online-ddl"><a href="#pt-online-ddl" class="headerlink" title="pt-online-ddl"></a>pt-online-ddl</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum localinstall -y percona-toolkit-3.2.0-1.el7.x86_64.rpm</span><br><span class="line">pt-online-schema-change --port=3306 --host=localhost --user=root --password=Zyadmin123 --alter=<span class="string">"add column name varchar(22)"</span> D=booboo,t=t1 --no-version-check --execute --charset=utf8</span><br></pre></td></tr></table></figure><h3 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@node2 install]<span class="comment"># pt-online-schema-change --port=3306 --host=localhost --user=root --password=Zyadmin123 --alter="add column name varchar(22)" D=booboo,t=t1 --no-version-check --execute --charset=utf8</span></span><br><span class="line">No slaves found.  See --recursion-method <span class="keyword">if</span> host node2 has slaves.</span><br><span class="line">Not checking slave lag because no slaves were found and --check-slave-lag was not specified.</span><br><span class="line">Operation, tries, <span class="built_in">wait</span>:</span><br><span class="line">  analyze_table, 10, 1</span><br><span class="line">  copy_rows, 10, 0.25</span><br><span class="line">  create_triggers, 10, 1</span><br><span class="line">  drop_triggers, 10, 1</span><br><span class="line">  swap_tables, 10, 1</span><br><span class="line">  update_foreign_keys, 10, 1</span><br><span class="line">Altering `booboo`.`t1`...</span><br><span class="line">Creating new table...</span><br><span class="line">Created new table booboo._t1_new OK.</span><br><span class="line">Altering new table...</span><br><span class="line">Altered `booboo`.`_t1_new` OK.</span><br><span class="line">2020-05-12T21:26:08 Creating triggers...</span><br><span class="line">2020-05-12T21:26:08 Created triggers OK.</span><br><span class="line">2020-05-12T21:26:08 Copying approximately 1 rows...</span><br><span class="line">2020-05-12T21:26:08 Copied rows OK.</span><br><span class="line">2020-05-12T21:26:08 Analyzing new table...</span><br><span class="line">2020-05-12T21:26:09 Swapping tables...</span><br><span class="line">2020-05-12T21:26:09 Swapped original and new tables OK.</span><br><span class="line">2020-05-12T21:26:09 Dropping old table...</span><br><span class="line">2020-05-12T21:26:09 Dropped old table `booboo`.`_t1_old` OK.</span><br><span class="line">2020-05-12T21:26:09 Dropping triggers...</span><br><span class="line">2020-05-12T21:26:09 Dropped triggers OK.</span><br><span class="line">Successfully altered `booboo`.`t1`.</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>不同的数据库版本对应的pt工具版本会有区别，具体可以访问<a href="https://www.percona.com/doc/percona-toolkit/LATEST/index.html" rel="external nofollow noreferrer">percona-toolkit</a></p><h3 id="v3-2-0-released-2019-04-20"><a href="#v3-2-0-released-2019-04-20" class="headerlink" title="v3.2.0 released 2019-04-20"></a>v3.2.0 released 2019-04-20</h3><p>Improvements:</p><ul><li><a href="https://jira.percona.com/browse/PT-1773" rel="external nofollow noreferrer">PT-1773</a>: Don’t make the foreign key check in <code>pt-online-schema-change</code> if not needed.</li><li><a href="https://jira.percona.com/browse/PT-1757" rel="external nofollow noreferrer">PT-1757</a>: <code>pt-table-checksum</code> can now handle small tables as a single chunk.</li><li><a href="https://jira.percona.com/browse/PT-1813" rel="external nofollow noreferrer">PT-1813</a>: MariaDB 10.4 is now supported.</li></ul><p>Bug fixes:</p><ul><li><a href="https://jira.percona.com/browse/PT-1782" rel="external nofollow noreferrer">PT-1782</a>: <code>pt-online-schema-change</code> declined to handle tables because of foreign keys even when there were no foreign keys with some MariaDB 10.2 and MySQL 8 versions.</li><li><a href="https://jira.percona.com/browse/PT-1759" rel="external nofollow noreferrer">PT-1759</a>: <code>pt-stalk</code> with <code>--mysql-only</code> option didn’t collect MySQL Status variables.</li><li><a href="https://jira.percona.com/browse/PT-1802" rel="external nofollow noreferrer">PT-1802</a>: <code>pt-online-schema-change</code> didn’t handle self-referencing foreign keys properly which caused an unnecessarily high resource consumption.</li><li><a href="https://jira.percona.com/browse/PT-1766" rel="external nofollow noreferrer">PT-1766</a>: <code>pt-table-checksum</code> <code>DIFF_ROWS</code> was not computed correctly.</li><li><a href="https://jira.percona.com/browse/PT-1760" rel="external nofollow noreferrer">PT-1760</a>: <code>pt-online-schema-change</code> regression caused it to hang for a stopped replica when using replication channels on the slave.</li><li><a href="https://jira.percona.com/browse/PT-1707" rel="external nofollow noreferrer">PT-1707</a>: A number of the Percona Toolkit tools failed to operate in the IPv6 environment if the host address specified as a parameter was not enclosed in square brackets.</li><li><a href="https://jira.percona.com/browse/PT-1502" rel="external nofollow noreferrer">PT-1502</a>: <code>pt-online-schema-change</code> was not recognizing the slave with multi-source replication active.</li><li><a href="https://jira.percona.com/browse/PT-1824" rel="external nofollow noreferrer">PT-1824</a>: <code>pt-online-schema-change</code> allowed the name of a constraint to exceed 64 characters when <code>--alter-foreign-keys-method=rebuild_constraints</code> was used. (Thank you, Iwo Panowicz.)</li><li><a href="https://jira.percona.com/browse/PT-1765" rel="external nofollow noreferrer">PT-1765</a>: Documentation for <code>DIFF_ROWS</code> doesn’t exist.</li><li><a href="https://jira.percona.com/browse/PT-297" rel="external nofollow noreferrer">PT-297</a>: <code>pt-online-schema-change</code> could break replication.</li><li><a href="https://jira.percona.com/browse/PT-1768" rel="external nofollow noreferrer">PT-1768</a>: Source code for <code>src/go/pt-mongodb-query-digest/pt-mongodb-query-digest</code> was missing in the official source tar ball.</li><li><a href="https://jira.percona.com/browse/PT-1576" rel="external nofollow noreferrer">PT-1576</a>: <code>pt-stalk</code> with ``–mysql-only<code>option was not adding MySQL</code>processlist` information to the output file.</li><li><a href="https://jira.percona.com/browse/PT-1793" rel="external nofollow noreferrer">PT-1793</a>: <code>pt-query-digest</code> was unable to handle the year 2020 because of wrong <code>tcpdump</code> parsing. (Thank you, Kei Tsuchiya.)</li></ul><h3 id="v3-0-13-released-2019-01-03"><a href="#v3-0-13-released-2019-01-03" class="headerlink" title="v3.0.13 released 2019-01-03"></a>v3.0.13 released 2019-01-03</h3><p>Improvements</p><ul><li><a href="https://jira.percona.com/browse/PT-1340" rel="external nofollow noreferrer">PT-1340</a>: <code>pt-stalk</code> now doesn’t call <code>mysqladmin debug</code> command by default to avoid flooding in the error log when not needed. <code>CMD_MYSQLADMIN=&quot;mysqladmin debug&quot;</code> environment variable reverts <code>pt-stalk</code> to the previous way of operation.</li><li><a href="https://jira.percona.com/browse/PT-1637" rel="external nofollow noreferrer">PT-1637</a>: A new <code>--fail-on-stopped-replication</code> option allows <code>pt-table-checksum</code> to detect failing slave nodes.</li></ul><p>Fixed bugs</p><ul><li><a href="https://jira.percona.com/browse/PT-1673" rel="external nofollow noreferrer">PT-1673</a>: <code>pt-show-grants</code> was incompatible with MariaDB 10+ (thanks <a href="https://github.com/pysysops" rel="external nofollow noreferrer">Tim Birkett</a>)</li><li><a href="https://jira.percona.com/browse/PT-1638" rel="external nofollow noreferrer">PT-1638</a>: <code>pt-online-schema-change</code> was erroneously taking MariaDB 10.x for MySQL 8.0 and rejecting to work with it to avoid the upstream bug <a href="https://bugs.mysql.com/bug.php?id=89441" rel="external nofollow noreferrer">#89441</a> scope.</li><li><a href="https://jira.percona.com/browse/PT-1616" rel="external nofollow noreferrer">PT-1616</a>: <code>pt-table-checksum</code> failed to resume on large tables with binary strings containing invalid UTF-8 characters.</li><li><a href="https://jira.percona.com/browse/PT-1573" rel="external nofollow noreferrer">PT-1573</a>: <code>pt-query-digest</code> didn’t work in case of <code>log_timestamps = SYSTEM</code> my.cnf option.</li><li><a href="https://jira.percona.com/browse/PT-1114" rel="external nofollow noreferrer">PT-1114</a>: <code>pt-table-checksum</code> failed when the table was empty.</li><li><a href="https://jira.percona.com/browse/PT-157" rel="external nofollow noreferrer">PT-157</a>: Specifying a non-primary key index with the <code>i</code> part of the <code>--source</code> argument made <code>pt-archiver</code> to ignore the <code>--primary-key-only</code> option presence.</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#在线mysql80结构变更问题排查&quot;&gt;在线MySQL8.0结构变更问题排查
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="在线DDL" scheme="http://www.toberoot.com/tags/%E5%9C%A8%E7%BA%BFDDL/"/>
    
      <category term="阿里云" scheme="http://www.toberoot.com/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
      <category term="pt-online-schema-change" scheme="http://www.toberoot.com/tags/pt-online-schema-change/"/>
    
      <category term="Percona" scheme="http://www.toberoot.com/tags/Percona/"/>
    
  </entry>
  
  <entry>
    <title>数据库大表常用操作耗时记录</title>
    <link href="http://www.toberoot.com/news/2020/05/11/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/05/11/tec-mysql/</id>
    <published>2020-05-11T10:28:11.000Z</published>
    <updated>2020-05-11T04:05:53.794Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th align="center">大表操作</th><th align="center">表大小</th><th align="center">索引大小</th><th align="center">总大小</th><th align="center">操作行数</th><th align="center">实例规格</th><th align="center">耗时</th><th align="center">资源影响</th></tr></thead><tbody><tr><td align="center">表大小</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">2.73 亿行</td><td align="center">8核32G RDS</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">创建索引</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">4 亿</td><td align="center">8核32G RDS</td><td align="center">2小时</td><td align="center"></td></tr><tr><td align="center">创建索引</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">2.73 亿</td><td align="center">8核32G RDS</td><td align="center">27分钟18.94秒</td><td align="center"></td></tr><tr><td align="center">查询4月份数据</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">0.4 亿</td><td align="center">8核32G RDS</td><td align="center">1分13.62秒</td><td align="center"></td></tr><tr><td align="center">计算4月份数据</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">0.4 亿</td><td align="center">8核32G RDS</td><td align="center">约25分钟</td><td align="center"></td></tr><tr><td align="center">需改列数据类型</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">8 亿</td><td align="center"></td><td align="center">14小时16分钟</td><td align="center">IOPS打满5000 CPU内存有小幅度上升</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;大表操作&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;表大小&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;索引大小&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;总大小&lt;/th&gt;
&lt;th a
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="在线DDL" scheme="http://www.toberoot.com/tags/%E5%9C%A8%E7%BA%BFDDL/"/>
    
      <category term="阿里云" scheme="http://www.toberoot.com/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
  </entry>
  
  <entry>
    <title>JIRA中的史诗、故事、版本与冲刺</title>
    <link href="http://www.toberoot.com/news/2020/05/06/tec-jira-md/"/>
    <id>http://www.toberoot.com/news/2020/05/06/tec-jira-md/</id>
    <published>2020-05-06T10:39:14.000Z</published>
    <updated>2020-05-06T02:41:50.527Z</updated>
    
    <content type="html"><![CDATA[<h2 id="史诗-故事-版本与冲刺"><a href="#史诗-故事-版本与冲刺" class="headerlink" title="史诗, 故事, 版本与冲刺"></a>史诗, 故事, 版本与冲刺</h2><p>　　<br>这四驾马车能够优雅地管理敏捷过程的范围和时间表。并构建工作。</p><p>Jira史诗(Epic)是一个大型用户故事，根据客户或最终用户需求分解为较小的任务(用户故事)。</p><ul><li>根据客户需求，根据需要在史诗中添加或删除任务。</li><li>Epic用于组织工作和创建层次结构。。</li><li>Epic通过将更大的任务组织成更小的任务来保持敏捷性。。</li><li>Epic是工作层次结构的顶层，开发人员使用它。。</li><li>Epic是更大的故事，具有明显的开始和结束。。</li><li>Epic可以跨越多个冲刺，即，史诗是通过多个冲刺传递的。。</li><li>Epic可以包含故事，错误和任务，并将它们分组成一个大故事。。</li><li>当Epic包含故事，错误或任务时，所有这些问题类型都表示在Jira的层次结构中的同一级别。。</li><li>故事，错误，任务代表单件作品，而史诗则是一组相关问题。</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;史诗-故事-版本与冲刺&quot;&gt;&lt;a href=&quot;#史诗-故事-版本与冲刺&quot; class=&quot;headerlink&quot; title=&quot;史诗, 故事, 版本与冲刺&quot;&gt;&lt;/a&gt;史诗, 故事, 版本与冲刺&lt;/h2&gt;&lt;p&gt;　　&lt;br&gt;这四驾马车能够优雅地管理敏捷过程的范围和时间表。
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="jira" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/jira/"/>
    
    
      <category term="jira" scheme="http://www.toberoot.com/tags/jira/"/>
    
      <category term="项目管理" scheme="http://www.toberoot.com/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"/>
    
      <category term="敏捷开发" scheme="http://www.toberoot.com/tags/%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>比技术更重要的事情</title>
    <link href="http://www.toberoot.com/news/2020/04/24/tec-rds-md/"/>
    <id>http://www.toberoot.com/news/2020/04/24/tec-rds-md/</id>
    <published>2020-04-24T11:44:33.000Z</published>
    <updated>2020-05-02T18:08:12.219Z</updated>
    
    <content type="html"><![CDATA[<h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><div class="jumbotron">  <h1 class="display-4">不以规矩，不能成方圆</h1>  <p class="lead">因一个好心办坏事的悲惨故事引发的思考。</p>  <hr class="my-4">  <p>  `数据库从删库跑路` 经常被DBA、运维调侃。因为这个操作是致命的！<br/><ul><li>如果你在甲方，那么能遇到删库跑路的机会还是很少的，三年遇到一次那都算多的；<br/></li><li>但如果你在乙方，那么一个月一次都算少的。。。<br/></li><li>在乙方，会遇到大公司，小公司，微型公司😂；有规范的数据库备份策略，也有压根儿就不知备份为何物的。<br/></p><a class="btn btn-primary btn-lg" href="#" role="button">呼吁DBA提高自身修养，非DBA也要操作谨慎。</a></div></li></ul><h3 id="各种奇葩的”人为误操作”："><a href="#各种奇葩的”人为误操作”：" class="headerlink" title="各种奇葩的”人为误操作”："></a>各种奇葩的”人为误操作”：</h3><ul><li>某新零售科技公司-自建MySQL5.7-误操作<code>Truncate</code>导致业务故障</li><li>某基金公司-阿里云RDS For MySQL5.7-误操作<code>Update</code>导致业务数据错乱</li><li>某化妆品公司-阿里云RDS For MySQL5.7-误操作<code>Alter</code>导致业务数据错乱</li><li>某公司-自建MySQL5.7-数据库服务器因磁盘空间异常宕机后误操作<code>rm -rf 数据库的数据目录</code>导致数据库无法启动</li><li>某金融公司-自建MySQL5.7-数据库服务器异常断电后数据表空间损坏（数据量2T）</li></ul><h3 id="各种奇葩的”备份失效”"><a href="#各种奇葩的”备份失效”" class="headerlink" title="各种奇葩的”备份失效”"></a>各种奇葩的”备份失效”</h3><ul><li>我以为我备份了，其实备份脚本压根就没有跑</li><li>我以为我备份了，其实最近一次备份是一个月前</li><li>我以为我备份了，其实不仅没有备份，连binlog都没开，开了也没有设置row格式。</li><li>我以为我备份了，也开了binlog日志，其实binlog日志只保留1天，全备份是7天前的。</li><li>我以为我的数据不重要，没有备份，我删了，业务告诉我数据还要。</li></ul><p>👏欢迎补充奇葩备份失败案例。</p><h2 id="故事背景"><a href="#故事背景" class="headerlink" title="故事背景"></a>故事背景</h2><p>今天我们遇到的案例是一个好心办坏事的悲惨故事。</p><p>我们暂且称主人公叫小A吧～</p><p>小A最近在做一个项目：阿里云金融云上将UAT环境的业务P 从深圳（华南2）迁移到 （上海）华东2。</p><p>故事的时间线🧵如下：</p><ul><li>2020年4月22日晚：业务应用已经迁移到了上海，数据库也迁移过去了，但是业务忘记切换数据库了（这里有坑🍌）。</li><li>2020年4月23日晚7点57分：业务反馈无法访问数据库</li><li>2020年4月23日晚7点58分：运维小A反馈：”我以为业务已经切了，就将深圳的数据库实例的 业务账号和db1库和db2库 都在控制台上删除了”</li><li>2020年4月23日晚8点00分：运维同学发现：业务还连着深圳的库，压根没切到上海去。</li></ul><h3 id="三问小A"><a href="#三问小A" class="headerlink" title="三问小A"></a>三问小A</h3><div class="alert alert-success" role="alert">问：是谁发出了指令要求小A去删用户删库？<br/>回答： 没有人</div><div class="alert alert-success" role="alert">问：没有人让你做，你为什么要做？<br/>回答：我以为业务已经正常迁移走了，不需要了，可以释放空间，所以就做了。</div><div class="alert alert-success" role="alert">问：你知道公司的流程规范吗？<br/>回答：知道，但是还是做了。</div><h3 id="故事分析"><a href="#故事分析" class="headerlink" title="故事分析"></a>故事分析</h3><p>故事到这里，我们先看一下问题出在哪里？</p><div class="alert alert-warning" role="alert">"不以规矩，不能成方圆" —— 孟子<br/><hr/>1. 迁移UAT环境，以为非生产环境不需要规范化操作，因此迁移没有像生产环境那样严格按照迁移规范操作，缺少了应用迁移的预演和验证。<br/>2. 运维同学小A，为了节约深圳的资源空间，自作主张去删用户，删库，缺少了运维规范的约束，是不知道规范？还是约束力不够？<br/>在企业中没有好心，只有规范和流程。</div><h2 id="救援步骤"><a href="#救援步骤" class="headerlink" title="救援步骤"></a>救援步骤</h2><div class="alert alert-info" role="alert">  1. 确认误操作前的时间点<br/>  2. 阿里云控制台通过单库逻辑备份+时间点的方式恢复到新实例<br/>  3. 补事务<br/>  4. DTS或逻辑导入源实例<br/></div><p>  <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">    补事务具体步骤  </a>  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample2" aria-expanded="false" aria-controls="collapseExample">    一些阿里的坑  </button></p><div class="collapse" id="collapseExample">  <div class="card card-body">    1. 解析binlog日志，确定误操作的两个时间点(先后删除了两个库🐂)<br/>    2. 从备份恢复的时间点开始恢复日志，并跳过误操作<br/>    3. 导入测试实例，验证表行数，开发侧验证数据<br/>  </div></div><div class="collapse" id="collapseExample2">  <div class="card card-body">    1. 实例开不出来，最终选择了一台已存在的测试实例<br/>    2. 200M的数据量通过控制台恢复到指定时间点耗时较长2小时<br/>  </div></div><h2 id="阿里云RDS-For-MySQL常用恢复方法"><a href="#阿里云RDS-For-MySQL常用恢复方法" class="headerlink" title="阿里云RDS For MySQL常用恢复方法"></a>阿里云RDS For MySQL常用恢复方法</h2><h3 id="操作规范"><a href="#操作规范" class="headerlink" title="操作规范"></a>操作规范</h3><div class="accordion" id="accordionExample">  <div class="card">    <div class="card-header" id="headingOne">      <h2 class="mb-0">        <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">          与客户沟通故障时间        </button>      </h2>    </div>    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">      <div class="card-body">            * 误操作人只能知道大致的误操作时间<br>            * 根据大致时间过滤数据<br>            * 根据数据量取误操作前后多长时间（默认10分钟）<br>      </div>    </div>  </div>  <div class="card">    <div class="card-header" id="headingTwo">      <h2 class="mb-0">        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">          与客户沟通误操作的内容        </button>      </h2>    </div>    <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">      <div class="card-body">            * 误操作表<br>            * 误操作执行语句<br>      </div>    </div>  </div>  <div class="card">    <div class="card-header" id="headingThree">      <h2 class="mb-0">        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">         将执行服务器ECS允许连接MySQL        </button>      </h2>    </div>    <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">      <div class="card-body">            * 自建数据库授权<br>            * RDS添加白名单<br>      </div>    </div>  </div>  <div class="card">    <div class="card-header" id="headingFour">      <h2 class="mb-0">        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">         利用工具紧急救援        </button>      </h2>    </div>    <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordionExample">      <div class="card-body">            * 获取误操作SQL执行具体时间<br>            * 获取误操作SQL执行具体位置<br>            * 全备份恢复+解析SQL<br>            * 解析SQL+回滚SQL<br>    </div>    </div>  </div></div><h3 id="操作工具"><a href="#操作工具" class="headerlink" title="操作工具"></a>操作工具</h3><img src='https://i.loli.net/2020/04/24/NkIwmhsDJV5dAEK.jpg' alt='NkIwmhsDJV5dAEK'/><h4 id="阿里云工具"><a href="#阿里云工具" class="headerlink" title="阿里云工具"></a>阿里云工具</h4><p>不得不说阿里云的正向恢复工具越来越完善，目前已支持：</p><ol><li>全库物理备份+binlog 恢复方式：控制台-克隆实例-指定备份集/指定时间点</li><li>单库逻辑备份+binlog 恢复方式：控制台-备份恢复-单库恢复-指定备份集/指定时间点/指定恢复目标（新实例，本实例不同库名）</li></ol><p>另外阿里还提供额外付费的DBS备份工具（逻辑备份）：单库/全库 一键恢复到指定时间点</p><h2 id="开源工具-binlog2sql工具"><a href="#开源工具-binlog2sql工具" class="headerlink" title="开源工具-binlog2sql工具"></a>开源工具-binlog2sql工具</h2><p>从MySQL binlog解析出你要的SQL。根据不同选项，你可以得到原始SQL、回滚SQL、去除主键的INSERT SQL等。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;写在前面&quot;&gt;&lt;a href=&quot;#写在前面&quot; class=&quot;headerlink&quot; title=&quot;写在前面&quot;&gt;&lt;/a&gt;写在前面&lt;/h2&gt;&lt;div class=&quot;jumbotron&quot;&gt;
  &lt;h1 class=&quot;display-4&quot;&gt;不以规矩，不能成方圆&lt;/h1&gt;
 
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="技术思考" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/%E6%8A%80%E6%9C%AF%E6%80%9D%E8%80%83/"/>
    
    
      <category term="紧急救援" scheme="http://www.toberoot.com/tags/%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>开源工具-binlog2sql工具</title>
    <link href="http://www.toberoot.com/news/2020/04/24/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/04/24/tec-mysql/</id>
    <published>2020-04-24T10:44:33.000Z</published>
    <updated>2020-04-24T05:54:27.062Z</updated>
    
    <content type="html"><![CDATA[<h2 id="开源工具-binlog2sql工具"><a href="#开源工具-binlog2sql工具" class="headerlink" title="开源工具-binlog2sql工具"></a>开源工具-binlog2sql工具</h2><p>从MySQL binlog解析出你要的SQL。根据不同选项，你可以得到原始SQL、回滚SQL、去除主键的INSERT SQL等。</p><h3 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h3><ul><li>数据快速回滚（闪回）</li><li>主从切换后master丢数据的修复</li><li>从binlog生成标准SQL，带来的衍生功能</li></ul><h3 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h3><ul><li>mysql server必须开启，离线模式下不能解析</li><li>参数 binlog_row_image 必须为FULL，暂不支持MINIMAL</li><li>解析速度不如mysqlbinlog</li></ul><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># centos7</span></span><br><span class="line"><span class="comment"># python2.7</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/danfengcao/binlog2sql.git &amp;&amp; <span class="built_in">cd</span> binlog2sql</span><br><span class="line">yum -y install epel-release</span><br><span class="line">yum -y install python-pip</span><br><span class="line">pip install --upgrade pip</span><br><span class="line">pip install -r requirements.txt </span><br></pre></td></tr></table></figure><h3 id="对MySQL的使用限制"><a href="#对MySQL的使用限制" class="headerlink" title="对MySQL的使用限制"></a>对MySQL的使用限制</h3><p>MySQL server必须设置以下参数:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server_id = 1</span><br><span class="line">log_bin = /var/log/mysql/mysql-bin.log</span><br><span class="line">max_binlog_size = 1G</span><br><span class="line">binlog_format = row</span><br><span class="line">binlog_row_image = full</span><br></pre></td></tr></table></figure><p>user需要的最小权限集合：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span>, super/<span class="keyword">replication</span> <span class="keyword">client</span>, <span class="keyword">replication</span> <span class="keyword">slave</span></span><br></pre></td></tr></table></figure><p>建议授权</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">REPLICATION</span> <span class="keyword">SLAVE</span>, <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> </span><br></pre></td></tr></table></figure><h2 id="binlog2sql帮助"><a href="#binlog2sql帮助" class="headerlink" title="binlog2sql帮助"></a>binlog2sql帮助</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql连接配置</span><br><span class="line">-h host; -P port; -u user; -p password</span><br><span class="line">解析模式</span><br><span class="line">--stop-never 持续同步binlog。可选。不加则同步至执行命令时最新的binlog位置。</span><br><span class="line">-K, --no-primary-key 对INSERT语句去除主键。可选。</span><br><span class="line">-B, --flashback 生成回滚语句，可解析大文件，不受内存限制，每打印一千行加一句SLEEP SELECT(1)。可选。与stop-never或no-primary-key不能同时添加。</span><br><span class="line">解析范围控制</span><br><span class="line">--start-file 起始解析文件。必须。</span><br><span class="line">--start-position/--start-pos start-file的起始解析位置。可选。默认为start-file的起始位置。</span><br><span class="line">--stop-file/--end-file 末尾解析文件。可选。默认为start-file同一个文件。若解析模式为stop-never，此选项失效。</span><br><span class="line">--stop-position/--end-pos stop-file的末尾解析位置。可选。默认为stop-file的最末位置；若解析模式为stop-never，此选项失效。</span><br><span class="line">--start-datetime 从哪个时间点的binlog开始解析，格式必须为datetime，如<span class="string">'2016-11-11 11:11:11'</span>。可选。默认不过滤。</span><br><span class="line">--stop-datetime 到哪个时间点的binlog停止解析，格式必须为datetime，如<span class="string">'2016-11-11 11:11:11'</span>。可选。默认不过滤。</span><br><span class="line">对象过滤</span><br><span class="line">-d, --databases 只输出目标db的sql。可选。默认为空。</span><br><span class="line">-t, --tables 只输出目标tables的sql。可选。默认为空。</span><br></pre></td></tr></table></figure><h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h4 id="解析标准SQL"><a href="#解析标准SQL" class="headerlink" title="解析标准SQL"></a>解析标准SQL</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python binlog2sql.py -h127.0.0.1 -P3306 -uroot -dhjxdb -t user --start-file=<span class="string">'mysql-bin.000001'</span> --start-datetime=<span class="string">'2017-09-14 13:50:00'</span> --stop-datetime=<span class="string">'2017-09-14 14:10:00'</span></span><br></pre></td></tr></table></figure><h3 id="解析出回滚SQL"><a href="#解析出回滚SQL" class="headerlink" title="解析出回滚SQL"></a>解析出回滚SQL</h3><ul><li><code>-B</code>: 参数代表回滚</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python binlog2sql.py -h127.0.0.1 -P3306 -uroot -dhjxdb -t user --start-file=<span class="string">'mysql-bin.000001'</span> --start-position=4946 --stop-position=5921 -B </span><br></pre></td></tr></table></figure><p>工具是给人用的，关键还得有思路。加油⛽️</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;开源工具-binlog2sql工具&quot;&gt;&lt;a href=&quot;#开源工具-binlog2sql工具&quot; class=&quot;headerlink&quot; title=&quot;开源工具-binlog2sql工具&quot;&gt;&lt;/a&gt;开源工具-binlog2sql工具&lt;/h2&gt;&lt;p&gt;从MySQL bin
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="紧急救援" scheme="http://www.toberoot.com/tags/%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4/"/>
    
      <category term="binlog2sql" scheme="http://www.toberoot.com/tags/binlog2sql/"/>
    
  </entry>
  
  <entry>
    <title>开源工具-MyFlash工具</title>
    <link href="http://www.toberoot.com/news/2020/04/24/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/04/24/tec-mysql/</id>
    <published>2020-04-24T10:44:33.000Z</published>
    <updated>2020-05-08T10:17:41.647Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>生产中使用binlog2sql较多，但也有缺点例如速度不够快；不支持blob的列，因此使用美团开源的myflash试试。</p></blockquote><!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --><ul><li><a href="#开源工具-myflash工具">开源工具-MyFlash工具</a>   <ul><li><a href="#详细说明">详细说明</a>   </li><li><a href="#限制">限制</a>   </li><li><a href="#faq">FAQ</a>   </li></ul></li><li><a href="#使用实践">使用实践</a>   <ul><li><a href="#安装myflash">安装MyFlash</a>   </li><li><a href="#查看帮助">查看帮助</a>   </li><li><a href="#测试使用">测试使用</a>   <ul><li><a href="#检查mysql日志参数">检查mysql日志参数</a>   </li><li><a href="#创建测试表">创建测试表</a>   </li></ul></li><li><a href="#插入测试数据">插入测试数据</a>   </li><li><a href="#回滚">回滚</a>   </li></ul></li><li><a href="#如何对阿里云rds进行闪回">如何对阿里云RDS进行闪回</a>   <ul><li><a href="#阿里云的binlog获取方法">阿里云的binlog获取方法</a>   </li><li><a href="#处理binlog日志的备注信息">处理binlog日志的备注信息</a>   </li><li><a href="#其他方法">其他方法</a>   </li></ul></li></ul><!-- /MDTOC --><h2 id="开源工具-MyFlash工具"><a href="#开源工具-MyFlash工具" class="headerlink" title="开源工具-MyFlash工具"></a>开源工具-MyFlash工具</h2><p>MyFlash是由美团点评公司技术工程部开发维护的一个回滚DML操作的工具。该工具通过解析v4版本的binlog，完成回滚操作。相对已有的回滚工具，其增加了更多的过滤选项，让回滚更加容易。 该工具已经在美团点评内部使用</p><h3 id="详细说明"><a href="#详细说明" class="headerlink" title="详细说明"></a>详细说明</h3><ol><li><p><a href="https://github.com/Meituan-Dianping/MyFlash/blob/master/doc/INSTALL.md" rel="external nofollow noreferrer">安装</a></p></li><li><p><a href="https://github.com/Meituan-Dianping/MyFlash/blob/master/doc/how_to_use.md" rel="external nofollow noreferrer">使用</a></p></li><li><p><a href="https://github.com/Meituan-Dianping/MyFlash/blob/master/doc/TestCase.md" rel="external nofollow noreferrer">测试用例</a></p><h3 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h3></li><li><p>binlog格式必须为row,且binlog_row_image=full</p></li><li><p>仅支持5.6与5.7</p></li><li><p>只能回滚DML（增、删、改）</p><h3 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h3></li><li><p>实现的原理是什么？   </p></li></ol><ul><li>答：参考文章<a href="http://url.cn/5yVTfLY" rel="external nofollow noreferrer">http://url.cn/5yVTfLY</a></li></ul><ol start="2"><li>支持gtid吗？  </li></ol><ul><li>答：支持。请参考 <a href="./doc/how_to_use.md">使用</a></li></ul><ol start="3"><li>在开启gtid的MySQL server上，应用flashback报错，错误为：ERROR 1782 (HY000) at line 16: @@SESSION.GTID_NEXT cannot be set to ANONYMOUS when @@GLOBAL.GTID_MODE = ON.  ?     </li></ol><ul><li>答：在导入时加入–skip-gtids<br>mysqlbinlog –skip-gtids <flashbacklog> | mysql -uxxx -pxxx</li></ul><ol start="4"><li>如果回滚后的binlog日志尺寸超过20M，在导入时，很耗时。如何处理?      </li></ol><ul><li>答：参考 <a href="./doc/how_to_use.md">使用</a> ,搜索maxSplitSize。使用该参数可以对文件进行切片</li></ul><h2 id="使用实践"><a href="#使用实践" class="headerlink" title="使用实践"></a>使用实践</h2><h3 id="安装MyFlash"><a href="#安装MyFlash" class="headerlink" title="安装MyFlash"></a>安装MyFlash</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/Meituan-Dianping/MyFlash.git</span><br><span class="line"><span class="built_in">cd</span> MyFlash</span><br><span class="line">yum install glib2* -y</span><br><span class="line">gcc -w  `pkg-config --cflags --libs glib-2.0` <span class="built_in">source</span>/binlogParseGlib.c  -o binary/flashback</span><br><span class="line">cp binary/flashback /usr/<span class="built_in">local</span>/bin/</span><br><span class="line"><span class="built_in">which</span> flashback</span><br></pre></td></tr></table></figure><h3 id="查看帮助"><a href="#查看帮助" class="headerlink" title="查看帮助"></a>查看帮助</h3><p>执行<code>flashback --help</code>查看帮助</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@node1 MyFlash]<span class="comment"># flashback --help</span></span><br><span class="line">Usage:</span><br><span class="line">  flashback [OPTION?]</span><br><span class="line"></span><br><span class="line">Help Options:</span><br><span class="line">  -h, --<span class="built_in">help</span>                  Show <span class="built_in">help</span> options</span><br><span class="line"></span><br><span class="line">Application Options:</span><br><span class="line">  --databaseNames             databaseName to apply. <span class="keyword">if</span> multiple, seperate by comma(,)</span><br><span class="line">  --tableNames                tableName to apply. <span class="keyword">if</span> multiple, seperate by comma(,)</span><br><span class="line">  --start-position            start position</span><br><span class="line">  --stop-position             stop position</span><br><span class="line">  --start-datetime            start time (format %Y-%m-%d %H:%M:%S)</span><br><span class="line">  --stop-datetime             stop time (format %Y-%m-%d %H:%M:%S)</span><br><span class="line">  --sqlTypes                  sql <span class="built_in">type</span> to filter . support INSERT, UPDATE ,DELETE. <span class="keyword">if</span> multiple, seperate by comma(,)</span><br><span class="line">  --maxSplitSize              max file size after split, the uint is M</span><br><span class="line">  --binlogFileNames           binlog files to process. <span class="keyword">if</span> multiple, seperate by comma(,)</span><br><span class="line">  --outBinlogFileNameBase     output binlog file name base</span><br><span class="line">  --logLevel                  <span class="built_in">log</span> level, available option is debug,warning,error</span><br><span class="line">  --include-gtids             gtids to process</span><br><span class="line">  --exclude-gtids             gtids to skip</span><br></pre></td></tr></table></figure><p><img src="2020-05-08-tec-mysql/20200508165409.jpg" alt=""></p><p>下面的这些参数是可以任意组合的。</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span><span class="string">databaseNames</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定需要回滚的数据库名。多个数据库可以用“,”隔开。如果不指定该参数，相当于指定了所有数据库。</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span><span class="string">tableNames</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定需要回滚的表名。多个表可以用“,”隔开。如果不指定该参数，相当于指定了所有表。</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span><span class="string">start-position</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定回滚开始的位置。如不指定，从文件的开始处回滚。请指定正确的有效的位置，否则无法回滚</span></span><br><span class="line"></span><br><span class="line"><span class="number">4.</span><span class="string">stop-position</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定回滚结束的位置。如不指定，回滚到文件结尾。请指定正确的有效的位置，否则无法回滚</span></span><br><span class="line"></span><br><span class="line"><span class="number">5.</span><span class="string">start-datetime</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定回滚的开始时间。注意格式必须是</span> <span class="string">%Y-%m-%d</span> <span class="string">%H:%M:%S。</span> <span class="string">如不指定，则不限定时间</span></span><br><span class="line"></span><br><span class="line"><span class="number">6.</span><span class="string">stop-datetime</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定回滚的结束时间。注意格式必须是</span> <span class="string">%Y-%m-%d</span> <span class="string">%H:%M:%S。</span> <span class="string">如不指定，则不限定时间</span></span><br><span class="line"></span><br><span class="line"><span class="number">7.</span><span class="string">sqlTypes</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定需要回滚的sql类型。目前支持的过滤类型是INSERT,</span> <span class="string">UPDATE</span> <span class="string">,DELETE。多个类型可以用“,”隔开。</span></span><br><span class="line"></span><br><span class="line"><span class="number">8.</span><span class="string">maxSplitSize</span></span><br><span class="line"></span><br><span class="line"><span class="string">一旦指定该参数，对文件进行固定尺寸的分割（单位为M），过滤条件有效，但不进行回滚操作。该参数主要用来将大的binlog文件切割，防止单次应用的binlog尺寸过大，对线上造成压力</span></span><br><span class="line"></span><br><span class="line"><span class="number">9.</span><span class="string">binlogFileNames</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定需要回滚的binlog文件，目前只支持单个文件，后续会增加多个文件支持</span></span><br><span class="line"></span><br><span class="line"><span class="number">10.</span><span class="string">outBinlogFileNameBase</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定输出的binlog文件前缀，如不指定，则默认为binlog_output_base.flashback</span></span><br><span class="line"></span><br><span class="line"><span class="number">11.</span><span class="string">logLevel</span></span><br><span class="line"></span><br><span class="line"><span class="string">仅供开发者使用，默认级别为error级别。在生产环境中不要修改这个级别，否则输出过多</span></span><br><span class="line"></span><br><span class="line"><span class="number">12.</span><span class="string">include-gtids</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定需要回滚的gtid,支持gtid的单个和范围两种形式。</span></span><br><span class="line"></span><br><span class="line"><span class="number">13.</span><span class="string">exclude-gtids</span></span><br><span class="line"></span><br><span class="line"><span class="string">指定不需要回滚的gtid，用法同include-gtids</span></span><br></pre></td></tr></table></figure><h3 id="测试使用"><a href="#测试使用" class="headerlink" title="测试使用"></a>测试使用</h3><h4 id="检查mysql日志参数"><a href="#检查mysql日志参数" class="headerlink" title="检查mysql日志参数"></a>检查mysql日志参数</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">show variables like <span class="string">'binlog_format'</span>;</span><br><span class="line">show variables like <span class="string">'binlog_row_image'</span>;</span><br></pre></td></tr></table></figure><h4 id="创建测试表"><a href="#创建测试表" class="headerlink" title="创建测试表"></a>创建测试表</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> booboo;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`booboo`</span>.<span class="string">`testFlashback2`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`nameShort`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`nameLong`</span> <span class="built_in">varchar</span>(<span class="number">260</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`amount`</span> <span class="built_in">decimal</span>(<span class="number">19</span>,<span class="number">9</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`amountFloat`</span> <span class="built_in">float</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`amountDouble`</span> <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`createDatetime6`</span> datetime(<span class="number">6</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`createDatetime`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`createTimestamp`</span> <span class="built_in">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="string">`nameText`</span> <span class="built_in">text</span>,</span><br><span class="line">  <span class="string">`nameBlob`</span> <span class="built_in">blob</span>,</span><br><span class="line">  <span class="string">`nameMedium`</span> mediumtext,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure><h3 id="插入测试数据"><a href="#插入测试数据" class="headerlink" title="插入测试数据"></a>插入测试数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">flush</span> <span class="keyword">logs</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testFlashback2(nameShort,nameLong,amount,amountFloat,amountDouble,createDatetime6,createDatetime,createTimestamp,nameText,nameBlob,nameMedium) <span class="keyword">values</span>(<span class="string">'aaa'</span>,<span class="string">'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb'</span>,<span class="number">10.5</span>,<span class="number">10.6</span>,<span class="number">10.7</span>,<span class="string">'2017-10-26 10:00:00'</span>,<span class="string">'2017-10-26 10:00:00'</span>,<span class="string">'2017-10-26 10:00:00'</span>,<span class="string">'cccc'</span>,<span class="string">'dddd'</span>,<span class="string">'eee'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> testFlashback2(nameShort,nameLong,amount,amountFloat,amountDouble,createDatetime6,createDatetime,createTimestamp,nameText,nameBlob,nameMedium) <span class="keyword">values</span>(<span class="string">'aaa'</span>,<span class="string">'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb'</span>,<span class="number">10.5</span>,<span class="number">10.6</span>,<span class="number">10.7</span>,<span class="string">'2017-10-26 10:00:00'</span>,<span class="string">'2017-10-26 10:00:00'</span>,<span class="string">'2017-10-26 10:00:00'</span>,<span class="string">'cccc'</span>,<span class="string">'dddd'</span>,<span class="string">'eee'</span>);</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">logs</span>;</span><br></pre></td></tr></table></figure><p>查看插入的数据</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">root@localhost [booboo]&gt;select * from testFlashback2\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             id: 1</span><br><span class="line">      nameShort: aaa</span><br><span class="line">       nameLong: bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</span><br><span class="line">         amount: 10.500000000</span><br><span class="line">    amountFloat: 10.6</span><br><span class="line">   amountDouble: 10.7</span><br><span class="line">createDatetime6: 2017-10-26 10:00:00.000000</span><br><span class="line"> createDatetime: 2017-10-26 10:00:00</span><br><span class="line">createTimestamp: 2017-10-26 10:00:00</span><br><span class="line">       nameText: cccc</span><br><span class="line">       nameBlob: dddd</span><br><span class="line">     nameMedium: eee</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">             id: 2</span><br><span class="line">      nameShort: aaa</span><br><span class="line">       nameLong: bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</span><br><span class="line">         amount: 10.500000000</span><br><span class="line">    amountFloat: 10.6</span><br><span class="line">   amountDouble: 10.7</span><br><span class="line">createDatetime6: 2017-10-26 10:00:00.000000</span><br><span class="line"> createDatetime: 2017-10-26 10:00:00</span><br><span class="line">createTimestamp: 2017-10-26 10:00:00</span><br><span class="line">       nameText: cccc</span><br><span class="line">       nameBlob: dddd</span><br><span class="line">     nameMedium: eee</span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">ERROR</span>:</span><br><span class="line"><span class="keyword">No</span> <span class="keyword">query</span> specified</span><br></pre></td></tr></table></figure><h3 id="回滚"><a href="#回滚" class="headerlink" title="回滚"></a>回滚</h3><ol><li>找到对应的binlog日志 <code>/alidata/mysql/log/mysql-bin.000078</code></li></ol><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost [booboo]&gt;show binary logs;</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| Log_name         | File_size |</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| mysql-bin.000077 |      5991 |</span><br><span class="line">| mysql-bin.000078 |      1348 |</span><br><span class="line">| mysql-bin.000079 |       191 |</span><br><span class="line">+------------------+-----------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@localhost [booboo]&gt;<span class="built_in">exit</span>;</span><br><span class="line">Bye</span><br><span class="line">[root@node1 MyFlash]<span class="comment"># cd /alidata/mysql/</span></span><br><span class="line">bin/           data/          include/       <span class="built_in">log</span>/           my.cnf         README         share/         support-files/</span><br><span class="line">COPYING        docs/          lib/           man/           mysql-test/    scripts/       sql-bench/     tmp/</span><br><span class="line">[root@node1 MyFlash]<span class="comment"># cd /alidata/mysql/log/</span></span><br><span class="line">mysql-bin.000077  mysql-bin.000078  mysql-bin.000079  mysql-bin.index   test.sql</span><br><span class="line">[root@node1 MyFlash]<span class="comment"># cd /alidata/mysql/log/</span></span><br><span class="line">[root@node1 <span class="built_in">log</span>]<span class="comment"># ll</span></span><br><span class="line">总用量 24</span><br><span class="line">-rw-rw----. 1 mysql mysql 5991 5月   8 17:08 mysql-bin.000077</span><br><span class="line">-rw-rw----. 1 mysql mysql 1348 5月   8 17:09 mysql-bin.000078</span><br><span class="line">-rw-rw----. 1 mysql mysql  191 5月   8 17:09 mysql-bin.000079</span><br><span class="line">-rw-rw----. 1 mysql mysql  108 5月   8 17:09 mysql-bin.index</span><br><span class="line">[root@node1 <span class="built_in">log</span>]<span class="comment"># mysqlbinlog -v -v  mysql-bin.000078</span></span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;</span><br><span class="line">/*!40019 SET @@session.max_insert_delayed_threads=0*/;</span><br><span class="line">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;</span><br><span class="line">DELIMITER /*!*/;</span><br><span class="line"><span class="comment"># at 4</span></span><br><span class="line"><span class="comment">#200508 17:08:40 server id 1003306  end_log_pos 120 CRC32 0x2b689980     Start: binlog v 4, server v 5.6.45-log created 200508 17:08:40</span></span><br><span class="line">BINLOG <span class="string">'</span></span><br><span class="line"><span class="string">mCG1Xg8qTw8AdAAAAHgAAAAAAAQANS42LjQ1LWxvZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span></span><br><span class="line"><span class="string">AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXAAEGggAAAAICAgCAAAACgoKGRkAAYCZ</span></span><br><span class="line"><span class="string">aCs=</span></span><br><span class="line"><span class="string">'</span>/*!*/;</span><br><span class="line"><span class="comment"># at 120</span></span><br><span class="line"><span class="comment">#200508 17:08:40 server id 1003306  end_log_pos 191 CRC32 0x51646940     Previous-GTIDs</span></span><br><span class="line"><span class="comment"># 8ae1b527-bd2c-11e9-b46d-000c296330ff:1-9</span></span><br><span class="line"><span class="comment"># at 191</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 239 CRC32 0x285c9356     GTID [commit=yes]</span></span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">'8ae1b527-bd2c-11e9-b46d-000c296330ff:10'</span>/*!*/;</span><br><span class="line"><span class="comment"># at 239</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 321 CRC32 0x59cb1159     Query    thread_id=31    exec_time=0    error_code=0</span></span><br><span class="line">SET TIMESTAMP=1588928952/*!*/;</span><br><span class="line">SET @@session.pseudo_thread_id=31/*!*/;</span><br><span class="line">SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/;</span><br><span class="line">SET @@session.sql_mode=1075838976/*!*/;</span><br><span class="line">SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;</span><br><span class="line">/*!\C utf8 *//*!*/;</span><br><span class="line">SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=45/*!*/;</span><br><span class="line">SET @@session.time_zone=<span class="string">'SYSTEM'</span>/*!*/;</span><br><span class="line">SET @@session.lc_time_names=0/*!*/;</span><br><span class="line">SET @@session.collation_database=DEFAULT/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="comment"># at 321</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 406 CRC32 0x541898f4     Table_map: `booboo`.`testflashback2` mapped to number 74</span></span><br><span class="line"><span class="comment"># at 406</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 715 CRC32 0x9df50e18     Write_rows: table id 74 flags: STMT_END_F</span></span><br><span class="line"></span><br><span class="line">BINLOG <span class="string">'</span></span><br><span class="line"><span class="string">uCG1XhMqTw8AVQAAAJYBAAAAAEoAAAAAAAEABmJvb2JvbwAOdGVzdGZsYXNoYmFjazIADAMPD/YE</span></span><br><span class="line"><span class="string">BRISEfz8/A5QABAEEwkECAYAAAICA/4O9JgYVA==</span></span><br><span class="line"><span class="string">uCG1Xh4qTw8ANQEAAMsCAAAAAEoAAAAAAAEAAgAM//8A8AEAAAADYWFhzQBiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJigAAAAAodzWUAmpkpQWZmZmZmZiVAmZ30oAAAAACZnfSgAFnx</span></span><br><span class="line"><span class="string">QaAEAGNjY2MEAGRkZGQDAABlZWUYDvWd</span></span><br><span class="line"><span class="string">'</span>/*!*/;</span><br><span class="line"><span class="comment">### INSERT INTO `booboo`.`testflashback2`</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2='aaa' /* VARSTRING(80) meta=80 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb' /* VARSTRING(1040) meta=1040 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4=10.500000000 /* DECIMAL(19,9) meta=4873 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @5=10.6                 /* FLOAT meta=4 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @6=10.699999999999999289 /* DOUBLE meta=8 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @7='2017-10-26 10:00:00.000000' /* DATETIME(6) meta=6 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @8='2017-10-26 10:00:00' /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @9=1508983200 /* TIMESTAMP(0) meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @10='cccc' /* BLOB/TEXT meta=2 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @11='dddd' /* BLOB/TEXT meta=2 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @12='eee' /* MEDIUMBLOB/MEDIUMTEXT meta=3 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment"># at 715</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 746 CRC32 0x637a4759     Xid = 153</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line"><span class="comment"># at 746</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 794 CRC32 0x6df52572     GTID [commit=yes]</span></span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">'8ae1b527-bd2c-11e9-b46d-000c296330ff:11'</span>/*!*/;</span><br><span class="line"><span class="comment"># at 794</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 876 CRC32 0x6944db63     Query    thread_id=31    exec_time=0    error_code=0</span></span><br><span class="line">SET TIMESTAMP=1588928952/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="comment"># at 876</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 961 CRC32 0xb3177cd9     Table_map: `booboo`.`testflashback2` mapped to number 74</span></span><br><span class="line"><span class="comment"># at 961</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 1270 CRC32 0x47f9804d     Write_rows: table id 74 flags: STMT_END_F</span></span><br><span class="line"></span><br><span class="line">BINLOG <span class="string">'</span></span><br><span class="line"><span class="string">uCG1XhMqTw8AVQAAAMEDAAAAAEoAAAAAAAEABmJvb2JvbwAOdGVzdGZsYXNoYmFjazIADAMPD/YE</span></span><br><span class="line"><span class="string">BRISEfz8/A5QABAEEwkECAYAAAICA/4O2XwXsw==</span></span><br><span class="line"><span class="string">uCG1Xh4qTw8ANQEAAPYEAAAAAEoAAAAAAAEAAgAM//8A8AIAAAADYWFhzQBiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJigAAAAAodzWUAmpkpQWZmZmZmZiVAmZ30oAAAAACZnfSgAFnx</span></span><br><span class="line"><span class="string">QaAEAGNjY2MEAGRkZGQDAABlZWVNgPlH</span></span><br><span class="line"><span class="string">'</span>/*!*/;</span><br><span class="line"><span class="comment">### INSERT INTO `booboo`.`testflashback2`</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2='aaa' /* VARSTRING(80) meta=80 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb' /* VARSTRING(1040) meta=1040 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4=10.500000000 /* DECIMAL(19,9) meta=4873 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @5=10.6                 /* FLOAT meta=4 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @6=10.699999999999999289 /* DOUBLE meta=8 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @7='2017-10-26 10:00:00.000000' /* DATETIME(6) meta=6 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @8='2017-10-26 10:00:00' /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @9=1508983200 /* TIMESTAMP(0) meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @10='cccc' /* BLOB/TEXT meta=2 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @11='dddd' /* BLOB/TEXT meta=2 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @12='eee' /* MEDIUMBLOB/MEDIUMTEXT meta=3 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment"># at 1270</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 1301 CRC32 0xaf0eaeb3     Xid = 154</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">'AUTOMATIC'</span> /* added by mysqlbinlog */ /*!*/;</span><br><span class="line"><span class="comment"># at 1301</span></span><br><span class="line"><span class="comment">#200508 17:09:13 server id 1003306  end_log_pos 1348 CRC32 0x53ecb2a7     Rotate to mysql-bin.000079  pos: 4</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="comment"># End of log file</span></span><br><span class="line">ROLLBACK /* added by mysqlbinlog */;</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br></pre></td></tr></table></figure><ol start="2"><li>执行生产flashback文件 <code>flashback --binlogFileNames=/alidata/mysql/log/mysql-bin.000078</code></li></ol><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@node1 <span class="built_in">log</span>]<span class="comment"># flashback --binlogFileNames=/alidata/mysql/log/mysql-bin.000078</span></span><br><span class="line">[root@node1 <span class="built_in">log</span>]<span class="comment"># ll</span></span><br><span class="line">总用量 28</span><br><span class="line">-rw-r--r--. 1 root  root   970 5月   8 17:19 binlog_output_base.flashback</span><br><span class="line">-rw-rw----. 1 mysql mysql 5991 5月   8 17:08 mysql-bin.000077</span><br><span class="line">-rw-rw----. 1 mysql mysql 1348 5月   8 17:09 mysql-bin.000078</span><br><span class="line">-rw-rw----. 1 mysql mysql  191 5月   8 17:09 mysql-bin.000079</span><br><span class="line">-rw-rw----. 1 mysql mysql  108 5月   8 17:09 mysql-bin.index</span><br><span class="line">-rw-r--r--. 1 root  root   795 4月  14 16:23 test.sql</span><br></pre></td></tr></table></figure><p>3.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@node1 <span class="built_in">log</span>]<span class="comment"># mysqlbinlog binlog_output_base.flashback</span></span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;</span><br><span class="line">/*!40019 SET @@session.max_insert_delayed_threads=0*/;</span><br><span class="line">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;</span><br><span class="line">DELIMITER /*!*/;</span><br><span class="line"><span class="comment"># at 4</span></span><br><span class="line"><span class="comment">#200508 17:08:40 server id 1003306  end_log_pos 120 CRC32 0x2b689980     Start: binlog v 4, server v 5.6.45-log created 200508 17:08:40</span></span><br><span class="line">BINLOG <span class="string">'</span></span><br><span class="line"><span class="string">mCG1Xg8qTw8AdAAAAHgAAAAAAAQANS42LjQ1LWxvZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span></span><br><span class="line"><span class="string">AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXAAEGggAAAAICAgCAAAACgoKGRkAAYCZ</span></span><br><span class="line"><span class="string">aCs=</span></span><br><span class="line"><span class="string">'</span>/*!*/;</span><br><span class="line"><span class="comment"># at 120</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 205 CRC32 0xb3177cd9     Table_map: `booboo`.`testflashback2` mapped to number 74</span></span><br><span class="line"><span class="comment"># at 205</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 514 CRC32 0x47f9804d     Delete_rows: table id 74 flags: STMT_END_F</span></span><br><span class="line"></span><br><span class="line">BINLOG <span class="string">'</span></span><br><span class="line"><span class="string">uCG1XhMqTw8AVQAAAM0AAAAAAEoAAAAAAAEABmJvb2JvbwAOdGVzdGZsYXNoYmFjazIADAMPD/YE</span></span><br><span class="line"><span class="string">BRISEfz8/A5QABAEEwkECAYAAAICA/4O2XwXsw==</span></span><br><span class="line"><span class="string">uCG1XiAqTw8ANQEAAAICAAAAAEoAAAAAAAEAAgAM//8A8AIAAAADYWFhzQBiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJigAAAAAodzWUAmpkpQWZmZmZmZiVAmZ30oAAAAACZnfSgAFnx</span></span><br><span class="line"><span class="string">QaAEAGNjY2MEAGRkZGQDAABlZWVNgPlH</span></span><br><span class="line"><span class="string">'</span>/*!*/;</span><br><span class="line"><span class="comment"># at 514</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 545 CRC32 0x637a4759     Xid = 153</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line"><span class="comment"># at 545</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 630 CRC32 0x541898f4     Table_map: `booboo`.`testflashback2` mapped to number 74</span></span><br><span class="line"><span class="comment"># at 630</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 939 CRC32 0x9df50e18     Delete_rows: table id 74 flags: STMT_END_F</span></span><br><span class="line"></span><br><span class="line">BINLOG <span class="string">'</span></span><br><span class="line"><span class="string">uCG1XhMqTw8AVQAAAHYCAAAAAEoAAAAAAAEABmJvb2JvbwAOdGVzdGZsYXNoYmFjazIADAMPD/YE</span></span><br><span class="line"><span class="string">BRISEfz8/A5QABAEEwkECAYAAAICA/4O9JgYVA==</span></span><br><span class="line"><span class="string">uCG1XiAqTw8ANQEAAKsDAAAAAEoAAAAAAAEAAgAM//8A8AEAAAADYWFhzQBiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJigAAAAAodzWUAmpkpQWZmZmZmZiVAmZ30oAAAAACZnfSgAFnx</span></span><br><span class="line"><span class="string">QaAEAGNjY2MEAGRkZGQDAABlZWUYDvWd</span></span><br><span class="line"><span class="string">'</span>/*!*/;</span><br><span class="line"><span class="comment"># at 939</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 970 CRC32 0x637a4759     Xid = 153</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="comment"># End of log file</span></span><br><span class="line">ROLLBACK /* added by mysqlbinlog */;</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br><span class="line">[root@node1 <span class="built_in">log</span>]<span class="comment"># mysqlbinlog -v -v binlog_output_base.flashback</span></span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;</span><br><span class="line">/*!40019 SET @@session.max_insert_delayed_threads=0*/;</span><br><span class="line">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;</span><br><span class="line">DELIMITER /*!*/;</span><br><span class="line"><span class="comment"># at 4</span></span><br><span class="line"><span class="comment">#200508 17:08:40 server id 1003306  end_log_pos 120 CRC32 0x2b689980     Start: binlog v 4, server v 5.6.45-log created 200508 17:08:40</span></span><br><span class="line">BINLOG <span class="string">'</span></span><br><span class="line"><span class="string">mCG1Xg8qTw8AdAAAAHgAAAAAAAQANS42LjQ1LWxvZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span></span><br><span class="line"><span class="string">AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXAAEGggAAAAICAgCAAAACgoKGRkAAYCZ</span></span><br><span class="line"><span class="string">aCs=</span></span><br><span class="line"><span class="string">'</span>/*!*/;</span><br><span class="line"><span class="comment"># at 120</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 205 CRC32 0xb3177cd9     Table_map: `booboo`.`testflashback2` mapped to number 74</span></span><br><span class="line"><span class="comment"># at 205</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 514 CRC32 0x47f9804d     Delete_rows: table id 74 flags: STMT_END_F</span></span><br><span class="line"></span><br><span class="line">BINLOG <span class="string">'</span></span><br><span class="line"><span class="string">uCG1XhMqTw8AVQAAAM0AAAAAAEoAAAAAAAEABmJvb2JvbwAOdGVzdGZsYXNoYmFjazIADAMPD/YE</span></span><br><span class="line"><span class="string">BRISEfz8/A5QABAEEwkECAYAAAICA/4O2XwXsw==</span></span><br><span class="line"><span class="string">uCG1XiAqTw8ANQEAAAICAAAAAEoAAAAAAAEAAgAM//8A8AIAAAADYWFhzQBiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJigAAAAAodzWUAmpkpQWZmZmZmZiVAmZ30oAAAAACZnfSgAFnx</span></span><br><span class="line"><span class="string">QaAEAGNjY2MEAGRkZGQDAABlZWVNgPlH</span></span><br><span class="line"><span class="string">'</span>/*!*/;</span><br><span class="line"><span class="comment">### DELETE FROM `booboo`.`testflashback2`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2='aaa' /* VARSTRING(80) meta=80 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb' /* VARSTRING(1040) meta=1040 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4=10.500000000 /* DECIMAL(19,9) meta=4873 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @5=10.6                 /* FLOAT meta=4 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @6=10.699999999999999289 /* DOUBLE meta=8 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @7='2017-10-26 10:00:00.000000' /* DATETIME(6) meta=6 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @8='2017-10-26 10:00:00' /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @9=1508983200 /* TIMESTAMP(0) meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @10='cccc' /* BLOB/TEXT meta=2 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @11='dddd' /* BLOB/TEXT meta=2 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @12='eee' /* MEDIUMBLOB/MEDIUMTEXT meta=3 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment"># at 514</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 545 CRC32 0x637a4759     Xid = 153</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line"><span class="comment"># at 545</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 630 CRC32 0x541898f4     Table_map: `booboo`.`testflashback2` mapped to number 74</span></span><br><span class="line"><span class="comment"># at 630</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 939 CRC32 0x9df50e18     Delete_rows: table id 74 flags: STMT_END_F</span></span><br><span class="line"></span><br><span class="line">BINLOG <span class="string">'</span></span><br><span class="line"><span class="string">uCG1XhMqTw8AVQAAAHYCAAAAAEoAAAAAAAEABmJvb2JvbwAOdGVzdGZsYXNoYmFjazIADAMPD/YE</span></span><br><span class="line"><span class="string">BRISEfz8/A5QABAEEwkECAYAAAICA/4O9JgYVA==</span></span><br><span class="line"><span class="string">uCG1XiAqTw8ANQEAAKsDAAAAAEoAAAAAAAEAAgAM//8A8AEAAAADYWFhzQBiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJi</span></span><br><span class="line"><span class="string">YmJiYmJiYmJiYmJiYmJiYmJiYmJigAAAAAodzWUAmpkpQWZmZmZmZiVAmZ30oAAAAACZnfSgAFnx</span></span><br><span class="line"><span class="string">QaAEAGNjY2MEAGRkZGQDAABlZWUYDvWd</span></span><br><span class="line"><span class="string">'</span>/*!*/;</span><br><span class="line"><span class="comment">### DELETE FROM `booboo`.`testflashback2`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2='aaa' /* VARSTRING(80) meta=80 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb' /* VARSTRING(1040) meta=1040 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4=10.500000000 /* DECIMAL(19,9) meta=4873 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @5=10.6                 /* FLOAT meta=4 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @6=10.699999999999999289 /* DOUBLE meta=8 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @7='2017-10-26 10:00:00.000000' /* DATETIME(6) meta=6 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @8='2017-10-26 10:00:00' /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @9=1508983200 /* TIMESTAMP(0) meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @10='cccc' /* BLOB/TEXT meta=2 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @11='dddd' /* BLOB/TEXT meta=2 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @12='eee' /* MEDIUMBLOB/MEDIUMTEXT meta=3 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment"># at 939</span></span><br><span class="line"><span class="comment">#200508 17:09:12 server id 1003306  end_log_pos 970 CRC32 0x637a4759     Xid = 153</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="comment"># End of log file</span></span><br><span class="line">ROLLBACK /* added by mysqlbinlog */;</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br></pre></td></tr></table></figure><ol start="4"><li>导入数据库<code>mysqlbinlog -v -v binlog_output_base.flashback | mysql -uroot -proot</code></li></ol><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@node1 <span class="built_in">log</span>]<span class="comment"># mysqlbinlog -v -v binlog_output_base.flashback | mysql -uroot -proot</span></span><br><span class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br></pre></td></tr></table></figure><ol start="5"><li>检查执行结果</li></ol><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">[root@node1 log]<span class="comment"># mysql -uroot -proot -e "select count(*) from booboo.testflashback2"</span></span><br><span class="line">Warning: Using a password on the command line interface can be insecure.</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| count(*) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">|        0 |</span><br><span class="line">+<span class="comment">----------+</span></span><br></pre></td></tr></table></figure><h2 id="如何对阿里云RDS进行闪回"><a href="#如何对阿里云RDS进行闪回" class="headerlink" title="如何对阿里云RDS进行闪回"></a>如何对阿里云RDS进行闪回</h2><p>难点：</p><ol><li>阿里云的binlog获取方法</li><li>阿里云账号没有Super权限因此需要处理binlog日志删除备注信息。</li></ol><h3 id="阿里云的binlog获取方法"><a href="#阿里云的binlog获取方法" class="headerlink" title="阿里云的binlog获取方法"></a>阿里云的binlog获取方法</h3><ol><li>若binlog日志已上传至oss，则需要在控制台进行下载，下载时需要注意找到主的日志（阿里云RDS日志包含主和被的日志）</li><li>若binlog日志还在实例本地，则需要在控制台先点击一键上传，待日志上传到oss后，从控制台下载</li></ol><h3 id="处理binlog日志的备注信息"><a href="#处理binlog日志的备注信息" class="headerlink" title="处理binlog日志的备注信息"></a>处理binlog日志的备注信息</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 5.6版本</span></span><br><span class="line">mysqlbinlog -v -v --skip-gtids binlog_output_base.flashback | sed  <span class="string">'s@\/\*.*\*\/@@'</span> |mysql -uroot -proot</span><br></pre></td></tr></table></figure><h3 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h3><p>对于阿里云RDS实例，若待回滚的表中，没有blob字段建议使用binlog2sql。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 远程在线获取binlog日志</span></span><br><span class="line">mysqlbinlog -vv -P 3306 -uxxx -pxxxx -hxxxxx.mysql.rds.aliyuncs.com --<span class="built_in">read</span>-from-remote-server --start-datetime=<span class="string">'2017-09-12 06:29:00'</span> --stop-datetime=<span class="string">'2017-09-12 06:30:01'</span> --base64-output=DECODE-ROWS mysql-bin.000634 &gt; taiping0912.binlog</span><br><span class="line"><span class="comment"># binlog2sql远程连接数据库直接生成回滚sql</span></span><br><span class="line">python binlog2sql.py -P 3306 -uxxx -pxxxx -hxxxxx.mysql.rds.aliyuncs.com -t tablenamexxx --start-file=<span class="string">'mysql-bin.000001'</span> --start-position=4946 --stop-position=5921 -B</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;生产中使用binlog2sql较多，但也有缺点例如速度不够快；不支持blob的列，因此使用美团开源的myflash试试。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- MDTOC maxdepth:6 firsth1:1 numbering:0 f
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="紧急救援" scheme="http://www.toberoot.com/tags/%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4/"/>
    
      <category term="MyFlash" scheme="http://www.toberoot.com/tags/MyFlash/"/>
    
  </entry>
  
  <entry>
    <title>DataDog监控数据库（一）</title>
    <link href="http://www.toberoot.com/news/2020/04/23/tec-datadog/"/>
    <id>http://www.toberoot.com/news/2020/04/23/tec-datadog/</id>
    <published>2020-04-22T18:47:59.000Z</published>
    <updated>2020-04-22T11:47:38.125Z</updated>
    
    <content type="html"><![CDATA[<h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><p>现代监测与分析</p><p>在任何堆栈，任何应用程序，任何规模，任何地方都可以查看。</p><p><a href="https://www.datadoghq.com/" rel="external nofollow noreferrer">datadog官网</a></p><h2 id="安装centos插件"><a href="#安装centos插件" class="headerlink" title="安装centos插件"></a>安装centos插件</h2><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="code"><pre><span class="line">[root@NB-flexgw1:/root]# DD_AGENT_MAJOR_VERSION=7 DD_API_KEY=7911dc3b1d3c1034ba563eb2d61767f5 bash install_script.sh</span><br><span class="line"></span><br><span class="line">* Installing YUM sources for Datadog</span><br><span class="line"></span><br><span class="line">* Installing the Datadog Agent package</span><br><span class="line"></span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">Cleaning repos: base datadog docker-ce-stable epel extras influxdb</span><br><span class="line">              : percona-release-noarch percona-release-x86_64 updates</span><br><span class="line">24 metadata 文件已删除</span><br><span class="line">16 sqlite 文件已删除</span><br><span class="line">0 metadata 文件已删除</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">设置安装进程</span><br><span class="line">Determining fastest mirrors</span><br><span class="line">解决依赖关系</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> 执行事务检查</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package datadog-agent.x86_64 1:7.18.1-1 will be 安装</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> 完成依赖关系计算</span></span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"> 软件包                架构           版本                仓库             大小</span><br><span class="line">================================================================================</span><br><span class="line">正在安装:</span><br><span class="line"> datadog-agent         x86_64         1:7.18.1-1          datadog         130 M</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">================================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">总下载量：130 M</span><br><span class="line">Installed size: 435 M</span><br><span class="line">下载软件包：</span><br><span class="line">warning: rpmts_HdrFromFdno: Header V4 RSA/SHA1 Signature, key ID e09422b3: NOKEY</span><br><span class="line">Retrieving key from https://yum.datadoghq.com/DATADOG_RPM_KEY_E09422B3.public</span><br><span class="line">Importing GPG key 0xE09422B3:</span><br><span class="line"> Userid: "Datadog, Inc &lt;package@datadoghq.com&gt;"</span><br><span class="line"> From  : https://yum.datadoghq.com/DATADOG_RPM_KEY_E09422B3.public</span><br><span class="line">运行 rpm_check_debug</span><br><span class="line">执行事务测试</span><br><span class="line">事务测试成功</span><br><span class="line">执行事务</span><br><span class="line">  正在安装   : 1:datadog-agent-7.18.1-1.x86_64                              1/1</span><br><span class="line">Enabling service datadog-agent</span><br><span class="line">Loading SELinux policy module for datadog-agent.</span><br><span class="line">Couldn’t load system-probe policy.</span><br><span class="line">To be able to run system-probe on your host, please install or update the selinux-policy-targeted and</span><br><span class="line">policycoreutils-python (or policycoreutils-python-utils depending on your distribution) packages.</span><br><span class="line">Then run the following commands, or reinstall datadog-agent:</span><br><span class="line">    semodule -i /etc/datadog-agent/selinux/system_probe_policy.pp</span><br><span class="line">    semanage fcontext -a -t system_probe_t /opt/datadog-agent/embedded/bin/system-probe</span><br><span class="line">    restorecon -v /opt/datadog-agent/embedded/bin/system-probe</span><br><span class="line">No datadog.yaml file detected, not starting the agent</span><br><span class="line">  Verifying  : 1:datadog-agent-7.18.1-1.x86_64                              1/1</span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  datadog-agent.x86_64 1:7.18.1-1</span><br><span class="line"></span><br><span class="line">完毕！</span><br><span class="line"></span><br><span class="line">* Adding your API key to the Agent configuration: /etc/datadog-agent/datadog.yaml</span><br><span class="line"></span><br><span class="line">* Starting the Agent...</span><br><span class="line"></span><br><span class="line">stop: Unknown instance:</span><br><span class="line">datadog-agent start/running, process 15261</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Your Agent is running and functioning properly. It will continue to run in the</span><br><span class="line">background and submit metrics to Datadog.</span><br><span class="line"></span><br><span class="line">If you ever want to stop the Agent, run:</span><br><span class="line"></span><br><span class="line">     stop datadog-agent</span><br><span class="line"></span><br><span class="line">And to run it again run:</span><br><span class="line"></span><br><span class="line">     start datadog-agent</span><br><span class="line"></span><br><span class="line">[root@NB-flexgw1:/root]# pwd</span><br><span class="line">/etc/datadog-agent/conf.d</span><br><span class="line">[root@NB-flexgw1:/root]# ls</span><br><span class="line">activemq.d            containerd.d   external_dns.d   ibm_mq.d                   kube_scheduler.d     nfsstat.d                   rabbitmq.d     tcp_check.d</span><br><span class="line">activemq_xml.d        coredns.d      file_handle.d    ibm_was.d                  kyototycoon.d        nginx.d                     redisdb.d      teamcity.d</span><br><span class="line">aerospike.d           couchbase.d    flink.d          io.d                       lighttpd.d           nginx_ingress_controller.d  riakcs.d       tenable.d</span><br><span class="line">airflow.d             couch.d        fluentd.d        istio.d                    linkerd.d            ntp.d                       riak.d         tls.d</span><br><span class="line">amazon_msk.d          cpu.d          gearmand.d       jboss_wildfly.d            linux_proc_extras.d  openldap.d                  sap_hana.d     tomcat.d</span><br><span class="line">ambari.d              cri.d          gitlab.d         jmx.d                      load.d               openmetrics.d               scylla.d       twemproxy.d</span><br><span class="line">apache.d              crio.d         gitlab_runner.d  kafka_consumer.d           mapr.d               openstack_controller.d      snmp.d         twistlock.d</span><br><span class="line">btrfs.d               directory.d    go_expvar.d      kafka.d                    mapreduce.d          openstack.d                 solr.d         uptime.d</span><br><span class="line">cacti.d               disk.d         go-metro.d       kong.d                     marathon.d           oracle.d                    spark.d        varnish.d</span><br><span class="line">cassandra.d           dns_check.d    gunicorn.d       kube_apiserver_metrics.d   mcache.d             pgbouncer.d                 sqlserver.d    vault.d</span><br><span class="line">cassandra_nodetool.d  docker.d       haproxy.d        kube_controller_manager.d  memory.d             php_fpm.d                   squid.d        vertica.d</span><br><span class="line">ceph.d                druid.d        harbor.d         kube_dns.d                 mesos_master.d       postfix.d                   ssh_check.d    vsphere.d</span><br><span class="line">cilium.d              ecs_fargate.d  hdfs_datanode.d  kubelet.d                  mesos_slave.d        postgres.d                  statsd.d       yarn.d</span><br><span class="line">cisco_aci.d           eks_fargate.d  hdfs_namenode.d  kube_metrics_server.d      mongo.d              powerdns_recursor.d         supervisord.d  zk.d</span><br><span class="line">clickhouse.d          elastic.d      hive.d           kube_proxy.d               mysql.d              presto.d                    system_core.d</span><br><span class="line">cockroachdb.d         envoy.d        http_check.d     kubernetes_apiserver.d     nagios.d             process.d                   systemd.d</span><br><span class="line">consul.d              etcd.d         ibm_db2.d        kubernetes_state.d         network.d            prometheus.d                system_swap.d</span><br><span class="line">[root@NB-flexgw1:/root]#</span><br></pre></td></tr></table></figure><img src='https://i.loli.net/2020/04/22/pdERu9nf341wKHi.jpg' alt='pdERu9nf341wKHi'/><h2 id="添加MySQL监控"><a href="#添加MySQL监控" class="headerlink" title="添加MySQL监控"></a>添加MySQL监控</h2><p>最简单配置</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="code"><pre><span class="line">[root@NB-flexgw1:/root]# grep -v '^      #' conf.yaml | grep -v '^#' | grep -v '    #' |grep -v '^$'</span><br><span class="line">init_config:</span><br><span class="line">instances:</span><br><span class="line">  - server: 10.200.6.53</span><br><span class="line">    user: xxx</span><br><span class="line">    pass: xxx</span><br></pre></td></tr></table></figure><img src='https://i.loli.net/2020/04/22/32pZwyrigFLK96f.jpg' alt='32pZwyrigFLK96f'/><h2 id="添加pg监控"><a href="#添加pg监控" class="headerlink" title="添加pg监控"></a>添加pg监控</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">psql postgres -c \</span><br><span class="line">"<span class="keyword">select</span> * <span class="keyword">from</span> pg_stat_database <span class="keyword">LIMIT</span>(<span class="number">1</span>);" \</span><br><span class="line">&amp;&amp; echo -e "\e[0;32mPostgres connection - OK\e[0m" \</span><br><span class="line">|| echo -e "\e[0;31mCannot connect to Postgres\e[0m"</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> pg_stat_activity() <span class="keyword">RETURNS</span> SETOF pg_catalog.pg_stat_activity <span class="keyword">AS</span></span><br><span class="line">$$ <span class="keyword">SELECT</span> * <span class="keyword">from</span> pg_catalog.pg_stat_activity; $$</span><br><span class="line">LANGUAGE sql VOLATILE SECURITY DEFINER;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> pg_stat_activity_dd <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> pg_stat_activity();</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> pg_stat_activity_dd <span class="keyword">to</span> test01;</span><br></pre></td></tr></table></figure><img src='https://i.loli.net/2020/04/22/Gnob6tVLOqcAdjZ.jpg' alt='Gnob6tVLOqcAdjZ'/><img src='https://i.loli.net/2020/04/22/OB6FixH5kfwnXvI.jpg' alt='OB6FixH5kfwnXvI'/><img src='https://i.loli.net/2020/04/22/6mnOXzMalJoyGTt.jpg' alt='6mnOXzMalJoyGTt'/><img src='https://i.loli.net/2020/04/22/aGhsDypmf1EOFJb.jpg' alt='aGhsDypmf1EOFJb'/><h2 id="datadog-agent-日志"><a href="#datadog-agent-日志" class="headerlink" title="datadog agent 日志"></a>datadog agent 日志</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/var/<span class="built_in">log</span>/datadog/errors.log</span><br><span class="line">/var/<span class="built_in">log</span>/datadog/trace-errors.log</span><br><span class="line">/var/<span class="built_in">log</span>/datadog/trace-agent.log</span><br><span class="line">/var/<span class="built_in">log</span>/datadog/process-errors.log</span><br><span class="line">/var/<span class="built_in">log</span>/datadog/process-agent.log </span><br></pre></td></tr></table></figure><h2 id="使用感受"><a href="#使用感受" class="headerlink" title="使用感受"></a>使用感受</h2><ol><li>datadog产品聚焦于IT运维场景，且方案中拓展成不通行业的运维场景，非常地有针对性。</li><li>安装配置文档说明非常详细。</li><li>采集器丰富，且非常强大，举例（mysql采集器比telegraf官方的强大多了！！！！已经支持自定义SQL的方式，且包含对mysql错误日志、慢查询日志的集成）–用户的角度，而不是只提供插件不提供场景</li><li>默认的图表展示较一般，且全英文</li><li>告警还没有使用，先不说感受了。</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;官网&quot;&gt;&lt;a href=&quot;#官网&quot; class=&quot;headerlink&quot; title=&quot;官网&quot;&gt;&lt;/a&gt;官网&lt;/h2&gt;&lt;p&gt;现代监测与分析&lt;/p&gt;
&lt;p&gt;在任何堆栈，任何应用程序，任何规模，任何地方都可以查看。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://ww
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="datadog" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/datadog/"/>
    
    
      <category term="监控" scheme="http://www.toberoot.com/tags/%E7%9B%91%E6%8E%A7/"/>
    
      <category term="datadog" scheme="http://www.toberoot.com/tags/datadog/"/>
    
  </entry>
  
  <entry>
    <title>PostgreSQL安装pg_stat_statements模块开启慢查询统计</title>
    <link href="http://www.toberoot.com/news/2020/04/23/tec-pg-md/"/>
    <id>http://www.toberoot.com/news/2020/04/23/tec-pg-md/</id>
    <published>2020-04-22T16:34:59.000Z</published>
    <updated>2020-04-22T09:28:48.152Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装pg-stat-statements模块开启慢查询统计"><a href="#安装pg-stat-statements模块开启慢查询统计" class="headerlink" title="安装pg_stat_statements模块开启慢查询统计"></a>安装pg_stat_statements模块开启慢查询统计</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 需要安装相同版本的contrib包</span></span><br><span class="line">yum install -y postgresql-contrib.x86_64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置文件</span></span><br><span class="line">vim /var/lib/pgsql/data/postgresql.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 当需要跟踪SQL语句或者慢语句，得需要设置以下参数：</span></span><br><span class="line">log_statement = all     #需设置跟踪所有语句，否则只能跟踪出错信息</span><br><span class="line">log_min_duration_statement = 5000    #milliseconds,记录执行5秒及以上的语句</span><br><span class="line"></span><br><span class="line">shared_preload_libraries = 'pg_stat_statements'         # (change requires restart)</span><br><span class="line"><span class="meta">#</span><span class="bash">以下配置pg_stat_statements采样参数</span></span><br><span class="line">pg_stat_statements.max = 10000</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 在pg_stat_statements中最多保留多少条统计信息，通过LRU算法，覆盖老的记录。</span></span></span><br><span class="line">pg_stat_statements.track = all</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># all - (所有SQL包括函数内嵌套的SQL), top - 直接执行的SQL(函数内的sql不被跟踪), none - (不跟踪)</span></span></span><br><span class="line">pg_stat_statements.track_utility = off</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 是否跟踪非DML语句 (例如DDL，DCL)，on表示跟踪, off表示不跟踪</span></span></span><br><span class="line">pg_stat_statements.save = on</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启服务</span></span><br><span class="line">su - postgres</span><br><span class="line">pg_ctl -D /var/lib/pgsql/data reload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 extension</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 由于pg_stat_statements针对的是数据库级别，所以需要首先进入指定数据库</span></span><br><span class="line">psql</span><br><span class="line">\l</span><br><span class="line">\c test01</span><br><span class="line">create extension pg_stat_statements;</span><br><span class="line"></span><br><span class="line">\df</span><br></pre></td></tr></table></figure><h2 id="查询慢SQL"><a href="#查询慢SQL" class="headerlink" title="查询慢SQL"></a>查询慢SQL</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">query</span>, calls, total_time, <span class="keyword">rows</span>, <span class="number">100.0</span> * shared_blks_hit /</span><br><span class="line">               <span class="keyword">nullif</span>(shared_blks_hit + shared_blks_read, <span class="number">0</span>) <span class="keyword">AS</span> hit_percent</span><br><span class="line">          <span class="keyword">FROM</span> pg_stat_statements <span class="keyword">ORDER</span> <span class="keyword">BY</span> calls,total_time <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">query</span>, calls, total_time, <span class="keyword">rows</span>, <span class="number">100.0</span> * shared_blks_hit / <span class="keyword">nullif</span>(shared_blks_hit + shared_blks_read, <span class="number">0</span>) <span class="keyword">AS</span> hit_percent <span class="keyword">FROM</span> pg_stat_statements <span class="keyword">ORDER</span> <span class="keyword">BY</span> calls,total_time <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><p><a href="https://blog.csdn.net/ctypyb2002/article/details/83151836" rel="external nofollow noreferrer">postgresql 查找慢sql之二: pg_stat_statements</a></p></li><li><p><a href="https://blog.csdn.net/qq_18863573/article/details/104409897" rel="external nofollow noreferrer">PostgreSQL一些常用命令</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;安装pg-stat-statements模块开启慢查询统计&quot;&gt;&lt;a href=&quot;#安装pg-stat-statements模块开启慢查询统计&quot; class=&quot;headerlink&quot; title=&quot;安装pg_stat_statements模块开启慢查询统计&quot;&gt;&lt;/a
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="PostgreSQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/PostgreSQL/"/>
    
    
      <category term="慢SQL" scheme="http://www.toberoot.com/tags/%E6%85%A2SQL/"/>
    
  </entry>
  
  <entry>
    <title>表格实现合计</title>
    <link href="http://www.toberoot.com/news/2020/04/18/tec-html/"/>
    <id>http://www.toberoot.com/news/2020/04/18/tec-html/</id>
    <published>2020-04-17T21:20:35.000Z</published>
    <updated>2020-04-17T13:27:46.282Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>对 Flask_Admin 的 list.html 中添加 一个统计列。</p><h2 id="技术调研"><a href="#技术调研" class="headerlink" title="技术调研"></a>技术调研</h2><ol><li>html</li><li>css</li><li>js</li><li>bootstrap</li></ol><p>目前比较缺的技术是js。</p><p>在完成该需求前，先学习<a href="https://www.liaoxuefeng.com/wiki/1022910821149312" rel="external nofollow noreferrer">JavaScript教程</a>。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;需求&quot;&gt;&lt;a href=&quot;#需求&quot; class=&quot;headerlink&quot; title=&quot;需求&quot;&gt;&lt;/a&gt;需求&lt;/h2&gt;&lt;p&gt;对 Flask_Admin 的 list.html 中添加 一个统计列。&lt;/p&gt;
&lt;h2 id=&quot;技术调研&quot;&gt;&lt;a href=&quot;#技术调研&quot;
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="前端" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="bootstrap" scheme="http://www.toberoot.com/tags/bootstrap/"/>
    
  </entry>
  
  <entry>
    <title>如何成为一名优秀的MySQL数据库工程师</title>
    <link href="http://www.toberoot.com/news/2020/04/14/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/04/14/tec-mysql/</id>
    <published>2020-04-14T14:17:40.000Z</published>
    <updated>2020-04-14T06:40:45.053Z</updated>
    
    <content type="html"><![CDATA[<!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --><ul><li><a href="#阿里云acp认证考试">阿里云ACP认证考试</a>   </li><li><a href="#入门">入门</a>   </li><li><a href="#工作培训内容">工作培训内容</a>   <ul><li><a href="#总结能力">总结能力</a>   </li><li><a href="#代码能力">代码能力</a>   </li><li><a href="#事件处理要求">事件处理要求</a>   </li></ul></li><li><a href="#自我学习与沉淀">自我学习与沉淀</a>   <ul><li><a href="#高阶">高阶</a>   </li><li><a href="#技术能力">技术能力</a>   </li><li><a href="#业务能力">业务能力</a>   </li></ul></li><li><a href="#推荐书籍">推荐书籍</a>   <ul><li><a href="#mysql的使用">MySQL的使用</a>   </li><li><a href="#mysql的源码">MySQL的源码</a>   </li></ul></li></ul><!-- /MDTOC --><h1 id="阿里云ACP认证考试"><a href="#阿里云ACP认证考试" class="headerlink" title="阿里云ACP认证考试"></a>阿里云ACP认证考试</h1><p><a href="https://edu.aliyun.com/certification/acp01?spm=5176.11999222.1216633.6.43c55e9bFQDGwE" rel="external nofollow noreferrer">阿里云云计算专业认证考试（Alibaba Cloud Certified Professional，ACP）</a></p><h1 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h1><ul><li>会搭建主从复制？一主多从</li><li>了解最新的MGR集群</li><li>会编写增删该查的SQL</li><li>知道InnoDB行锁的不同语法</li><li>会用mysqldump进行数据库逻辑备份和恢复</li><li>会用perconaxtrabackup进行数据库物理备份和恢复</li><li>会使用Linux常用命令</li><li>会搭建LAMP架构的网站</li><li>会使用RDS数据库</li><li>会使用DTS迁移工具</li></ul><p>熟悉以下云数据库(云产品变化较快，建议去官网)</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">阿里云数据库产品</span><br><span class="line">  关系型数据库</span><br><span class="line">  云数据库 RDS MySQL 版</span><br><span class="line">  云数据库 RDS SQL Server 版</span><br><span class="line">  云数据库 RDS PostgreSQL 版</span><br><span class="line">  云数据库 RDS PPAS 版</span><br><span class="line">  云数据库 POLARDB</span><br><span class="line">  分析型数据库 ADS</span><br><span class="line">  云数据库 OceanBase</span><br><span class="line">  分布式关系型数据库服务 DRDS</span><br><span class="line">NoSQL数据库</span><br><span class="line">  云数据库 Redis 版</span><br><span class="line">  云数据库 MongoDB 版</span><br><span class="line">  云数据库 HBase 版</span><br><span class="line">  云数据库 Memcache 版</span><br><span class="line">  表格存储 TableStore</span><br><span class="line">混合分析数据库</span><br><span class="line">  HybridDB for MySQL</span><br><span class="line">  HybridDB for PostgreSQL</span><br><span class="line">数据库管理</span><br><span class="line">  数据管理 DMS</span><br><span class="line">  混合云数据库管理 HDM</span><br><span class="line">  数据库备份 DBS</span><br><span class="line">  CloudDBA</span><br><span class="line">迁移</span><br><span class="line">  数据传输 DTS</span><br><span class="line">  数据库和应用迁移 ADAM</span><br><span class="line">  闪电立方</span><br></pre></td></tr></table></figure><h1 id="工作培训内容"><a href="#工作培训内容" class="headerlink" title="工作培训内容"></a>工作培训内容</h1><h2 id="总结能力"><a href="#总结能力" class="headerlink" title="总结能力"></a>总结能力</h2><ul><li>对每一个客户的落地需求，应提供相应的报告</li><li>报告建议使用MarkDown格式，Markdown编辑器推荐Typora <a href="https://www.typora.io/" rel="external nofollow noreferrer">https://www.typora.io/</a> 非常轻量，适用于苹果、微软、Linux 有中文版本</li><li>报告输出为PDF交付客户</li><li>事件归类总结有自己的方法论（例如<a href="https://github.com/BoobooWei/DBA_Mysql/blob/master/常用故障排查命令1.txt" rel="external nofollow noreferrer">常用故障排查命令</a>、<a href="https://github.com/BoobooWei/DBA_Mysql/blob/master/常用测试脚本.txt" rel="external nofollow noreferrer">常用测试脚本</a>）</li><li>Confluence总结归类按时输出（Tips：故障类或命令多的建议先在本地使用markdown文档编写，后续复制粘贴归档至confluence；项目类，直接在confluence上记录）</li></ul><h2 id="代码能力"><a href="#代码能力" class="headerlink" title="代码能力"></a>代码能力</h2><ul><li>bash：能够编写自动备份恢复脚本（逻辑）、数据监控脚本</li><li>python：能够使用现有的python应用发现、健康报告、故障自愈、慢查询报告等脚本</li><li>sql：简单的SQL调优</li></ul><h2 id="事件处理要求"><a href="#事件处理要求" class="headerlink" title="事件处理要求"></a>事件处理要求</h2><ul><li>生产环境中的操作必须事先在测试环境中验证通过，并将测试验证报告留档confluence</li><li>钉钉及时响应，手机24小时开机</li><li>关键生产变更操作应两名工程师同时在场</li></ul><h1 id="自我学习与沉淀"><a href="#自我学习与沉淀" class="headerlink" title="自我学习与沉淀"></a>自我学习与沉淀</h1><h2 id="高阶"><a href="#高阶" class="headerlink" title="高阶"></a>高阶</h2><ul><li>精通复制的原理</li><li>精通MHA的实现逻辑</li><li>精通MGR的机制</li><li>能对SQL进行调优</li><li>精通S、X、IS、IX锁的实现</li><li>精通mysqldump的实现原理</li></ul><h2 id="技术能力"><a href="#技术能力" class="headerlink" title="技术能力"></a>技术能力</h2><ul><li>熟知数据库各版本特性和Bug</li><li>解决难题的终极能力</li><li>拥有总结成方法论的能力</li><li>预测未来五年技术趋势的能力</li></ul><h2 id="业务能力"><a href="#业务能力" class="headerlink" title="业务能力"></a>业务能力</h2><ul><li>熟知各个业务在数据库侧的难点和解决之道</li><li>懂业务，能够协调业务一起进行架构改造</li><li>敢担责，勇背锅的能力</li></ul><h1 id="推荐书籍"><a href="#推荐书籍" class="headerlink" title="推荐书籍"></a>推荐书籍</h1><p>工作效率</p><p>推荐大家一本书，著名的搞定系列《Getting Things Done》的《搞定1无压工作的艺术》（GTD的已经成为时间管理系统的代称），这本书主要讲工作流程管理，个人效率提升方法，非常简单易行。GTD时间管理，并非是去管理时间，而是运用技巧、方法和工具帮助人们完成工作，实现目标，有效的运用时间。</p><ul><li>GTD的核心理念概括就是必须记录下来要做的事，然后整理安排并使自己一一去执行。</li><li>GTD的五个核心原则是：收集、整理、组织、回顾、执行。</li><li>GTD的核心理念在于清空大脑，然后一步步按照设定的路线去努力执行。</li></ul><p>微信读书里有电子版的</p><h2 id="MySQL的使用"><a href="#MySQL的使用" class="headerlink" title="MySQL的使用"></a>MySQL的使用</h2><ol><li>MySQL技术内幕InnoDB存储引擎</li><li>MySQL的官方手册</li><li>MySQL排错指南</li><li>高性能MySQL</li><li>数据库索引设计与优化</li><li>Effective MySQL系列</li></ol><h2 id="MySQL的源码"><a href="#MySQL的源码" class="headerlink" title="MySQL的源码"></a>MySQL的源码</h2><ol><li>InnoDB - A journey to the core</li><li>深入MySQL源码</li><li>深入理解MySQL核心技术</li><li>MySQL内核InnoDB存储引擎</li><li>MySQL Internals Manual</li><li>MariaDB原理与实现</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#阿里云acp认证考试&quot;&gt;阿里云ACP认证考试&lt;/a&gt;   &lt;/li&gt;
&lt;l
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="技术管理" scheme="http://www.toberoot.com/tags/%E6%8A%80%E6%9C%AF%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>2020年的前端感受</title>
    <link href="http://www.toberoot.com/news/2020/04/02/tec-front/"/>
    <id>http://www.toberoot.com/news/2020/04/02/tec-front/</id>
    <published>2020-04-02T11:28:40.000Z</published>
    <updated>2020-04-02T03:33:24.117Z</updated>
    
    <content type="html"><![CDATA[<img src="https://media-image1.baydn.com/codetime_images/rpseos/cd56e9d81730f5e40b37dd7f26642465.fd9f78ff6a7b98b9198c84acbf7b975f.gif"><p>HTML、CSS、JavaScript 三者的作用：HTML 负责内容和骨架，CSS 负责美化和样式，JavaScript 负责让其动起来！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;img src=&quot;https://media-image1.baydn.com/codetime_images/rpseos/cd56e9d81730f5e40b37dd7f26642465.fd9f78ff6a7b98b9198c84acbf7b975f.gif&quot;&gt;

&lt;p&gt;
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="前端" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="前端" scheme="http://www.toberoot.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>CentOS6.5配置python3.7安装后ssl问题</title>
    <link href="http://www.toberoot.com/news/2020/03/27/tec-python/"/>
    <id>http://www.toberoot.com/news/2020/03/27/tec-python/</id>
    <published>2020-03-26T19:58:02.000Z</published>
    <updated>2020-03-29T14:01:08.427Z</updated>
    
    <content type="html"><![CDATA[<p>摘要：解决Python3安装中的SSL问题</p><a id="more"></a><h2 id="报错明细"><a href="#报错明细" class="headerlink" title="报错明细"></a>报错明细</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip is configured with locations that require TLS/SSL, however the ssl module <span class="keyword">in</span> Python is not available.</span><br></pre></td></tr></table></figure><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>由于系统是CentOS release 6.7，所有openssl的版本为 OpenSSL 1.0.1e ,而python3.7需要的openssl的版本为 1.0.2 或者 1.1.x,</p><ul><li>需要对openssl进行升级</li><li>并重新编译python3.7.0 <code>export LDFLAGS=&quot;-L/usr/local/openssl/lib/&quot;</code></li></ul><h2 id="详细记录"><a href="#详细记录" class="headerlink" title="详细记录"></a>详细记录</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@CNACLQLJMP010 install]<span class="comment"># rpm -qa|grep openssl</span></span><br><span class="line">openssl-devel-1.0.1e-58.el6_10.x86_64</span><br><span class="line">openssl-1.0.1e-58.el6_10.x86_64</span><br><span class="line">openssl-static-1.0.1e-58.el6_10.x86_64</span><br><span class="line">[root@CNACLQLJMP010 install]<span class="comment"># openssl version</span></span><br><span class="line">OpenSSL 1.0.1e-fips 11 Feb 2013</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wget https://www.openssl.org/<span class="built_in">source</span>/openssl-1.1.1-pre8.tar.gz</span><br><span class="line">tar -xf openssl-1.1.1-pre8.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssl-1.1.1-pre8</span><br><span class="line">./config --prefix=/usr/<span class="built_in">local</span>/openssl no-zlib</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">mv /usr/bin/openssl /usr/bin/openssl.bak</span><br><span class="line">mv /usr/include/openssl/ /usr/include/openssl.bak</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/openssl/include/openssl /usr/include/openssl</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/openssl/lib/libssl.so.1.1 /usr/<span class="built_in">local</span>/lib64/libssl.so</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/openssl/bin/openssl /usr/bin/openssl</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"/usr/local/openssl/lib"</span> &gt;&gt; /etc/ld.so.conf</span><br><span class="line">ldconfig -v</span><br><span class="line"></span><br><span class="line">openssl version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ -f <span class="string">"/usr/bin/python3"</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装系统依赖包</span></span><br><span class="line">yum -y install zlib-devel bzip2 bzip2-devel openssl openssl-static openssl-devel \</span><br><span class="line">ncurses ncurses-devel sqlite sqlite-devel readline readline-devel tk tk-devel lzma gdbm \</span><br><span class="line">gdbm-devel db4-devel libpcap-devel xz xz-devel libffi-devel gcc</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测 cloudcare 是否存在</span></span><br><span class="line"><span class="keyword">if</span> [[ ! -f <span class="string">"/alidata"</span> ]];<span class="keyword">then</span></span><br><span class="line">mkdir /alidata</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Created /alidata"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载安装包 python 3.7.3</span></span><br><span class="line"><span class="keyword">if</span> [[ ! -f <span class="string">"./Python-3.7.3.tgz"</span> ]];<span class="keyword">then</span></span><br><span class="line">curl -O https://cloud-software.oss-cn-hangzhou.aliyuncs.com/linux%20%E8%BD%AF%E4%BB%B6/Python-3.7.3.tgz</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压文件</span></span><br><span class="line">tar -xvf Python-3.7.3.tgz &amp;&amp; <span class="built_in">cd</span> Python-3.7.3/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译 python 包</span></span><br><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">"-L/usr/local/openssl/lib/"</span></span><br><span class="line"></span><br><span class="line">./configure --prefix=/alidata/python3 </span><br><span class="line">make &amp;&amp; make install &amp;&amp; <span class="built_in">echo</span> <span class="string">"### Python3 install success!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建软连接</span></span><br><span class="line">ln -s /alidata/python3/bin/python3 /usr/bin/python3 &amp;&amp; <span class="built_in">echo</span> <span class="string">"### Add python3 link Done!"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ln -s /alidata/python3/bin/pip3 /usr/bin/pip3 &amp;&amp; <span class="built_in">echo</span> <span class="string">"### Add pip3 link Done!"</span></span><br><span class="line">./configure --prefix=/alidata/python3 --with-openssl=/usr/<span class="built_in">local</span>/openssl</span><br><span class="line">make &amp;&amp; make install &amp;&amp; <span class="built_in">echo</span> <span class="string">"### Python3 install success!"</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;摘要：解决Python3安装中的SSL问题&lt;/p&gt;
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Python" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Python/"/>
    
    
      <category term="python" scheme="http://www.toberoot.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Git版本控制</title>
    <link href="http://www.toberoot.com/news/2019/05/13/tec-git/"/>
    <id>http://www.toberoot.com/news/2019/05/13/tec-git/</id>
    <published>2019-05-12T16:00:00.000Z</published>
    <updated>2020-05-12T08:04:41.669Z</updated>
    
    <content type="html"><![CDATA[<!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --><ul><li><a href="#版本控制的历史及作用">版本控制的历史及作用</a>   </li><li><a href="#git的安装">GIT的安装</a>   </li><li><a href="#git的初始化">GIT的初始化</a>   </li><li><a href="#第一次提交文件">第一次提交文件</a>   </li><li><a href="#git的工作区、暂存区、版本库">GIT的工作区、暂存区、版本库</a>   </li><li><a href="#git的常用基本命令">GIT的常用基本命令</a>   </li><li><a href="#git分支">GIT分支</a>   </li><li><a href="#git克隆">GIT克隆</a>   </li><li><a href="#9github的使用">9.GITHUB的使用</a>   </li></ul><!-- /MDTOC --><p>Git是一个免费的开源 分布式版本控制系统，旨在快速高效地处理从小型到大型项目的所有内容。</p><p>Git 易于学习， 占地面积小，具有闪电般的快速性能。它具有诸如Subversion，CVS，Perforce和ClearCase之类的SCM工具，并且具有廉价的本地分支，方便的暂存区域和 多个工作流等功能。</p><h2 id="版本控制的历史及作用"><a href="#版本控制的历史及作用" class="headerlink" title="版本控制的历史及作用"></a>版本控制的历史及作用</h2><p><strong>版本控制的作用：</strong></p><p>对于IT这个行业来说，经常会遇到一个问题：代码分散的拷贝在各个分区之中，不知道哪个代码文件是最新的，哪个代码文件是最优的。失败的复制、替换经常会导致原来尚能运行的代码遭到破坏。于是，针对以上的问题就产生了一种解决方案，这种方案我们成为版本控制。版本控制系统是能够随着时间的推进记录一系列文件的变化以便于你以后想要的退回到某个版本的系统。</p><p><strong>版本控制的历史：</strong></p><p>1）CVS：最早期的版本控制工具称为CVS，于1985年由荷兰阿姆斯特丹VU大学的Dick Grune教授完成开发，奠定了后续版本控制软件的模型基础。CVS采用C/S模型，版本库位于服务端，实际上存储的文件可以理解为一个RCS容器。每一个RCS文件以’.v‘作为后缀，保存该文件的每一次更改历史，使得其存储十分有效。然而CVS也存在如下缺点：1.效率不高，服务端文件越多，处理速度越慢。2.合并困难重重，经常会遇到严重冲突。3.不能直接对文件和目录的重命名进行版本控制，会破坏数据。</p><p>2）SVN：SVN全名为subversion，由collabNet公司于2000年开发，目的是为了弥补CVS的不足，创建一个性能更加强大的版本控制系统来取代CVS。到了2001年的时候，SVN已经可以用于市场环境。SVN拥有以下几个特征：1.轻量级拷贝。2.以授权文件的方式来实现版本库的授权。2.在工作区的隐藏目录下会保存一份冗余的原始拷贝。然而，SVB比起CVS在本质上并没有突破。到2009年年底，SVN被交由APACHE社区管理，至此svn成为了apache的一个子项目。</p><p>3）GIT：GIT由linux之父linus于2005年开发，在结构上比起SVN和CVS有很大的提升。可以说GIT是世界上目前最优秀的版本控制系统之一。GIT的每个功能都作为一条独立的命令，导致git庞大的命令集，但这并不妨碍各大程序人员对于GIT的喜爱，原因就在于它一个分布式的版本控制系统。此外：GIT虽然是基于linux操作系统开发的，但目前已经可以跨平台运行在多种操作系统之上，包括linux，MAC OS X，Windows等。</p><p><strong>版本控制系统的分类：</strong></p><p>版本控制主要分为三大类：本地版本控制系统，集中式版本控制系统和分布式版本控制系统。</p><p>本地版本控制：将文件的各个版本以一定的数据格式存储在本地的磁盘，这种方式在一定的程度上解决了手动复制黏贴的问题，但无法解决多人协作的问题。</p><p>集中式版本控制：比起本地版本控制多了一个中央服务器，各个版本的数据存储在中央服务器，管理员可以控制开发人员的权限，而开发人员也可以从中央服务器拉取数据。集中式版本控制解决了团队协作问题，但缺点是所有数据存储在中央服务器，服务器一旦宕机，会造成不可估量的损失。SVN和CVS都是集中式版本控制。</p><p>分布式版本控制，系统保存的不是文件变化的差两，而是文件的快照。分布式版本控制系统是分布式的，当你从中央服务器拷贝下来代码时，你拷贝的是一个完整的版本库，包括历史纪录，提交记录等，即使某一台机器宕机，也能够找到文件的完整备份。GIT就是分布式版本控制。</p><h2 id="GIT的安装"><a href="#GIT的安装" class="headerlink" title="GIT的安装"></a>GIT的安装</h2><p>git该软件光盘自带，直接通过yum的方式去安装即可，目前我们采用的git版本是1.8.3.1版本。</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera ~]# yum -y install git</span><br><span class="line">[root@servera ~]# git --version</span><br><span class="line">git version 1.8.3.1</span><br></pre></td></tr></table></figure><p>可以通过以下方式完成命令补全：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera ~]# cp /usr/share/doc/git-1.8.3.1/contrib/completion/git-completion.bash /etc/bash_completion.d</span><br><span class="line">[root@servera ~]# source /etc/bash_completion.d/git-completion.bash</span><br></pre></td></tr></table></figure><h2 id="GIT的初始化"><a href="#GIT的初始化" class="headerlink" title="GIT的初始化"></a>GIT的初始化</h2><p>1）设置下git的配置变量，告诉git当前用户的姓名和邮件地址，配置的用户名和邮件地址将会在版本库提交时候用到。</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera .git]# git config --global user.name "carol"</span><br><span class="line">[root@servera .git]# git config --global user.email lijiayi@uplooking.com</span><br></pre></td></tr></table></figure><p>2）创建工作目录并初始化</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera ~]# cd /root</span><br><span class="line">[root@servera ~]# ls</span><br><span class="line">anaconda-ks.cfg</span><br><span class="line">[root@servera ~]# mkdir workspace</span><br><span class="line">[root@servera ~]# cd workspace/</span><br><span class="line">[root@servera workspace]# git init</span><br><span class="line">Initialized empty Git repository in /root/workspace/.git/</span><br></pre></td></tr></table></figure><p>这里/root/workspace目录就是工作区。git ini为初始化命令，在执行完成之后会在该目录下生成一个.git的版本库。</p><h2 id="第一次提交文件"><a href="#第一次提交文件" class="headerlink" title="第一次提交文件"></a>第一次提交文件</h2><p>1）先在工作区生成一个文件</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera workspace]# echo hello &gt; welcome.txt</span><br><span class="line">[root@servera workspace]# ls</span><br><span class="line">welcome.txt</span><br><span class="line">[root@servera workspace]# cat welcome.txt</span><br><span class="line">hello</span><br></pre></td></tr></table></figure><p>2）为了将这个新建立的文件添加到版本库，需要执行以下指令</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera workspace]# git add welcome.txt</span><br><span class="line">[root@servera workspace]# git commit -m "first"</span><br><span class="line">[master c5171b5] first</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 welcome.txt</span><br></pre></td></tr></table></figure><h2 id="GIT的工作区、暂存区、版本库"><a href="#GIT的工作区、暂存区、版本库" class="headerlink" title="GIT的工作区、暂存区、版本库"></a>GIT的工作区、暂存区、版本库</h2><p><img src="git/1.png" alt="1"></p><p>在这里有三个概念。1.工作区   2.版本库   3.暂存区</p><p>实际上在上一个实践之中，我们经历了两次提交，主要和这个设计模式有关。</p><p>当工作区执行git add命令时，咱群出的目录树将被更新，同时工作区的文件内容会被写入到对象库中的一个新的对象中，而该对象的ID被记录在暂存区的文件索引中。</p><p>当执行git commit操作时候，暂存区的目录树会写到版本库中，最新指向的目录树就是提交时暂存区的目录树。</p><p>实际上，暂存区局像是一个虚拟的工作区，在这个虚拟工作区的目录树中，文件.git/index实际记录了文件名和文件的状态信息（时间戳、文件长度等等），文件的内容并没有实际存储其中，而是保存在了git对象库(.git/objects)中，文件索引建立起了对象库和实体对象之间的对应。图显示了工作区、暂存区和版本库之间的关系。</p><h2 id="GIT的常用基本命令"><a href="#GIT的常用基本命令" class="headerlink" title="GIT的常用基本命令"></a>GIT的常用基本命令</h2><p>1）git diff：用来显示工作区和暂存区文件的差异</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera workspace]# echo test  &gt;&gt; welcome.txt</span><br><span class="line">[root@servera workspace]# ls</span><br><span class="line">welcome.txt</span><br><span class="line">[root@servera workspace]# cat welcome.txt</span><br><span class="line">hello</span><br><span class="line">test</span><br><span class="line">[root@servera workspace]# ls</span><br><span class="line">welcome.txt</span><br><span class="line">[root@servera workspace]# git diff welcome.txt</span><br><span class="line">diff --git a/welcome.txt b/welcome.txt</span><br><span class="line">index ce01362..b2b9cc9 100644</span><br><span class="line">--- a/welcome.txt</span><br><span class="line">+++ b/welcome.txt</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> hello</span><br><span class="line">+test</span><br></pre></td></tr></table></figure><p>2）git status：用来查看改过的内容</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera workspace]# git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Changes not staged <span class="keyword">for</span> commit:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    modified:   welcome.txt</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line">no changes added to commit (use "git add" and/or "git commit -a")</span><br><span class="line">[root@servera workspace]#</span><br></pre></td></tr></table></figure><p>3）git log： 用来查看历史提交的日志</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera workspace]# git log</span><br><span class="line">commit a7a778652b1457b838beeca66e4334c35d97e826</span><br><span class="line">Author: carol &lt;lijiayi@uplooking.com&gt;</span><br><span class="line">Date:   Sun Nov 20 07:01:51 2016 -0500</span><br><span class="line"></span><br><span class="line">    first</span><br></pre></td></tr></table></figure><p>4）git reset 用来做回滚</p><p>恢复工作区的文件到上一个提交的版本：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera workspace]# echo test &gt;&gt; welcome.txt</span><br><span class="line">[root@servera workspace]# cat welcome.txt</span><br><span class="line">hello</span><br><span class="line">test</span><br><span class="line">[root@servera workspace]# git add welcome.txt</span><br><span class="line">[root@servera workspace]# git commit -m "second"  # 以上的操作为再添加一个版本</span><br><span class="line">[master 0d10fd9] second</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line">[root@servera workspace]# cat welcome.txt</span><br><span class="line">hello</span><br><span class="line">test</span><br><span class="line">[root@servera workspace]# git reset --hard HEAD^   # ^代表上一个版本，^^代表上上一个版本，当然往上100个版本写100个^比较容易数不过来，所以可以写成HEAD~100</span><br><span class="line">HEAD is now at a7a7786 first</span><br><span class="line">[root@servera workspace]# ls</span><br><span class="line">welcome.txt</span><br><span class="line">[root@servera workspace]# cat welcome.txt</span><br><span class="line">hello</span><br></pre></td></tr></table></figure><p>恢复工作区到指定版本：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera workspace]# echo testok &gt;&gt; welcome.txt</span><br><span class="line">[root@servera workspace]# echo testok &gt;&gt; welcome.txt</span><br><span class="line">[root@servera workspace]# git add welcome.txt</span><br><span class="line">[root@servera workspace]# git commit -m "third"  # 这里再添加一个版本</span><br><span class="line">[master 3c3b1d9] third</span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br><span class="line">[root@servera workspace]# git log --graph --oneline  # 可以通过该参数查看到每个操作对应的ID</span><br><span class="line">* 3c3b1d9 third</span><br><span class="line">* a7a7786 first</span><br><span class="line">[root@servera workspace]# git reset --hard a7a7786</span><br><span class="line">HEAD is now at a7a7786 first</span><br><span class="line">[root@servera workspace]# ls</span><br><span class="line">welcome.txt</span><br><span class="line">[root@servera workspace]# cat welcome.txt</span><br><span class="line">hello</span><br></pre></td></tr></table></figure><p>5）git  reflog用来查看历史记录，可以结合reset完成恢复数据的操作</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera workspace]# git reflog</span><br><span class="line">a7a7786 HEAD@&#123;0&#125;: reset: moving to a7a7786</span><br><span class="line">3c3b1d9 HEAD@&#123;1&#125;: commit: third</span><br><span class="line">a7a7786 HEAD@&#123;2&#125;: reset: moving to HEAD^</span><br><span class="line">0d10fd9 HEAD@&#123;3&#125;: commit: second</span><br><span class="line">a7a7786 HEAD@&#123;4&#125;: reset: moving to HEAD^</span><br><span class="line">4d65b14 HEAD@&#123;5&#125;: commit: second</span><br><span class="line">a7a7786 HEAD@&#123;6&#125;: commit (initial): first</span><br><span class="line">[root@servera workspace]# cat welcome.txt</span><br><span class="line">hello</span><br><span class="line">[root@servera workspace]# git reset --hard HEAD@&#123;1&#125;</span><br><span class="line">HEAD is now at 3c3b1d9 third</span><br><span class="line">[root@servera workspace]# ls</span><br><span class="line">welcome.txt</span><br><span class="line">[root@servera workspace]# cat welcome.txt</span><br><span class="line">hello</span><br><span class="line">testok</span><br><span class="line">testok</span><br></pre></td></tr></table></figure><p>6）git checkout 可以丢弃工作区的修改</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera workspace]# echo carol &gt;&gt; welcome.txt</span><br><span class="line">[root@servera workspace]# git add welcome.txt</span><br><span class="line">[root@servera workspace]# cat welcome.txt</span><br><span class="line">hello</span><br><span class="line">testok</span><br><span class="line">testok</span><br><span class="line">carol #重新提交一个修改后的文件至工作区</span><br><span class="line">[root@servera workspace]# git reset HEAD welcome.txt #如果已经提交给缓存区，则必须要做这步</span><br><span class="line">Unstaged changes after reset:</span><br><span class="line">M    welcome.txt</span><br><span class="line">[root@servera workspace]# git checkout -- welcome.txt</span><br><span class="line">[root@servera workspace]# cat welcome.txt</span><br><span class="line">hello</span><br><span class="line">testok</span><br><span class="line">testok</span><br></pre></td></tr></table></figure><p>7）git rm 从版本库中删除文件</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera workspace]# git rm welcome.txt</span><br><span class="line">rm 'welcome.txt'</span><br><span class="line">[root@servera workspace]# git commit -m "delete welcome"</span><br><span class="line">[master ba79342] delete welcome</span><br><span class="line"> 1 file changed, 3 deletions(-)</span><br><span class="line"> delete mode 100644 welcome.txt</span><br><span class="line">[root@servera workspace]# ls</span><br><span class="line">[root@servera workspace]# ls</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="GIT分支"><a href="#GIT分支" class="headerlink" title="GIT分支"></a>GIT分支</h2><p>通常情况下，一套分支只用来存放一套代码，为了保证每套代码的独立性，我们会建立多个分支来分开管理。</p><table><thead><tr><th>查看分支</th><th>创建分支</th><th>切换分支</th><th>合并某分支到当前分支</th><th>删除分支</th></tr></thead><tbody><tr><td>git branch</td><td>git branch name</td><td>git checkout name</td><td>git merge name</td><td>git branch -d name</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera workspace]# git branch  # 查看fenzhi</span><br><span class="line">* master</span><br><span class="line">[root@servera workspace]# git branch a #创建名为a的分支</span><br><span class="line">[root@servera workspace]# git branch</span><br><span class="line">  a</span><br><span class="line">* master   # * 代表当前分支</span><br><span class="line">[root@servera workspace]# git checkout a  # 切换分支</span><br><span class="line">Switched to branch 'a'</span><br><span class="line">[root@servera workspace]# git branch</span><br><span class="line">* a</span><br><span class="line">  master</span><br><span class="line">[root@servera workspace]# echo test &gt; testfile</span><br><span class="line">[root@servera workspace]# git add testfile</span><br><span class="line">[root@servera workspace]# git commit -m 'a'　　# 重新提交个文件</span><br><span class="line">[a 92abcd8] a</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 testfile</span><br><span class="line">[root@servera workspace]# ls</span><br><span class="line">testfile</span><br><span class="line">[root@servera workspace]# git status  # 可以看到已经提交给了a这个分支</span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch a</span></span><br><span class="line">nothing to commit, working directory clean</span><br><span class="line">[root@servera workspace]# cd .git/</span><br><span class="line">[root@servera .git]# ls</span><br><span class="line">branches        config       HEAD   index  logs     ORIG_HEAD</span><br><span class="line">COMMIT_EDITMSG  description  hooks  info   objects  refs</span><br><span class="line">[root@servera .git]# cat HEAD</span><br><span class="line">ref: refs/heads/a   # 可以看到当前分支头部指向了a</span><br><span class="line"></span><br><span class="line">[root@servera workspace]# git checkout master</span><br><span class="line">Switched to branch 'master'</span><br><span class="line">[root@servera workspace]# git merge a  # 合并分支，不建议这样做，可能会有冲突。</span><br><span class="line">Updating ba79342..92abcd8</span><br><span class="line">Fast-forward</span><br><span class="line"> testfile | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 testfile</span><br></pre></td></tr></table></figure><h2 id="GIT克隆"><a href="#GIT克隆" class="headerlink" title="GIT克隆"></a>GIT克隆</h2><p>git克隆的作用：备份，在分布式的集中化管理机制里，就可以通过克隆的方式，将远程的git版本库克隆至本地来进行修改。</p><p>1）克隆</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera ~]# git clone /root/workspace/ /backup</span><br><span class="line">Cloning into '/backup'...</span><br><span class="line">done.</span><br><span class="line">[root@servera ~]# cd /backup/</span><br><span class="line">[root@servera backup]# ls</span><br><span class="line">testfile</span><br></pre></td></tr></table></figure><p>2）拉取和推送</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">推送：</span><br><span class="line">[root@servera workspace]# git push /backup</span><br><span class="line">warning: push.default is unset; its implicit value is changing in</span><br><span class="line">Git 2.0 from 'matching' to 'simple'. To squelch this message</span><br><span class="line">and maintain the current behavior after the default changes, use:</span><br><span class="line"></span><br><span class="line">  git config --global push.default matching</span><br><span class="line"></span><br><span class="line">To squelch this message and adopt the new behavior now, use:</span><br><span class="line"></span><br><span class="line">  git config --global push.default simple</span><br><span class="line"></span><br><span class="line">See 'git help config' and search for 'push.default' for further information.</span><br><span class="line">(the 'simple' mode was introduced in Git 1.7.11. Use the similar mode</span><br><span class="line">'current' instead of 'simple' if you sometimes use older versions of Git)</span><br><span class="line"></span><br><span class="line">Counting objects: 4, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 272 bytes | 0 bytes/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: error: refusing to update checked out branch: refs/heads/master</span><br><span class="line">remote: error: By default, updating the current branch in a non-bare repository</span><br><span class="line">remote: error: is denied, because it will make the index and work tree inconsistent</span><br><span class="line">remote: error: with what you pushed, and will require 'git reset --hard' to match</span><br><span class="line">remote: error: the work tree to HEAD.</span><br><span class="line">remote: error:</span><br><span class="line">remote: error: You can set 'receive.denyCurrentBranch' configuration variable t</span><br><span class="line">remote: error: 'ignore' or 'warn' in the remote repository to allow pushing int</span><br><span class="line">remote: error: its current branch; however, this is not recommended unless you</span><br><span class="line">remote: error: arranged to update its work tree to match what you pushed in som</span><br><span class="line">remote: error: other way.</span><br><span class="line">remote: error:</span><br><span class="line">remote: error: To squelch this message and still keep the default behaviour, se</span><br><span class="line">remote: error: 'receive.denyCurrentBranch' configuration variable to 'refuse'.</span><br><span class="line">To /backup</span><br><span class="line"> ! [remote rejected] master -&gt; master (branch is currently checked out)</span><br><span class="line">error: failed to push some refs to '/backup'</span><br></pre></td></tr></table></figure><p>报错的原因：</p><p>默认更新非裸版本库的当前分支是不被允许的，因为这样会导致暂存区和工作区与你推送至版本库的新提交不一致。太古怪了。</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">拉取：</span><br><span class="line">[root@servera workspace]# cd /backup</span><br><span class="line">[root@servera backup]# ls</span><br><span class="line">testfile</span><br><span class="line">[root@servera backup]# git pull /root/workspace/</span><br><span class="line">From /root/workspace</span><br><span class="line"> * branch            HEAD       -&gt; FETCH_HEAD</span><br><span class="line">Updating 92abcd8..3191ffc</span><br><span class="line">Fast-forward</span><br><span class="line"> hello | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 hello</span><br><span class="line">[root@servera backup]# ls</span><br><span class="line">hello  testfile</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="9-GITHUB的使用"><a href="#9-GITHUB的使用" class="headerlink" title="9.GITHUB的使用"></a>9.GITHUB的使用</h2><p>GitHub 是一个面向开源及私有软件项目的托管平台，因为只支持 Git 作为唯一的版本库格式进行托管，故名 GitHub</p><p>网站地址：<a href="https://github.com/" rel="external nofollow noreferrer">https://github.com/</a></p><ol><li><p>将本地版本库上传至github保存</p></li><li><p>先打开github，自行注册</p></li><li><p>在github上通过图形化界面配置一个版本库 <img src="git/2.png" alt="2"></p></li><li><p>将本地的版本库通过push的方式上传至远程</p></li></ol><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera backup]# git remote add carol https://github.com/atheling004/test1.git  #添加执行用户</span><br><span class="line">[root@servera backup]# git push -u carol master</span><br><span class="line">Username for 'https://github.com': atheling004</span><br><span class="line">Password for 'https://atheling004@github.com':   # 输入用户名和密码</span><br><span class="line">Counting objects: 4, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (4/4), 248 bytes | 0 bytes/s, done.</span><br><span class="line">Total 4 (delta 0), reused 0 (delta 0)</span><br><span class="line">To https://github.com/atheling004/test1.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br><span class="line">Branch master set up to track remote branch master from carol.</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>查看结果</li></ol><p><img src="git/4.png" alt="3">2）将远程github版本库中保存的文件存放至本地</p><p>1.现在github上通过create new file选项自行创建一个新文件，这里创建的文件名称为zazazazazazaza</p><p>2.执行以下操作</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@servera backup]# git pull https://github.com/atheling004/test1.git</span><br><span class="line">remote: Counting objects: 3, done.</span><br><span class="line">remote: Compressing objects: 100% (2/2), done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">From https://github.com/atheling004/test1</span><br><span class="line"> * branch            HEAD       -&gt; FETCH_HEAD</span><br><span class="line">Updating 92a7721..33a62ba</span><br><span class="line">Fast-forward</span><br><span class="line"> zazazazazazaza | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 zazazazazazaza</span><br><span class="line">[root@foundation0 workspace]# ls</span><br><span class="line">hello  testfile  zazazazazazaza</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3.github的版本克隆（即远程版本克隆）</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@foundation0 ~]# mkdir /test</span><br><span class="line">[root@foundation0 ~]# cd /test/</span><br><span class="line">[root@foundation0 test]# ls</span><br><span class="line">[root@foundation0 test]# git clone https://github.com/atheling004/test1.git</span><br><span class="line">Cloning into 'test1'...</span><br><span class="line">remote: Counting objects: 7, done.</span><br><span class="line">remote: Compressing objects: 100% (4/4), done.</span><br><span class="line">remote: Total 7 (delta 1), reused 3 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (7/7), done.</span><br><span class="line">[root@foundation0 test]# ls</span><br><span class="line">test1</span><br><span class="line">[root@foundation0 test]# cd test1/</span><br><span class="line">[root@foundation0 test1]# ls</span><br><span class="line">hello  testfile  zazazazazazaza</span><br><span class="line">[root@foundation0 test1]#</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>4.在本地版本库发生变更后上传</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@foundation0 test1]# cat 1</span><br><span class="line">testfile</span><br><span class="line">[root@foundation0 test1]# git add 1</span><br><span class="line">[root@foundation0 test1]# git commit -m 1</span><br><span class="line">[root@foundation0 test1]# git push https://github.com/atheling004/test1.git</span><br><span class="line">warning: push.default is unset; its implicit value is changing in</span><br><span class="line">Git 2.0 from 'matching' to 'simple'. To squelch this message</span><br><span class="line">and maintain the current behavior after the default changes, use:</span><br><span class="line"></span><br><span class="line">  git config --global push.default matching</span><br><span class="line"></span><br><span class="line">To squelch this message and adopt the new behavior now, use:</span><br><span class="line"></span><br><span class="line">  git config --global push.default simple</span><br><span class="line"></span><br><span class="line">See 'git help config' and search for 'push.default' for further information.</span><br><span class="line">(the 'simple' mode was introduced in Git 1.7.11. Use the similar mode</span><br><span class="line">'current' instead of 'simple' if you sometimes use older versions of Git)</span><br><span class="line"></span><br><span class="line">Username for 'https://github.com': atheling004</span><br><span class="line">Password for 'https://atheling004@github.com':</span><br><span class="line">Counting objects: 4, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 252 bytes | 0 bytes/s, done.</span><br><span class="line">Total 3 (delta 1), reused 0 (delta 0)</span><br><span class="line">remote: Resolving deltas: 100% (1/1), completed with 1 local objects.</span><br><span class="line">To https://github.com/atheling004/test1.git</span><br><span class="line">   33a62ba..85c6527  master -&gt; master</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>结果如下</p><p><img src="git/5.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#版本控制的历史及作用&quot;&gt;版本控制的历史及作用&lt;/a&gt;   &lt;/li&gt;
&lt;l
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Git" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Git/"/>
    
    
      <category term="Git" scheme="http://www.toberoot.com/tags/Git/"/>
    
      <category term="Github" scheme="http://www.toberoot.com/tags/Github/"/>
    
      <category term="Gitlab" scheme="http://www.toberoot.com/tags/Gitlab/"/>
    
  </entry>
  
</feed>
